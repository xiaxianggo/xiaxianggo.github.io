<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Xia.Blog()</title>
  
  <subtitle>Stay Hungry</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-06-28T14:46:47.224Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Xia Xiang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ— é”¡</title>
    <link href="http://yoursite.com/2019/06/28/%E6%97%A0%E9%94%A1/"/>
    <id>http://yoursite.com/2019/06/28/æ— é”¡/</id>
    <published>2019-06-28T09:37:01.000Z</published>
    <updated>2019-06-28T14:46:47.224Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®°"><a href="#ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®°" class="headerlink" title="ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®° = ="></a>ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®° = =</h2><p>ğŸ³ğŸ³ğŸ³</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®°&quot;&gt;&lt;a href=&quot;#ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®° = =&quot;&gt;&lt;/a&gt;ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®° = =&lt;/h2&gt;&lt;p&gt;ğŸ³ğŸ³ğŸ³&lt;/p&gt;

      
    
    </summary>
    
      <category term="life" scheme="http://yoursite.com/categories/life/"/>
    
    
      <category term="æ—¥å¸¸" scheme="http://yoursite.com/tags/%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>JAVA IO</title>
    <link href="http://yoursite.com/2019/04/11/Java%20IO/"/>
    <id>http://yoursite.com/2019/04/11/Java IO/</id>
    <published>2019-04-11T15:55:00.000Z</published>
    <updated>2019-06-28T14:39:01.256Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ¦‚è§ˆ"><a href="#ä¸€ã€æ¦‚è§ˆ" class="headerlink" title="ä¸€ã€æ¦‚è§ˆ"></a>ä¸€ã€æ¦‚è§ˆ</h1><p>Java çš„ I/O å¤§æ¦‚å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š<br><a id="more"></a></p><ul><li>ç£ç›˜æ“ä½œï¼šFile</li><li>å­—èŠ‚æ“ä½œï¼šInputStream å’Œ OutputStream</li><li>å­—ç¬¦æ“ä½œï¼šReader å’Œ Writer</li><li>å¯¹è±¡æ“ä½œï¼šSerializable</li><li>ç½‘ç»œæ“ä½œï¼šSocket</li><li>æ–°çš„è¾“å…¥/è¾“å‡ºï¼šNIO</li></ul><h1 id="äºŒã€ç£ç›˜æ“ä½œ"><a href="#äºŒã€ç£ç›˜æ“ä½œ" class="headerlink" title="äºŒã€ç£ç›˜æ“ä½œ"></a>äºŒã€ç£ç›˜æ“ä½œ</h1><p>File ç±»å¯ä»¥ç”¨äºè¡¨ç¤ºæ–‡ä»¶å’Œç›®å½•çš„ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒä¸è¡¨ç¤ºæ–‡ä»¶çš„å†…å®¹ã€‚</p><p>é€’å½’åœ°åˆ—å‡ºä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">listAllFiles</span><span class="params">(File dir)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (dir == <span class="keyword">null</span> || !dir.exists()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dir.isFile()) &#123;</span><br><span class="line">        System.out.println(dir.getName());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (File file : dir.listFiles()) &#123;</span><br><span class="line">        listAllFiles(file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä» Java7 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨ Paths å’Œ Files ä»£æ›¿ Fileã€‚</p><h1 id="ä¸‰ã€å­—èŠ‚æ“ä½œ"><a href="#ä¸‰ã€å­—èŠ‚æ“ä½œ" class="headerlink" title="ä¸‰ã€å­—èŠ‚æ“ä½œ"></a>ä¸‰ã€å­—èŠ‚æ“ä½œ</h1><h2 id="å®ç°æ–‡ä»¶å¤åˆ¶"><a href="#å®ç°æ–‡ä»¶å¤åˆ¶" class="headerlink" title="å®ç°æ–‡ä»¶å¤åˆ¶"></a>å®ç°æ–‡ä»¶å¤åˆ¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copyFile</span><span class="params">(String src, String dist)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    FileInputStream in = <span class="keyword">new</span> FileInputStream(src);</span><br><span class="line">    FileOutputStream out = <span class="keyword">new</span> FileOutputStream(dist);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20</span> * <span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">int</span> cnt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// read() æœ€å¤šè¯»å– buffer.length ä¸ªå­—èŠ‚</span></span><br><span class="line">    <span class="comment">// è¿”å›çš„æ˜¯å®é™…è¯»å–çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="comment">// è¿”å› -1 çš„æ—¶å€™è¡¨ç¤ºè¯»åˆ° eofï¼Œå³æ–‡ä»¶å°¾</span></span><br><span class="line">    <span class="keyword">while</span> ((cnt = in.read(buffer, <span class="number">0</span>, buffer.length)) != -<span class="number">1</span>) &#123;</span><br><span class="line">        out.write(buffer, <span class="number">0</span>, cnt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    in.close();</span><br><span class="line">    out.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è£…é¥°è€…æ¨¡å¼"><a href="#è£…é¥°è€…æ¨¡å¼" class="headerlink" title="è£…é¥°è€…æ¨¡å¼"></a>è£…é¥°è€…æ¨¡å¼</h2><p>Java I/O ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼æ¥å®ç°ã€‚ä»¥ InputStream ä¸ºä¾‹ï¼Œ</p><ul><li>InputStream æ˜¯æŠ½è±¡ç»„ä»¶ï¼›</li><li>FileInputStream æ˜¯ InputStream çš„å­ç±»ï¼Œå±äºå…·ä½“ç»„ä»¶ï¼Œæä¾›äº†å­—èŠ‚æµçš„è¾“å…¥æ“ä½œï¼›</li><li>FilterInputStream å±äºæŠ½è±¡è£…é¥°è€…ï¼Œè£…é¥°è€…ç”¨äºè£…é¥°ç»„ä»¶ï¼Œä¸ºç»„ä»¶æä¾›é¢å¤–çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ BufferedInputStream ä¸º FileInputStream æä¾›ç¼“å­˜çš„åŠŸèƒ½ã€‚</li></ul><p><div align="center"> <img src="pics/9709694b-db05-4cce-8d2f-1c8b09f4d921.png" width="650px"> </div><br></p><p>å®ä¾‹åŒ–ä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„å­—èŠ‚æµå¯¹è±¡æ—¶ï¼Œåªéœ€è¦åœ¨ FileInputStream å¯¹è±¡ä¸Šå†å¥—ä¸€å±‚ BufferedInputStream å¯¹è±¡å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(filePath);</span><br><span class="line">BufferedInputStream bufferedInputStream = <span class="keyword">new</span> BufferedInputStream(fileInputStream);</span><br></pre></td></tr></table></figure><p>DataInputStream è£…é¥°è€…æä¾›äº†å¯¹æ›´å¤šæ•°æ®ç±»å‹è¿›è¡Œè¾“å…¥çš„æ“ä½œï¼Œæ¯”å¦‚ intã€double ç­‰åŸºæœ¬ç±»å‹ã€‚</p><h1 id="å››ã€å­—ç¬¦æ“ä½œ"><a href="#å››ã€å­—ç¬¦æ“ä½œ" class="headerlink" title="å››ã€å­—ç¬¦æ“ä½œ"></a>å››ã€å­—ç¬¦æ“ä½œ</h1><h2 id="ç¼–ç ä¸è§£ç "><a href="#ç¼–ç ä¸è§£ç " class="headerlink" title="ç¼–ç ä¸è§£ç "></a>ç¼–ç ä¸è§£ç </h2><p>ç¼–ç å°±æ˜¯æŠŠå­—ç¬¦è½¬æ¢ä¸ºå­—èŠ‚ï¼Œè€Œè§£ç æ˜¯æŠŠå­—èŠ‚é‡æ–°ç»„åˆæˆå­—ç¬¦ã€‚</p><p>å¦‚æœç¼–ç å’Œè§£ç è¿‡ç¨‹ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼é‚£ä¹ˆå°±å‡ºç°äº†ä¹±ç ã€‚</p><ul><li>GBK ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å  2 ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å  1 ä¸ªå­—èŠ‚ï¼›</li><li>UTF-8 ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å  3 ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å  1 ä¸ªå­—èŠ‚ï¼›</li><li>UTF-16be ç¼–ç ä¸­ï¼Œä¸­æ–‡å­—ç¬¦å’Œè‹±æ–‡å­—ç¬¦éƒ½å  2 ä¸ªå­—èŠ‚ã€‚</li></ul><p>UTF-16be ä¸­çš„ be æŒ‡çš„æ˜¯ Big Endianï¼Œä¹Ÿå°±æ˜¯å¤§ç«¯ã€‚ç›¸åº”åœ°ä¹Ÿæœ‰ UTF-16leï¼Œle æŒ‡çš„æ˜¯ Little Endianï¼Œä¹Ÿå°±æ˜¯å°ç«¯ã€‚</p><p>Java çš„å†…å­˜ç¼–ç ä½¿ç”¨åŒå­—èŠ‚ç¼–ç  UTF-16beï¼Œè¿™ä¸æ˜¯æŒ‡ Java åªæ”¯æŒè¿™ä¸€ç§ç¼–ç æ–¹å¼ï¼Œè€Œæ˜¯è¯´ char è¿™ç§ç±»å‹ä½¿ç”¨ UTF-16be è¿›è¡Œç¼–ç ã€‚char ç±»å‹å  16 ä½ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼ŒJava ä½¿ç”¨è¿™ç§åŒå­—èŠ‚ç¼–ç æ˜¯ä¸ºäº†è®©ä¸€ä¸ªä¸­æ–‡æˆ–è€…ä¸€ä¸ªè‹±æ–‡éƒ½èƒ½ä½¿ç”¨ä¸€ä¸ª char æ¥å­˜å‚¨ã€‚</p><h2 id="String-çš„ç¼–ç æ–¹å¼"><a href="#String-çš„ç¼–ç æ–¹å¼" class="headerlink" title="String çš„ç¼–ç æ–¹å¼"></a>String çš„ç¼–ç æ–¹å¼</h2><p>String å¯ä»¥çœ‹æˆä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†å®ƒç¼–ç ä¸ºå­—èŠ‚åºåˆ—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†ä¸€ä¸ªå­—èŠ‚åºåˆ—è§£ç ä¸º Stringã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String str1 = <span class="string">"ä¸­æ–‡"</span>;</span><br><span class="line"><span class="keyword">byte</span>[] bytes = str1.getBytes(<span class="string">"UTF-8"</span>);</span><br><span class="line">String str2 = <span class="keyword">new</span> String(bytes, <span class="string">"UTF-8"</span>);</span><br><span class="line">System.out.println(str2);</span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨æ— å‚æ•° getBytes() æ–¹æ³•æ—¶ï¼Œé»˜è®¤çš„ç¼–ç æ–¹å¼ä¸æ˜¯ UTF-16beã€‚åŒå­—èŠ‚ç¼–ç çš„å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ª char å­˜å‚¨ä¸­æ–‡å’Œè‹±æ–‡ï¼Œè€Œå°† String è½¬ä¸º bytes[] å­—èŠ‚æ•°ç»„å°±ä¸å†éœ€è¦è¿™ä¸ªå¥½å¤„ï¼Œå› æ­¤ä¹Ÿå°±ä¸å†éœ€è¦åŒå­—èŠ‚ç¼–ç ã€‚getBytes() çš„é»˜è®¤ç¼–ç æ–¹å¼ä¸å¹³å°æœ‰å…³ï¼Œä¸€èˆ¬ä¸º UTF-8ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] bytes = str1.getBytes();</span><br></pre></td></tr></table></figure><h2 id="Reader-ä¸-Writer"><a href="#Reader-ä¸-Writer" class="headerlink" title="Reader ä¸ Writer"></a>Reader ä¸ Writer</h2><p>ä¸ç®¡æ˜¯ç£ç›˜è¿˜æ˜¯ç½‘ç»œä¼ è¾“ï¼Œæœ€å°çš„å­˜å‚¨å•å…ƒéƒ½æ˜¯å­—èŠ‚ï¼Œè€Œä¸æ˜¯å­—ç¬¦ã€‚ä½†æ˜¯åœ¨ç¨‹åºä¸­æ“ä½œçš„é€šå¸¸æ˜¯å­—ç¬¦å½¢å¼çš„æ•°æ®ï¼Œå› æ­¤éœ€è¦æä¾›å¯¹å­—ç¬¦è¿›è¡Œæ“ä½œçš„æ–¹æ³•ã€‚</p><ul><li>InputStreamReader å®ç°ä»å­—èŠ‚æµè§£ç æˆå­—ç¬¦æµï¼›</li><li>OutputStreamWriter å®ç°å­—ç¬¦æµç¼–ç æˆä¸ºå­—èŠ‚æµã€‚</li></ul><h2 id="å®ç°é€è¡Œè¾“å‡ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹"><a href="#å®ç°é€è¡Œè¾“å‡ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹" class="headerlink" title="å®ç°é€è¡Œè¾“å‡ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹"></a>å®ç°é€è¡Œè¾“å‡ºæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readFileContent</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    FileReader fileReader = <span class="keyword">new</span> FileReader(filePath);</span><br><span class="line">    BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(fileReader);</span><br><span class="line"></span><br><span class="line">    String line;</span><br><span class="line">    <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(line);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è£…é¥°è€…æ¨¡å¼ä½¿å¾— BufferedReader ç»„åˆäº†ä¸€ä¸ª Reader å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// åœ¨è°ƒç”¨ BufferedReader çš„ close() æ–¹æ³•æ—¶ä¼šå»è°ƒç”¨ Reader çš„ close() æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// å› æ­¤åªè¦ä¸€ä¸ª close() è°ƒç”¨å³å¯</span></span><br><span class="line">    bufferedReader.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="äº”ã€å¯¹è±¡æ“ä½œ"><a href="#äº”ã€å¯¹è±¡æ“ä½œ" class="headerlink" title="äº”ã€å¯¹è±¡æ“ä½œ"></a>äº”ã€å¯¹è±¡æ“ä½œ</h1><h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><p>åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼Œæ–¹ä¾¿å­˜å‚¨å’Œä¼ è¾“ã€‚</p><ul><li>åºåˆ—åŒ–ï¼šObjectOutputStream.writeObject()</li><li>ååºåˆ—åŒ–ï¼šObjectInputStream.readObject()</li></ul><p>ä¸ä¼šå¯¹é™æ€å˜é‡è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºåºåˆ—åŒ–åªæ˜¯ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œé™æ€å˜é‡å±äºç±»çš„çŠ¶æ€ã€‚</p><h2 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h2><p>åºåˆ—åŒ–çš„ç±»éœ€è¦å®ç° Serializable æ¥å£ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•éœ€è¦å®ç°ï¼Œä½†æ˜¯å¦‚æœä¸å»å®ç°å®ƒçš„è¯è€Œè¿›è¡Œåºåˆ—åŒ–ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line"></span><br><span class="line">    A a1 = <span class="keyword">new</span> A(<span class="number">123</span>, <span class="string">"abc"</span>);</span><br><span class="line">    String objectFile = <span class="string">"file/a1"</span>;</span><br><span class="line"></span><br><span class="line">    ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(objectFile));</span><br><span class="line">    objectOutputStream.writeObject(a1);</span><br><span class="line">    objectOutputStream.close();</span><br><span class="line"></span><br><span class="line">    ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(objectFile));</span><br><span class="line">    A a2 = (A) objectInputStream.readObject();</span><br><span class="line">    objectInputStream.close();</span><br><span class="line">    System.out.println(a2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> String y;</span><br><span class="line"></span><br><span class="line">    A(<span class="keyword">int</span> x, String y) &#123;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"x = "</span> + x + <span class="string">"  "</span> + <span class="string">"y = "</span> + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="transient"><a href="#transient" class="headerlink" title="transient"></a>transient</h2><p>transient å…³é”®å­—å¯ä»¥ä½¿ä¸€äº›å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚</p><p>ArrayList ä¸­å­˜å‚¨æ•°æ®çš„æ•°ç»„ elementData æ˜¯ç”¨ transient ä¿®é¥°çš„ï¼Œå› ä¸ºè¿™ä¸ªæ•°ç»„æ˜¯åŠ¨æ€æ‰©å±•çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç©ºé—´éƒ½è¢«ä½¿ç”¨ï¼Œå› æ­¤å°±ä¸éœ€è¦æ‰€æœ‰çš„å†…å®¹éƒ½è¢«åºåˆ—åŒ–ã€‚é€šè¿‡é‡å†™åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ï¼Œä½¿å¾—å¯ä»¥åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å†…å®¹çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Object[] elementData;</span><br></pre></td></tr></table></figure><h1 id="å…­ã€ç½‘ç»œæ“ä½œ"><a href="#å…­ã€ç½‘ç»œæ“ä½œ" class="headerlink" title="å…­ã€ç½‘ç»œæ“ä½œ"></a>å…­ã€ç½‘ç»œæ“ä½œ</h1><p>Java ä¸­çš„ç½‘ç»œæ”¯æŒï¼š</p><ul><li>InetAddressï¼šç”¨äºè¡¨ç¤ºç½‘ç»œä¸Šçš„ç¡¬ä»¶èµ„æºï¼Œå³ IP åœ°å€ï¼›</li><li>URLï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼›</li><li>Socketsï¼šä½¿ç”¨ TCP åè®®å®ç°ç½‘ç»œé€šä¿¡ï¼›</li><li>Datagramï¼šä½¿ç”¨ UDP åè®®å®ç°ç½‘ç»œé€šä¿¡ã€‚</li></ul><h2 id="InetAddress"><a href="#InetAddress" class="headerlink" title="InetAddress"></a>InetAddress</h2><p>æ²¡æœ‰å…¬æœ‰çš„æ„é€ å‡½æ•°ï¼Œåªèƒ½é€šè¿‡é™æ€æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">InetAddress.getByName(String host);</span><br><span class="line">InetAddress.getByAddress(<span class="keyword">byte</span>[] address);</span><br></pre></td></tr></table></figure><h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>å¯ä»¥ç›´æ¥ä» URL ä¸­è¯»å–å­—èŠ‚æµæ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    URL url = <span class="keyword">new</span> URL(<span class="string">"http://www.baidu.com"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å­—èŠ‚æµ */</span></span><br><span class="line">    InputStream is = url.openStream();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å­—ç¬¦æµ */</span></span><br><span class="line">    InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(is, <span class="string">"utf-8"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æä¾›ç¼“å­˜åŠŸèƒ½ */</span></span><br><span class="line">    BufferedReader br = <span class="keyword">new</span> BufferedReader(isr);</span><br><span class="line"></span><br><span class="line">    String line;</span><br><span class="line">    <span class="keyword">while</span> ((line = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(line);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    br.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Sockets"><a href="#Sockets" class="headerlink" title="Sockets"></a>Sockets</h2><ul><li>ServerSocketï¼šæœåŠ¡å™¨ç«¯ç±»</li><li>Socketï¼šå®¢æˆ·ç«¯ç±»</li><li>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šè¿‡ InputStream å’Œ OutputStream è¿›è¡Œè¾“å…¥è¾“å‡ºã€‚</li></ul><p><div align="center"> <img src="pics/1e6affc4-18e5-4596-96ef-fb84c63bf88a.png" width="550px"> </div><br></p><h2 id="Datagram"><a href="#Datagram" class="headerlink" title="Datagram"></a>Datagram</h2><ul><li>DatagramSocketï¼šé€šä¿¡ç±»</li><li>DatagramPacketï¼šæ•°æ®åŒ…ç±»</li></ul><h1 id="ä¸ƒã€NIO"><a href="#ä¸ƒã€NIO" class="headerlink" title="ä¸ƒã€NIO"></a>ä¸ƒã€NIO</h1><p>æ–°çš„è¾“å…¥/è¾“å‡º (NIO) åº“æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ï¼Œå¼¥è¡¥äº†åŸæ¥çš„ I/O çš„ä¸è¶³ï¼Œæä¾›äº†é«˜é€Ÿçš„ã€é¢å‘å—çš„ I/Oã€‚</p><h2 id="æµä¸å—"><a href="#æµä¸å—" class="headerlink" title="æµä¸å—"></a>æµä¸å—</h2><p>I/O ä¸ NIO æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼ŒI/O ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</p><p>é¢å‘æµçš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼šä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ï¼Œé“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ I/O é€šå¸¸ç›¸å½“æ…¢ã€‚</p><p>é¢å‘å—çš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼ŒæŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰æµå¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚</p><p>I/O åŒ…å’Œ NIO å·²ç»å¾ˆå¥½åœ°é›†æˆäº†ï¼Œjava.io.* å·²ç»ä»¥ NIO ä¸ºåŸºç¡€é‡æ–°å®ç°äº†ï¼Œæ‰€ä»¥ç°åœ¨å®ƒå¯ä»¥åˆ©ç”¨ NIO çš„ä¸€äº›ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œjava.io.* åŒ…ä¸­çš„ä¸€äº›ç±»åŒ…å«ä»¥å—çš„å½¢å¼è¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—å³ä½¿åœ¨é¢å‘æµçš„ç³»ç»Ÿä¸­ï¼Œå¤„ç†é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚</p><h2 id="é€šé“ä¸ç¼“å†²åŒº"><a href="#é€šé“ä¸ç¼“å†²åŒº" class="headerlink" title="é€šé“ä¸ç¼“å†²åŒº"></a>é€šé“ä¸ç¼“å†²åŒº</h2><h3 id="1-é€šé“"><a href="#1-é€šé“" class="headerlink" title="1. é€šé“"></a>1. é€šé“</h3><p>é€šé“ Channel æ˜¯å¯¹åŸ I/O åŒ…ä¸­çš„æµçš„æ¨¡æ‹Ÿï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ã€‚</p><p>é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæµåªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç§»åŠ¨(ä¸€ä¸ªæµå¿…é¡»æ˜¯ InputStream æˆ–è€… OutputStream çš„å­ç±»)ï¼Œè€Œé€šé“æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ç”¨äºè¯»ã€å†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚</p><p>é€šé“åŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š</p><ul><li>FileChannelï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼›</li><li>DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›</li><li>SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›</li><li>ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚</li></ul><h3 id="2-ç¼“å†²åŒº"><a href="#2-ç¼“å†²åŒº" class="headerlink" title="2. ç¼“å†²åŒº"></a>2. ç¼“å†²åŒº</h3><p>å‘é€ç»™ä¸€ä¸ªé€šé“çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»é¦–å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­ï¼ŒåŒæ ·åœ°ï¼Œä»é€šé“ä¸­è¯»å–çš„ä»»ä½•æ•°æ®éƒ½è¦å…ˆè¯»åˆ°ç¼“å†²åŒºä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šç›´æ¥å¯¹é€šé“è¿›è¡Œè¯»å†™æ•°æ®ï¼Œè€Œæ˜¯è¦å…ˆç»è¿‡ç¼“å†²åŒºã€‚</p><p>ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»/å†™è¿›ç¨‹ã€‚</p><p>ç¼“å†²åŒºåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š</p><ul><li>ByteBuffer</li><li>CharBuffer</li><li>ShortBuffer</li><li>IntBuffer</li><li>LongBuffer</li><li>FloatBuffer</li><li>DoubleBuffer</li></ul><h2 id="ç¼“å†²åŒºçŠ¶æ€å˜é‡"><a href="#ç¼“å†²åŒºçŠ¶æ€å˜é‡" class="headerlink" title="ç¼“å†²åŒºçŠ¶æ€å˜é‡"></a>ç¼“å†²åŒºçŠ¶æ€å˜é‡</h2><ul><li>capacityï¼šæœ€å¤§å®¹é‡ï¼›</li><li>positionï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼›</li><li>limitï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚</li></ul><p>çŠ¶æ€å˜é‡çš„æ”¹å˜è¿‡ç¨‹ä¸¾ä¾‹ï¼š</p><p>â‘  æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚</p><p><div align="center"> <img src="pics/1bea398f-17a7-4f67-a90b-9e2d243eaa9a.png"> </div><br></p><p>â‘¡ ä»è¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚</p><p><div align="center"> <img src="pics/80804f52-8815-4096-b506-48eef3eed5c6.png"> </div><br></p><p>â‘¢ åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ flip() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0ã€‚</p><p><div align="center"> <img src="pics/952e06bd-5a65-4cab-82e4-dd1536462f38.png"> </div><br></p><p>â‘£ ä»ç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚</p><p><div align="center"> <img src="pics/b5bdcbe2-b958-4aef-9151-6ad963cb28b4.png"> </div><br></p><p>â‘¤ æœ€åéœ€è¦è°ƒç”¨ clear() æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚</p><p><div align="center"> <img src="pics/67bf5487-c45d-49b6-b9c0-a058d8c68902.png"> </div><br></p><h2 id="æ–‡ä»¶-NIO-å®ä¾‹"><a href="#æ–‡ä»¶-NIO-å®ä¾‹" class="headerlink" title="æ–‡ä»¶ NIO å®ä¾‹"></a>æ–‡ä»¶ NIO å®ä¾‹</h2><p>ä»¥ä¸‹å±•ç¤ºäº†ä½¿ç”¨ NIO å¿«é€Ÿå¤åˆ¶æ–‡ä»¶çš„å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fastCopy</span><span class="params">(String src, String dist)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è·å¾—æºæ–‡ä»¶çš„è¾“å…¥å­—èŠ‚æµ */</span></span><br><span class="line">    FileInputStream fin = <span class="keyword">new</span> FileInputStream(src);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è·å–è¾“å…¥å­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */</span></span><br><span class="line">    FileChannel fcin = fin.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºå­—èŠ‚æµ */</span></span><br><span class="line">    FileOutputStream fout = <span class="keyword">new</span> FileOutputStream(dist);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è·å–è¾“å‡ºå­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */</span></span><br><span class="line">    FileChannel fcout = fout.getChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ä¸ºç¼“å†²åŒºåˆ†é… 1024 ä¸ªå­—èŠ‚ */</span></span><br><span class="line">    ByteBuffer buffer = ByteBuffer.allocateDirect(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* ä»è¾“å…¥é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ */</span></span><br><span class="line">        <span class="keyword">int</span> r = fcin.read(buffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* read() è¿”å› -1 è¡¨ç¤º EOF */</span></span><br><span class="line">        <span class="keyword">if</span> (r == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* åˆ‡æ¢è¯»å†™ */</span></span><br><span class="line">        buffer.flip();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* æŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæ–‡ä»¶ä¸­ */</span></span><br><span class="line">        fcout.write(buffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* æ¸…ç©ºç¼“å†²åŒº */</span></span><br><span class="line">        buffer.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€‰æ‹©å™¨"><a href="#é€‰æ‹©å™¨" class="headerlink" title="é€‰æ‹©å™¨"></a>é€‰æ‹©å™¨</h2><p>NIO å¸¸å¸¸è¢«å«åšéé˜»å¡ IOï¼Œä¸»è¦æ˜¯å› ä¸º NIO åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„éé˜»å¡ç‰¹æ€§è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p><p>NIO å®ç°äº† IO å¤šè·¯å¤ç”¨ä¸­çš„ Reactor æ¨¡å‹ï¼Œä¸€ä¸ªçº¿ç¨‹ Thread ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ªé€šé“ Channel ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚</p><p>é€šè¿‡é…ç½®ç›‘å¬çš„é€šé“ Channel ä¸ºéé˜»å¡ï¼Œé‚£ä¹ˆå½“ Channel ä¸Šçš„ IO äº‹ä»¶è¿˜æœªåˆ°è¾¾æ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­è½®è¯¢å…¶å®ƒ Channelï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„ Channel æ‰§è¡Œã€‚</p><p>å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶ï¼Œå¯¹äº IO å¯†é›†å‹çš„åº”ç”¨å…·æœ‰å¾ˆå¥½åœ°æ€§èƒ½ã€‚</p><p>åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰å¥—æ¥å­— Channel æ‰èƒ½é…ç½®ä¸ºéé˜»å¡ï¼Œè€Œ FileChannel ä¸èƒ½ï¼Œä¸º FileChannel é…ç½®éé˜»å¡ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚</p><p><div align="center"> <img src="pics/093f9e57-429c-413a-83ee-c689ba596cef.png" width="350px"> </div><br></p><h3 id="1-åˆ›å»ºé€‰æ‹©å™¨"><a href="#1-åˆ›å»ºé€‰æ‹©å™¨" class="headerlink" title="1. åˆ›å»ºé€‰æ‹©å™¨"></a>1. åˆ›å»ºé€‰æ‹©å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = Selector.open();</span><br></pre></td></tr></table></figure><h3 id="2-å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š"><a href="#2-å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š" class="headerlink" title="2. å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š"></a>2. å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ServerSocketChannel ssChannel = ServerSocketChannel.open();</span><br><span class="line">ssChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">ssChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br></pre></td></tr></table></figure><p>é€šé“å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½å»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚</p><p>åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>SelectionKey.OP_CONNECT</li><li>SelectionKey.OP_ACCEPT</li><li>SelectionKey.OP_READ</li><li>SelectionKey.OP_WRITE</li></ul><p>å®ƒä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> OP_READ = <span class="number">1</span> &lt;&lt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> OP_WRITE = <span class="number">1</span> &lt;&lt; <span class="number">2</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> OP_CONNECT = <span class="number">1</span> &lt;&lt; <span class="number">3</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> OP_ACCEPT = <span class="number">1</span> &lt;&lt; <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶å¯ä»¥è¢«å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»è€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;</span><br></pre></td></tr></table></figure><h3 id="3-ç›‘å¬äº‹ä»¶"><a href="#3-ç›‘å¬äº‹ä»¶" class="headerlink" title="3. ç›‘å¬äº‹ä»¶"></a>3. ç›‘å¬äº‹ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> num = selector.select();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ select() æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚</p><h3 id="4-è·å–åˆ°è¾¾çš„äº‹ä»¶"><a href="#4-è·å–åˆ°è¾¾çš„äº‹ä»¶" class="headerlink" title="4. è·å–åˆ°è¾¾çš„äº‹ä»¶"></a>4. è·å–åˆ°è¾¾çš„äº‹ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator();</span><br><span class="line"><span class="keyword">while</span> (keyIterator.hasNext()) &#123;</span><br><span class="line">    SelectionKey key = keyIterator.next();</span><br><span class="line">    <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    keyIterator.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-äº‹ä»¶å¾ªç¯"><a href="#5-äº‹ä»¶å¾ªç¯" class="headerlink" title="5. äº‹ä»¶å¾ªç¯"></a>5. äº‹ä»¶å¾ªç¯</h3><p>å› ä¸ºä¸€æ¬¡ select() è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="keyword">int</span> num = selector.select();</span><br><span class="line">    Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">    Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator();</span><br><span class="line">    <span class="keyword">while</span> (keyIterator.hasNext()) &#123;</span><br><span class="line">        SelectionKey key = keyIterator.next();</span><br><span class="line">        <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        keyIterator.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¥—æ¥å­—-NIO-å®ä¾‹"><a href="#å¥—æ¥å­—-NIO-å®ä¾‹" class="headerlink" title="å¥—æ¥å­— NIO å®ä¾‹"></a>å¥—æ¥å­— NIO å®ä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NIOServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line"></span><br><span class="line">        ServerSocketChannel ssChannel = ServerSocketChannel.open();</span><br><span class="line">        ssChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        ssChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        ServerSocket serverSocket = ssChannel.socket();</span><br><span class="line">        InetSocketAddress address = <span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8888</span>);</span><br><span class="line">        serverSocket.bind(address);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            selector.select();</span><br><span class="line">            Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (keyIterator.hasNext()) &#123;</span><br><span class="line"></span><br><span class="line">                SelectionKey key = keyIterator.next();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line"></span><br><span class="line">                    ServerSocketChannel ssChannel1 = (ServerSocketChannel) key.channel();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª SocketChannel</span></span><br><span class="line">                    SocketChannel sChannel = ssChannel1.accept();</span><br><span class="line">                    sChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// è¿™ä¸ªæ–°è¿æ¥ä¸»è¦ç”¨äºä»å®¢æˆ·ç«¯è¯»å–æ•°æ®</span></span><br><span class="line">                    sChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line"></span><br><span class="line">                    SocketChannel sChannel = (SocketChannel) key.channel();</span><br><span class="line">                    System.out.println(readDataFromSocketChannel(sChannel));</span><br><span class="line">                    sChannel.close();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                keyIterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">readDataFromSocketChannel</span><span class="params">(SocketChannel sChannel)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        StringBuilder data = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            buffer.clear();</span><br><span class="line">            <span class="keyword">int</span> n = sChannel.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (n == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            buffer.flip();</span><br><span class="line">            <span class="keyword">int</span> limit = buffer.limit();</span><br><span class="line">            <span class="keyword">char</span>[] dst = <span class="keyword">new</span> <span class="keyword">char</span>[limit];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; limit; i++) &#123;</span><br><span class="line">                dst[i] = (<span class="keyword">char</span>) buffer.get(i);</span><br><span class="line">            &#125;</span><br><span class="line">            data.append(dst);</span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NIOClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>, <span class="number">8888</span>);</span><br><span class="line">        OutputStream out = socket.getOutputStream();</span><br><span class="line">        String s = <span class="string">"hello world"</span>;</span><br><span class="line">        out.write(s.getBytes());</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å†…å­˜æ˜ å°„æ–‡ä»¶"><a href="#å†…å­˜æ˜ å°„æ–‡ä»¶" class="headerlink" title="å†…å­˜æ˜ å°„æ–‡ä»¶"></a>å†…å­˜æ˜ å°„æ–‡ä»¶</h2><p>å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€šé“çš„ I/O å¿«å¾—å¤šã€‚</p><p>å‘å†…å­˜æ˜ å°„æ–‡ä»¶å†™å…¥å¯èƒ½æ˜¯å±é™©çš„ï¼Œåªæ˜¯æ”¹å˜æ•°ç»„çš„å•ä¸ªå…ƒç´ è¿™æ ·çš„ç®€å•æ“ä½œï¼Œå°±å¯èƒ½ä¼šç›´æ¥ä¿®æ”¹ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ä¿®æ”¹æ•°æ®ä¸å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜æ˜¯æ²¡æœ‰åˆ†å¼€çš„ã€‚</p><p>ä¸‹é¢ä»£ç è¡Œå°†æ–‡ä»¶çš„å‰ 1024 ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œmap() æ–¹æ³•è¿”å›ä¸€ä¸ª MappedByteBufferï¼Œå®ƒæ˜¯ ByteBuffer çš„å­ç±»ã€‚å› æ­¤ï¼Œå¯ä»¥åƒä½¿ç”¨å…¶ä»–ä»»ä½• ByteBuffer ä¸€æ ·ä½¿ç”¨æ–°æ˜ å°„çš„ç¼“å†²åŒºï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨éœ€è¦æ—¶è´Ÿè´£æ‰§è¡Œæ˜ å°„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MappedByteBuffer mbb = fc.map(FileChannel.MapMode.READ_WRITE, <span class="number">0</span>, <span class="number">1024</span>);</span><br></pre></td></tr></table></figure><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><p>NIO ä¸æ™®é€š I/O çš„åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>NIO æ˜¯éé˜»å¡çš„ï¼›</li><li>NIO é¢å‘å—ï¼ŒI/O é¢å‘æµã€‚</li></ul><h1 id="å…«ã€å‚è€ƒèµ„æ–™"><a href="#å…«ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å…«ã€å‚è€ƒèµ„æ–™"></a>å…«ã€å‚è€ƒèµ„æ–™</h1><ul><li>Eckel B, åŸƒå…‹å°”, æ˜Šé¹, ç­‰. Java ç¼–ç¨‹æ€æƒ³ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002.</li><li><a href="https://www.ibm.com/developerworks/cn/education/java/j-nio/j-nio.html" target="_blank" rel="noopener">IBM: NIO å…¥é—¨</a></li><li><a href="http://tutorials.jenkov.com/java-nio/index.html" target="_blank" rel="noopener">Java NIO Tutorial</a></li><li><a href="https://tech.meituan.com/nio.html" target="_blank" rel="noopener">Java NIO æµ…æ</a></li><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-javaio/index.html" target="_blank" rel="noopener">IBM: æ·±å…¥åˆ†æ Java I/O çš„å·¥ä½œæœºåˆ¶</a></li><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-chinesecoding/index.html" target="_blank" rel="noopener">IBM: æ·±å…¥åˆ†æ Java ä¸­çš„ä¸­æ–‡ç¼–ç é—®é¢˜</a></li><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-serial/index.html" target="_blank" rel="noopener">IBM: Java åºåˆ—åŒ–çš„é«˜çº§è®¤è¯†</a></li><li><a href="http://blog.csdn.net/shimiso/article/details/24990499" target="_blank" rel="noopener">NIO ä¸ä¼ ç»Ÿ IO çš„åŒºåˆ«</a></li><li><a href="http://stg-tud.github.io/sedc/Lecture/ws13-14/5.3-Decorator.html#mode=document" target="_blank" rel="noopener">Decorator Design Pattern</a></li><li><a href="http://labojava.blogspot.com/2012/12/socket-multicast.html" target="_blank" rel="noopener">Socket Multicast</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä¸€ã€æ¦‚è§ˆ&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è§ˆ&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è§ˆ&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è§ˆ&lt;/h1&gt;&lt;p&gt;Java çš„ I/O å¤§æ¦‚å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>ç¼“å­˜ç›¸å…³</title>
    <link href="http://yoursite.com/2018/11/22/%E7%BC%93%E5%AD%98/"/>
    <id>http://yoursite.com/2018/11/22/ç¼“å­˜/</id>
    <published>2018-11-22T13:33:00.000Z</published>
    <updated>2019-06-28T14:39:46.222Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å…³äºç¼“å­˜"><a href="#å…³äºç¼“å­˜" class="headerlink" title="å…³äºç¼“å­˜"></a>å…³äºç¼“å­˜</h1><h1 id="ä¸€ã€ç¼“å­˜ç‰¹å¾"><a href="#ä¸€ã€ç¼“å­˜ç‰¹å¾" class="headerlink" title="ä¸€ã€ç¼“å­˜ç‰¹å¾"></a>ä¸€ã€ç¼“å­˜ç‰¹å¾</h1><h2 id="å‘½ä¸­ç‡"><a href="#å‘½ä¸­ç‡" class="headerlink" title="å‘½ä¸­ç‡"></a>å‘½ä¸­ç‡</h2><p>å½“æŸä¸ªè¯·æ±‚èƒ½å¤Ÿé€šè¿‡è®¿é—®ç¼“å­˜è€Œå¾—åˆ°å“åº”æ—¶ï¼Œç§°ä¸ºç¼“å­˜å‘½ä¸­ã€‚</p><p>ç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œç¼“å­˜çš„åˆ©ç”¨ç‡ä¹Ÿå°±è¶Šé«˜ã€‚<br><a id="more"></a></p><h2 id="æœ€å¤§ç©ºé—´"><a href="#æœ€å¤§ç©ºé—´" class="headerlink" title="æœ€å¤§ç©ºé—´"></a>æœ€å¤§ç©ºé—´</h2><p>ç¼“å­˜é€šå¸¸ä½äºå†…å­˜ä¸­ï¼Œå†…å­˜çš„ç©ºé—´é€šå¸¸æ¯”ç£ç›˜ç©ºé—´å°çš„å¤šï¼Œå› æ­¤ç¼“å­˜çš„æœ€å¤§ç©ºé—´ä¸å¯èƒ½éå¸¸å¤§ã€‚</p><p>å½“ç¼“å­˜å­˜æ”¾çš„æ•°æ®é‡è¶…è¿‡æœ€å¤§ç©ºé—´æ—¶ï¼Œå°±éœ€è¦æ·˜æ±°éƒ¨åˆ†æ•°æ®æ¥å­˜æ”¾æ–°åˆ°è¾¾çš„æ•°æ®ã€‚</p><h2 id="æ·˜æ±°ç­–ç•¥"><a href="#æ·˜æ±°ç­–ç•¥" class="headerlink" title="æ·˜æ±°ç­–ç•¥"></a>æ·˜æ±°ç­–ç•¥</h2><ul><li><p>FIFOï¼ˆFirst In First Outï¼‰ï¼šå…ˆè¿›å…ˆå‡ºç­–ç•¥ï¼Œåœ¨å®æ—¶æ€§çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦ç»å¸¸è®¿é—®æœ€æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ FIFOï¼Œä½¿å¾—æœ€å…ˆè¿›å…¥çš„æ•°æ®ï¼ˆæœ€æ™šçš„æ•°æ®ï¼‰è¢«æ·˜æ±°ã€‚</p></li><li><p>LRUï¼ˆLeast Recently Usedï¼‰ï¼šæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç­–ç•¥ï¼Œä¼˜å…ˆæ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ¬¡è¢«è®¿é—®æ—¶é—´è·ç¦»ç°åœ¨æœ€ä¹…çš„æ•°æ®ã€‚è¯¥ç­–ç•¥å¯ä»¥ä¿è¯å†…å­˜ä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç»å¸¸è¢«è®¿é—®çš„æ•°æ®ï¼Œä»è€Œä¿è¯ç¼“å­˜å‘½ä¸­ç‡ã€‚</p></li><li><p>LFUï¼ˆLeast Frequently Usedï¼‰ï¼šæœ€ä¸ç»å¸¸ä½¿ç”¨ç­–ç•¥ï¼Œä¼˜å…ˆæ·˜æ±°ä¸€æ®µæ—¶é—´å†…ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„æ•°æ®ã€‚</p></li></ul><h1 id="äºŒã€LRU"><a href="#äºŒã€LRU" class="headerlink" title="äºŒã€LRU"></a>äºŒã€LRU</h1><p>ä»¥ä¸‹æ˜¯åŸºäº åŒå‘é“¾è¡¨ + HashMap çš„ LRU ç®—æ³•å®ç°ï¼Œå¯¹ç®—æ³•çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>è®¿é—®æŸä¸ªèŠ‚ç‚¹æ—¶ï¼Œå°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œå¹¶é‡æ–°æ’å…¥åˆ°é“¾è¡¨å¤´éƒ¨ã€‚è¿™æ ·å°±èƒ½ä¿è¯é“¾è¡¨å°¾éƒ¨å­˜å‚¨çš„å°±æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œå½“èŠ‚ç‚¹æ•°é‡å¤§äºç¼“å­˜æœ€å¤§ç©ºé—´æ—¶å°±æ·˜æ±°é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹ã€‚</li><li>ä¸ºäº†ä½¿åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå°±ä¸èƒ½é‡‡ç”¨éå†çš„æ–¹å¼æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹ã€‚HashMap å­˜å‚¨ç€ Key åˆ°èŠ‚ç‚¹çš„æ˜ å°„ï¼Œé€šè¿‡ Key å°±èƒ½ä»¥ O(1) çš„æ—¶é—´å¾—åˆ°èŠ‚ç‚¹ï¼Œç„¶åå†ä»¥ O(1) çš„æ—¶é—´å°†å…¶ä»åŒå‘é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LRU</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">K</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> Node tail;</span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;K, Node&gt; map;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Node pre;</span><br><span class="line">        Node next;</span><br><span class="line">        K k;</span><br><span class="line">        V v;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(K k, V v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.k = k;</span><br><span class="line">            <span class="keyword">this</span>.v = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LRU</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.maxSize = maxSize;</span><br><span class="line">        <span class="keyword">this</span>.map = <span class="keyword">new</span> HashMap&lt;&gt;(maxSize * <span class="number">4</span> / <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        head = <span class="keyword">new</span> Node(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        tail = <span class="keyword">new</span> Node(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.pre = head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(key)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node node = map.get(key);</span><br><span class="line">        unlink(node);</span><br><span class="line">        appendHead(node);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node.v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            Node node = map.get(key);</span><br><span class="line">            unlink(node);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node node = <span class="keyword">new</span> Node(key, value);</span><br><span class="line">        map.put(key, node);</span><br><span class="line">        appendHead(node);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (map.size() &gt; maxSize) &#123;</span><br><span class="line">            Node toRemove = removeTail();</span><br><span class="line">            map.remove(toRemove.k);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unlink</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Node pre = node.pre;</span><br><span class="line">        Node next = node.next;</span><br><span class="line"></span><br><span class="line">        pre.next = next;</span><br><span class="line">        next.pre = pre;</span><br><span class="line"></span><br><span class="line">        node.pre = <span class="keyword">null</span>;</span><br><span class="line">        node.next = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">appendHead</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        Node next = head.next;</span><br><span class="line">        node.next = next;</span><br><span class="line">        next.pre = node;</span><br><span class="line">        node.pre = head;</span><br><span class="line">        head.next = node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">removeTail</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Node node = tail.pre;</span><br><span class="line"></span><br><span class="line">        Node pre = node.pre;</span><br><span class="line">        tail.pre = pre;</span><br><span class="line">        pre.next = tail;</span><br><span class="line"></span><br><span class="line">        node.pre = <span class="keyword">null</span>;</span><br><span class="line">        node.next = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;K&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;K&gt;() &#123;</span><br><span class="line">            <span class="keyword">private</span> Node cur = head.next;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> cur != tail;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> K <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Node node = cur;</span><br><span class="line">                cur = cur.next;</span><br><span class="line">                <span class="keyword">return</span> node.k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸‰ã€ç¼“å­˜ä½ç½®"><a href="#ä¸‰ã€ç¼“å­˜ä½ç½®" class="headerlink" title="ä¸‰ã€ç¼“å­˜ä½ç½®"></a>ä¸‰ã€ç¼“å­˜ä½ç½®</h1><h2 id="æµè§ˆå™¨"><a href="#æµè§ˆå™¨" class="headerlink" title="æµè§ˆå™¨"></a>æµè§ˆå™¨</h2><p>å½“ HTTP å“åº”å…è®¸è¿›è¡Œç¼“å­˜æ—¶ï¼Œæµè§ˆå™¨ä¼šå°† HTMLã€CSSã€JavaScriptã€å›¾ç‰‡ç­‰é™æ€èµ„æºè¿›è¡Œç¼“å­˜ã€‚</p><h2 id="ISP"><a href="#ISP" class="headerlink" title="ISP"></a>ISP</h2><p>ç½‘ç»œæœåŠ¡æä¾›å•†ï¼ˆISPï¼‰æ˜¯ç½‘ç»œè®¿é—®çš„ç¬¬ä¸€è·³ï¼Œé€šè¿‡å°†æ•°æ®ç¼“å­˜åœ¨ ISP ä¸­èƒ½å¤Ÿå¤§å¤§æé«˜ç”¨æˆ·çš„è®¿é—®é€Ÿåº¦ã€‚</p><h2 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h2><p>åå‘ä»£ç†ä½äºæœåŠ¡å™¨ä¹‹å‰ï¼Œè¯·æ±‚ä¸å“åº”éƒ½éœ€è¦ç»è¿‡åå‘ä»£ç†ã€‚é€šè¿‡å°†æ•°æ®ç¼“å­˜åœ¨åå‘ä»£ç†ï¼Œåœ¨ç”¨æˆ·è¯·æ±‚åå‘ä»£ç†æ—¶å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜è¿›è¡Œå“åº”ã€‚</p><h2 id="æœ¬åœ°ç¼“å­˜"><a href="#æœ¬åœ°ç¼“å­˜" class="headerlink" title="æœ¬åœ°ç¼“å­˜"></a>æœ¬åœ°ç¼“å­˜</h2><p>ä½¿ç”¨ Guava Cache å°†æ•°æ®ç¼“å­˜åœ¨æœåŠ¡å™¨æœ¬åœ°å†…å­˜ä¸­ï¼ŒæœåŠ¡å™¨ä»£ç å¯ä»¥ç›´æ¥è¯»å–æœ¬åœ°å†…å­˜ä¸­çš„ç¼“å­˜ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚</p><h2 id="åˆ†å¸ƒå¼ç¼“å­˜"><a href="#åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜"></a>åˆ†å¸ƒå¼ç¼“å­˜</h2><p>ä½¿ç”¨ Redisã€Memcache ç­‰åˆ†å¸ƒå¼ç¼“å­˜å°†æ•°æ®ç¼“å­˜åœ¨åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿä¸­ã€‚</p><p>ç›¸å¯¹äºæœ¬åœ°ç¼“å­˜æ¥è¯´ï¼Œåˆ†å¸ƒå¼ç¼“å­˜å•ç‹¬éƒ¨ç½²ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚åˆ†é…ç¡¬ä»¶èµ„æºã€‚ä¸ä»…å¦‚æ­¤ï¼ŒæœåŠ¡å™¨é›†ç¾¤éƒ½å¯ä»¥è®¿é—®åˆ†å¸ƒå¼ç¼“å­˜ï¼Œè€Œæœ¬åœ°ç¼“å­˜éœ€è¦åœ¨æœåŠ¡å™¨é›†ç¾¤ä¹‹é—´è¿›è¡ŒåŒæ­¥ï¼Œå®ç°éš¾åº¦å’Œæ€§èƒ½å¼€é”€ä¸Šéƒ½éå¸¸å¤§ã€‚</p><h2 id="æ•°æ®åº“ç¼“å­˜"><a href="#æ•°æ®åº“ç¼“å­˜" class="headerlink" title="æ•°æ®åº“ç¼“å­˜"></a>æ•°æ®åº“ç¼“å­˜</h2><p>MySQL ç­‰æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå…·æœ‰è‡ªå·±çš„æŸ¥è¯¢ç¼“å­˜æœºåˆ¶æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><h2 id="Java-å†…éƒ¨çš„ç¼“å­˜"><a href="#Java-å†…éƒ¨çš„ç¼“å­˜" class="headerlink" title="Java å†…éƒ¨çš„ç¼“å­˜"></a>Java å†…éƒ¨çš„ç¼“å­˜</h2><p>Java ä¸ºäº†ä¼˜åŒ–ç©ºé—´ï¼Œæé«˜å­—ç¬¦ä¸²ã€åŸºæœ¬æ•°æ®ç±»å‹åŒ…è£…ç±»çš„åˆ›å»ºæ•ˆç‡ï¼Œè®¾è®¡äº†å­—ç¬¦ä¸²å¸¸é‡æ± åŠ Byteã€Shortã€Characterã€Integerã€Longã€Boolean è¿™å…­ç§åŒ…è£…ç±»ç¼“å†²æ± ã€‚</p><h2 id="CPU-å¤šçº§ç¼“å­˜"><a href="#CPU-å¤šçº§ç¼“å­˜" class="headerlink" title="CPU å¤šçº§ç¼“å­˜"></a>CPU å¤šçº§ç¼“å­˜</h2><p>CPU ä¸ºäº†è§£å†³è¿ç®—é€Ÿåº¦ä¸ä¸»å­˜ IO é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå¼•å…¥äº†å¤šçº§ç¼“å­˜ç»“æ„ï¼ŒåŒæ—¶ä½¿ç”¨ MESI ç­‰ç¼“å­˜ä¸€è‡´æ€§åè®®æ¥è§£å†³å¤šæ ¸ CPU ç¼“å­˜æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><h1 id="å››ã€CDN"><a href="#å››ã€CDN" class="headerlink" title="å››ã€CDN"></a>å››ã€CDN</h1><p>å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆContent distribution networkï¼ŒCDNï¼‰æ˜¯ä¸€ç§äº’è¿çš„ç½‘ç»œç³»ç»Ÿï¼Œå®ƒåˆ©ç”¨æ›´é è¿‘ç”¨æˆ·çš„æœåŠ¡å™¨ä»è€Œæ›´å¿«æ›´å¯é åœ°å°† HTMLã€CSSã€JavaScriptã€éŸ³ä¹ã€å›¾ç‰‡ã€è§†é¢‘ç­‰é™æ€èµ„æºåˆ†å‘ç»™ç”¨æˆ·ã€‚</p><p>CDN ä¸»è¦æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>æ›´å¿«åœ°å°†æ•°æ®åˆ†å‘ç»™ç”¨æˆ·ï¼›</li><li>é€šè¿‡éƒ¨ç½²å¤šå°æœåŠ¡å™¨ï¼Œä»è€Œæé«˜ç³»ç»Ÿæ•´ä½“çš„å¸¦å®½æ€§èƒ½ï¼›</li><li>å¤šå°æœåŠ¡å™¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§å†—ä½™æœºåˆ¶ï¼Œä»è€Œå…·æœ‰é«˜å¯ç”¨æ€§ã€‚</li></ul><p><div align="center"> <img src="pics/15313ed8-a520-4799-a300-2b6b36be314f.jpg"> </div><br></p><h1 id="äº”ã€ç¼“å­˜é—®é¢˜"><a href="#äº”ã€ç¼“å­˜é—®é¢˜" class="headerlink" title="äº”ã€ç¼“å­˜é—®é¢˜"></a>äº”ã€ç¼“å­˜é—®é¢˜</h1><h2 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h2><p>æŒ‡çš„æ˜¯å¯¹æŸä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®è¿›è¡Œè¯·æ±‚ï¼Œè¯¥è¯·æ±‚å°†ä¼šç©¿é€ç¼“å­˜åˆ°è¾¾æ•°æ®åº“ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>å¯¹è¿™äº›ä¸å­˜åœ¨çš„æ•°æ®ç¼“å­˜ä¸€ä¸ªç©ºæ•°æ®ï¼›</li><li>å¯¹è¿™ç±»è¯·æ±‚è¿›è¡Œè¿‡æ»¤ã€‚</li></ul><h2 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h2><p>æŒ‡çš„æ˜¯ç”±äºæ•°æ®æ²¡æœ‰è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œæˆ–è€…ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯å¤±æ•ˆï¼ˆè¿‡æœŸï¼‰ï¼Œåˆæˆ–è€…ç¼“å­˜æœåŠ¡å™¨å®•æœºï¼Œå¯¼è‡´å¤§é‡çš„è¯·æ±‚éƒ½åˆ°è¾¾æ•°æ®åº“ã€‚</p><p>åœ¨æœ‰ç¼“å­˜çš„ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿéå¸¸ä¾èµ–äºç¼“å­˜ï¼Œç¼“å­˜åˆ†æ‹…äº†å¾ˆå¤§ä¸€éƒ¨åˆ†çš„æ•°æ®è¯·æ±‚ã€‚å½“å‘ç”Ÿç¼“å­˜é›ªå´©æ—¶ï¼Œæ•°æ®åº“æ— æ³•å¤„ç†è¿™ä¹ˆå¤§çš„è¯·æ±‚ï¼Œå¯¼è‡´æ•°æ®åº“å´©æºƒã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ä¸ºäº†é˜²æ­¢ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯è¿‡æœŸå¯¼è‡´çš„ç¼“å­˜é›ªå´©ï¼Œå¯ä»¥é€šè¿‡è§‚å¯Ÿç”¨æˆ·è¡Œä¸ºï¼Œåˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´æ¥å®ç°ï¼›</li><li>ä¸ºäº†é˜²æ­¢ç¼“å­˜æœåŠ¡å™¨å®•æœºå‡ºç°çš„ç¼“å­˜é›ªå´©ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼Œåˆ†å¸ƒå¼ç¼“å­˜ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹åªç¼“å­˜éƒ¨åˆ†çš„æ•°æ®ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶å¯ä»¥ä¿è¯å…¶å®ƒèŠ‚ç‚¹çš„ç¼“å­˜ä»ç„¶å¯ç”¨ã€‚</li><li>ä¹Ÿå¯ä»¥è¿›è¡Œç¼“å­˜é¢„çƒ­ï¼Œé¿å…åœ¨ç³»ç»Ÿåˆšå¯åŠ¨ä¸ä¹…ç”±äºè¿˜æœªå°†å¤§é‡æ•°æ®è¿›è¡Œç¼“å­˜è€Œå¯¼è‡´ç¼“å­˜é›ªå´©ã€‚</li></ul><h2 id="ç¼“å­˜ä¸€è‡´æ€§"><a href="#ç¼“å­˜ä¸€è‡´æ€§" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§"></a>ç¼“å­˜ä¸€è‡´æ€§</h2><p>ç¼“å­˜ä¸€è‡´æ€§è¦æ±‚æ•°æ®æ›´æ–°çš„åŒæ—¶ç¼“å­˜æ•°æ®ä¹Ÿèƒ½å¤Ÿå®æ—¶æ›´æ–°ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>åœ¨æ•°æ®æ›´æ–°çš„åŒæ—¶ç«‹å³å»æ›´æ–°ç¼“å­˜ï¼›</li><li>åœ¨è¯»ç¼“å­˜ä¹‹å‰å…ˆåˆ¤æ–­ç¼“å­˜æ˜¯å¦æ˜¯æœ€æ–°çš„ï¼Œå¦‚æœä¸æ˜¯æœ€æ–°çš„å…ˆè¿›è¡Œæ›´æ–°ã€‚</li></ul><p>è¦ä¿è¯ç¼“å­˜ä¸€è‡´æ€§éœ€è¦ä»˜å‡ºå¾ˆå¤§çš„ä»£ä»·ï¼Œç¼“å­˜æ•°æ®æœ€å¥½æ˜¯é‚£äº›å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„æ•°æ®ï¼Œå…è®¸ç¼“å­˜æ•°æ®å­˜åœ¨ä¸€äº›è„æ•°æ®ã€‚</p><h2 id="ç¼“å­˜-â€œæ— åº•æ´â€-ç°è±¡"><a href="#ç¼“å­˜-â€œæ— åº•æ´â€-ç°è±¡" class="headerlink" title="ç¼“å­˜ â€œæ— åº•æ´â€ ç°è±¡"></a>ç¼“å­˜ â€œæ— åº•æ´â€ ç°è±¡</h2><p>æŒ‡çš„æ˜¯ä¸ºäº†æ»¡è¶³ä¸šåŠ¡è¦æ±‚æ·»åŠ äº†å¤§é‡ç¼“å­˜èŠ‚ç‚¹ï¼Œä½†æ˜¯æ€§èƒ½ä¸ä½†æ²¡æœ‰å¥½è½¬åè€Œä¸‹é™äº†çš„ç°è±¡ã€‚</p><p>äº§ç”ŸåŸå› ï¼šç¼“å­˜ç³»ç»Ÿé€šå¸¸é‡‡ç”¨ hash å‡½æ•°å°† key æ˜ å°„åˆ°å¯¹åº”çš„ç¼“å­˜èŠ‚ç‚¹ï¼Œéšç€ç¼“å­˜èŠ‚ç‚¹æ•°ç›®çš„å¢åŠ ï¼Œé”®å€¼åˆ†å¸ƒåˆ°æ›´å¤šçš„èŠ‚ç‚¹ä¸Šï¼Œå¯¼è‡´å®¢æˆ·ç«¯ä¸€æ¬¡æ‰¹é‡æ“ä½œä¼šæ¶‰åŠå¤šæ¬¡ç½‘ç»œæ“ä½œï¼Œè¿™æ„å‘³ç€æ‰¹é‡æ“ä½œçš„è€—æ—¶ä¼šéšç€èŠ‚ç‚¹æ•°ç›®çš„å¢åŠ è€Œä¸æ–­å¢å¤§ã€‚æ­¤å¤–ï¼Œç½‘ç»œè¿æ¥æ•°å˜å¤šï¼Œå¯¹èŠ‚ç‚¹çš„æ€§èƒ½ä¹Ÿæœ‰ä¸€å®šå½±å“ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ä¼˜åŒ–æ‰¹é‡æ•°æ®æ“ä½œå‘½ä»¤ï¼›</li><li>å‡å°‘ç½‘ç»œé€šä¿¡æ¬¡æ•°ï¼›</li><li>é™ä½æ¥å…¥æˆæœ¬ï¼Œä½¿ç”¨é•¿è¿æ¥ / è¿æ¥æ± ï¼ŒNIO ç­‰ã€‚</li></ul><h1 id="å…­ã€æ•°æ®åˆ†å¸ƒ"><a href="#å…­ã€æ•°æ®åˆ†å¸ƒ" class="headerlink" title="å…­ã€æ•°æ®åˆ†å¸ƒ"></a>å…­ã€æ•°æ®åˆ†å¸ƒ</h1><h2 id="å“ˆå¸Œåˆ†å¸ƒ"><a href="#å“ˆå¸Œåˆ†å¸ƒ" class="headerlink" title="å“ˆå¸Œåˆ†å¸ƒ"></a>å“ˆå¸Œåˆ†å¸ƒ</h2><p>å“ˆå¸Œåˆ†å¸ƒå°±æ˜¯å°†æ•°æ®è®¡ç®—å“ˆå¸Œå€¼ä¹‹åï¼ŒæŒ‰ç…§å“ˆå¸Œå€¼åˆ†é…åˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚æœ‰ N ä¸ªèŠ‚ç‚¹ï¼Œæ•°æ®çš„ä¸»é”®ä¸º keyï¼Œåˆ™å°†è¯¥æ•°æ®åˆ†é…çš„èŠ‚ç‚¹åºå·ä¸ºï¼šhash(key)%Nã€‚</p><p>ä¼ ç»Ÿçš„å“ˆå¸Œåˆ†å¸ƒç®—æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“èŠ‚ç‚¹æ•°é‡å˜åŒ–æ—¶ï¼Œä¹Ÿå°±æ˜¯ N å€¼å˜åŒ–ï¼Œé‚£ä¹ˆå‡ ä¹æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é‡æ–°åˆ†å¸ƒï¼Œå°†å¯¼è‡´å¤§é‡çš„æ•°æ®è¿ç§»ã€‚</p><h2 id="é¡ºåºåˆ†å¸ƒ"><a href="#é¡ºåºåˆ†å¸ƒ" class="headerlink" title="é¡ºåºåˆ†å¸ƒ"></a>é¡ºåºåˆ†å¸ƒ</h2><p>å°†æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªè¿ç»­çš„éƒ¨åˆ†ï¼ŒæŒ‰æ•°æ®çš„ ID æˆ–è€…æ—¶é—´åˆ†å¸ƒåˆ°ä¸åŒèŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚ User è¡¨çš„ ID èŒƒå›´ä¸º 1 ~ 7000ï¼Œä½¿ç”¨é¡ºåºåˆ†å¸ƒå¯ä»¥å°†å…¶åˆ’åˆ†æˆå¤šä¸ªå­è¡¨ï¼Œå¯¹åº”çš„ä¸»é”®èŒƒå›´ä¸º 1 ~ 1000ï¼Œ1001 ~ 2000ï¼Œâ€¦ï¼Œ6001 ~ 7000ã€‚</p><p>é¡ºåºåˆ†å¸ƒç›¸æ¯”äºå“ˆå¸Œåˆ†å¸ƒçš„ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>èƒ½ä¿æŒæ•°æ®åŸæœ‰çš„é¡ºåºï¼›</li><li>å¹¶ä¸”èƒ½å¤Ÿå‡†ç¡®æ§åˆ¶æ¯å°æœåŠ¡å™¨å­˜å‚¨çš„æ•°æ®é‡ï¼Œä»è€Œä½¿å¾—å­˜å‚¨ç©ºé—´çš„åˆ©ç”¨ç‡æœ€å¤§ã€‚</li></ul><h1 id="ä¸ƒã€ä¸€è‡´æ€§å“ˆå¸Œ"><a href="#ä¸ƒã€ä¸€è‡´æ€§å“ˆå¸Œ" class="headerlink" title="ä¸ƒã€ä¸€è‡´æ€§å“ˆå¸Œ"></a>ä¸ƒã€ä¸€è‡´æ€§å“ˆå¸Œ</h1><p>Distributed Hash Tableï¼ˆDHTï¼‰ æ˜¯ä¸€ç§å“ˆå¸Œåˆ†å¸ƒæ–¹å¼ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å…‹æœä¼ ç»Ÿå“ˆå¸Œåˆ†å¸ƒåœ¨æœåŠ¡å™¨èŠ‚ç‚¹æ•°é‡å˜åŒ–æ—¶å¤§é‡æ•°æ®è¿ç§»çš„é—®é¢˜ã€‚</p><h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><p>å°†å“ˆå¸Œç©ºé—´ [0, 2<sup>n</sup>-1] çœ‹æˆä¸€ä¸ªå“ˆå¸Œç¯ï¼Œæ¯ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹éƒ½é…ç½®åˆ°å“ˆå¸Œç¯ä¸Šã€‚æ¯ä¸ªæ•°æ®å¯¹è±¡é€šè¿‡å“ˆå¸Œå–æ¨¡å¾—åˆ°å“ˆå¸Œå€¼ä¹‹åï¼Œå­˜æ”¾åˆ°å“ˆå¸Œç¯ä¸­é¡ºæ—¶é’ˆæ–¹å‘ç¬¬ä¸€ä¸ªå¤§äºç­‰äºè¯¥å“ˆå¸Œå€¼çš„èŠ‚ç‚¹ä¸Šã€‚</p><p>ä¸€è‡´æ€§å“ˆå¸Œåœ¨å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ—¶åªä¼šå½±å“åˆ°å“ˆå¸Œç¯ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­æ–°å¢èŠ‚ç‚¹ Xï¼Œåªéœ€è¦å°†å®ƒå‰ä¸€ä¸ªèŠ‚ç‚¹ C ä¸Šçš„æ•°æ®é‡æ–°è¿›è¡Œåˆ†å¸ƒå³å¯ï¼Œå¯¹äºèŠ‚ç‚¹ Aã€Bã€D éƒ½æ²¡æœ‰å½±å“ã€‚</p><h2 id="è™šæ‹ŸèŠ‚ç‚¹"><a href="#è™šæ‹ŸèŠ‚ç‚¹" class="headerlink" title="è™šæ‹ŸèŠ‚ç‚¹"></a>è™šæ‹ŸèŠ‚ç‚¹</h2><p>ä¸Šé¢æè¿°çš„ä¸€è‡´æ€§å“ˆå¸Œå­˜åœ¨æ•°æ®åˆ†å¸ƒä¸å‡åŒ€çš„é—®é¢˜ï¼ŒèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®é‡æœ‰å¯èƒ½ä¼šå­˜åœ¨å¾ˆå¤§çš„ä¸åŒã€‚</p><p>æ•°æ®ä¸å‡åŒ€ä¸»è¦æ˜¯å› ä¸ºèŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šåˆ†å¸ƒçš„ä¸å‡åŒ€ï¼Œè¿™ç§æƒ…å†µåœ¨èŠ‚ç‚¹æ•°é‡å¾ˆå°‘çš„æƒ…å†µä¸‹å°¤å…¶æ˜æ˜¾ã€‚</p><p>è§£å†³æ–¹å¼æ˜¯é€šè¿‡å¢åŠ è™šæ‹ŸèŠ‚ç‚¹ï¼Œç„¶åå°†è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°çœŸå®èŠ‚ç‚¹ä¸Šã€‚è™šæ‹ŸèŠ‚ç‚¹çš„æ•°é‡æ¯”çœŸå®èŠ‚ç‚¹æ¥å¾—å¤šï¼Œé‚£ä¹ˆè™šæ‹ŸèŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šåˆ†å¸ƒçš„å‡åŒ€æ€§å°±ä¼šæ¯”åŸæ¥çš„çœŸå®èŠ‚ç‚¹å¥½ï¼Œä»è€Œä½¿å¾—æ•°æ®åˆ†å¸ƒä¹Ÿæ›´åŠ å‡åŒ€ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å…³äºç¼“å­˜&quot;&gt;&lt;a href=&quot;#å…³äºç¼“å­˜&quot; class=&quot;headerlink&quot; title=&quot;å…³äºç¼“å­˜&quot;&gt;&lt;/a&gt;å…³äºç¼“å­˜&lt;/h1&gt;&lt;h1 id=&quot;ä¸€ã€ç¼“å­˜ç‰¹å¾&quot;&gt;&lt;a href=&quot;#ä¸€ã€ç¼“å­˜ç‰¹å¾&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€ç¼“å­˜ç‰¹å¾&quot;&gt;&lt;/a&gt;ä¸€ã€ç¼“å­˜ç‰¹å¾&lt;/h1&gt;&lt;h2 id=&quot;å‘½ä¸­ç‡&quot;&gt;&lt;a href=&quot;#å‘½ä¸­ç‡&quot; class=&quot;headerlink&quot; title=&quot;å‘½ä¸­ç‡&quot;&gt;&lt;/a&gt;å‘½ä¸­ç‡&lt;/h2&gt;&lt;p&gt;å½“æŸä¸ªè¯·æ±‚èƒ½å¤Ÿé€šè¿‡è®¿é—®ç¼“å­˜è€Œå¾—åˆ°å“åº”æ—¶ï¼Œç§°ä¸ºç¼“å­˜å‘½ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œç¼“å­˜çš„åˆ©ç”¨ç‡ä¹Ÿå°±è¶Šé«˜ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JAVA ClassLoader</title>
    <link href="http://yoursite.com/2018/08/08/JAVA-classloader/"/>
    <id>http://yoursite.com/2018/08/08/JAVA-classloader/</id>
    <published>2018-08-08T04:53:41.000Z</published>
    <updated>2018-09-09T15:22:50.889Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç±»åŠ è½½å™¨çš„åŸºæœ¬æ¦‚å¿µ"><a href="#ç±»åŠ è½½å™¨çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ç±»åŠ è½½å™¨çš„åŸºæœ¬æ¦‚å¿µ"></a>ç±»åŠ è½½å™¨çš„åŸºæœ¬æ¦‚å¿µ</h2><p>é¡¾åæ€ä¹‰ï¼Œç±»åŠ è½½å™¨ï¼ˆclass loaderï¼‰ç”¨æ¥åŠ è½½ Java ç±»åˆ° Java è™šæ‹Ÿæœºä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava è™šæ‹Ÿæœºä½¿ç”¨ Java ç±»çš„æ–¹å¼å¦‚ä¸‹ï¼šJava æºç¨‹åºï¼ˆ.java æ–‡ä»¶ï¼‰åœ¨ç»è¿‡ Java ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åå°±è¢«è½¬æ¢æˆ Java å­—èŠ‚ä»£ç ï¼ˆ.class æ–‡ä»¶ï¼‰ã€‚ç±»åŠ è½½å™¨è´Ÿè´£è¯»å– Java å­—èŠ‚ä»£ç ï¼Œå¹¶è½¬æ¢æˆ java.lang.Classç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æ¯ä¸ªè¿™æ ·çš„å®ä¾‹ç”¨æ¥è¡¨ç¤ºä¸€ä¸ª Java ç±»ã€‚é€šè¿‡æ­¤å®ä¾‹çš„ newInstance()æ–¹æ³•å°±å¯ä»¥åˆ›å»ºå‡ºè¯¥ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚å®é™…çš„æƒ…å†µå¯èƒ½æ›´åŠ å¤æ‚ï¼Œæ¯”å¦‚ Java å­—èŠ‚ä»£ç å¯èƒ½æ˜¯é€šè¿‡å·¥å…·åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯é€šè¿‡ç½‘ç»œä¸‹è½½çš„ã€‚åŸºæœ¬ä¸Šæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æ˜¯ java.lang.ClassLoaderç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚<br><a id="more"></a></p><h2 id="ClassLoader-ä»‹ç»"><a href="#ClassLoader-ä»‹ç»" class="headerlink" title="ClassLoader ä»‹ç»"></a>ClassLoader ä»‹ç»</h2><p>java.lang.ClassLoaderç±»çš„åŸºæœ¬èŒè´£å°±æ˜¯æ ¹æ®ä¸€ä¸ªæŒ‡å®šçš„ç±»çš„åç§°ï¼Œæ‰¾åˆ°æˆ–è€…ç”Ÿæˆå…¶å¯¹åº”çš„å­—èŠ‚ä»£ç ï¼Œç„¶åä»è¿™äº›å­—èŠ‚ä»£ç ä¸­å®šä¹‰å‡ºä¸€ä¸ª Java ç±»ï¼Œå³ java.lang.Classç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒClassLoaderè¿˜è´Ÿè´£åŠ è½½ Java åº”ç”¨æ‰€éœ€çš„èµ„æºï¼Œå¦‚å›¾åƒæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ç­‰ã€‚ä¸è¿‡æœ¬æ–‡åªè®¨è®ºå…¶åŠ è½½ç±»çš„åŠŸèƒ½ã€‚ä¸ºäº†å®ŒæˆåŠ è½½ç±»çš„è¿™ä¸ªèŒè´£ï¼ŒClassLoaderæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•</p><h2 id="ClassLoader-ä¸­ä¸åŠ è½½ç±»ç›¸å…³çš„æ–¹æ³•"><a href="#ClassLoader-ä¸­ä¸åŠ è½½ç±»ç›¸å…³çš„æ–¹æ³•" class="headerlink" title="ClassLoader ä¸­ä¸åŠ è½½ç±»ç›¸å…³çš„æ–¹æ³•"></a>ClassLoader ä¸­ä¸åŠ è½½ç±»ç›¸å…³çš„æ–¹æ³•</h2><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>getParent()</td><td>è¿”å›è¯¥ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</td></tr><tr><td>loadClass(String name)</td><td>æŸ¥æ‰¾åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹.</td></tr><tr><td>findLoadedClass(String name)</td><td>æŸ¥æ‰¾åç§°ä¸º nameçš„å·²ç»è¢«åŠ è½½è¿‡çš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚</td></tr><tr><td>defineClass(String name, byte<a href=""></a> b, int off, int len)</td><td>æŠŠå­—èŠ‚æ•°ç»„ bä¸­çš„å†…å®¹è½¬æ¢æˆ Java ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•è¢«å£°æ˜ä¸º finalçš„ã€‚</td></tr></tbody></table><h2 id="ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„"><a href="#ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„" class="headerlink" title="ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„"></a>ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»„ç»‡ç»“æ„</h2><p>Java ä¸­çš„ç±»åŠ è½½å™¨å¤§è‡´å¯ä»¥åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç³»ç»Ÿæä¾›çš„ï¼Œå¦å¤–ä¸€ç±»åˆ™æ˜¯ç”± Java åº”ç”¨å¼€å‘äººå‘˜ç¼–å†™çš„ã€‚ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ä¸»è¦æœ‰ä¸‹é¢ä¸‰ä¸ªï¼š</p><ul><li>å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆbootstrap class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ ¸å¿ƒåº“ï¼Œæ˜¯ç”¨åŸç”Ÿä»£ç æ¥å®ç°çš„ï¼Œå¹¶ä¸ç»§æ‰¿è‡ª java.lang.ClassLoaderã€‚</li><li>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆextensions class loaderï¼‰ï¼šå®ƒç”¨æ¥åŠ è½½ Java çš„æ‰©å±•åº“ã€‚Java è™šæ‹Ÿæœºçš„å®ç°ä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ã€‚è¯¥ç±»åŠ è½½å™¨åœ¨æ­¤ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½ Java ç±»ã€‚</li><li>ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆsystem class loaderï¼‰ï¼šå®ƒæ ¹æ® Java åº”ç”¨çš„ç±»è·¯å¾„ï¼ˆCLASSPATHï¼‰æ¥åŠ è½½ Java ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava åº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½çš„ã€‚å¯ä»¥é€šè¿‡ <code>ClassLoader.getSystemClassLoader()</code>æ¥è·å–å®ƒã€‚</li></ul><p> é™¤äº†ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨ä»¥å¤–ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ç»§æ‰¿ java.lang.ClassLoaderç±»çš„æ–¹å¼å®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä»¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ã€‚<br>é™¤äº†å¼•å¯¼ç±»åŠ è½½å™¨ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨ã€‚é€šè¿‡ è¡¨ 1ä¸­ç»™å‡ºçš„ getParent()æ–¹æ³•å¯ä»¥å¾—åˆ°ã€‚å¯¹äºç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥è¯´ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ï¼Œè€Œæ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯å¼•å¯¼ç±»åŠ è½½å™¨ï¼›å¯¹äºå¼€å‘äººå‘˜ç¼–å†™çš„ç±»åŠ è½½å™¨æ¥è¯´ï¼Œå…¶çˆ¶ç±»åŠ è½½å™¨æ˜¯åŠ è½½æ­¤ç±»åŠ è½½å™¨ Java ç±»çš„ç±»åŠ è½½å™¨ã€‚å› ä¸ºç±»åŠ è½½å™¨ Java ç±»å¦‚åŒå…¶å®ƒçš„ Java ç±»ä¸€æ ·ï¼Œä¹Ÿæ˜¯è¦ç”±ç±»åŠ è½½å™¨æ¥åŠ è½½çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¼€å‘äººå‘˜ç¼–å†™çš„ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ç±»åŠ è½½å™¨é€šè¿‡è¿™ç§æ–¹å¼ç»„ç»‡èµ·æ¥ï¼Œå½¢æˆæ ‘çŠ¶ç»“æ„ã€‚æ ‘çš„æ ¹èŠ‚ç‚¹å°±æ˜¯å¼•å¯¼ç±»åŠ è½½å™¨ã€‚å›¾ 1ä¸­ç»™å‡ºäº†ä¸€ä¸ªå…¸å‹çš„ç±»åŠ è½½å™¨æ ‘çŠ¶ç»„ç»‡ç»“æ„ç¤ºæ„å›¾ï¼Œå…¶ä¸­çš„ç®­å¤´æŒ‡å‘çš„æ˜¯çˆ¶ç±»åŠ è½½å™¨ã€‚<br><img src="https://www.ibm.com/developerworks/cn/java/j-lo-classloader/image001.jpg" alt="" title="ç±»åŠ è½½å™¨çš„æ ‘çŠ¶ç»“æ„"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class ClassLoaderTree &#123; </span><br><span class="line">Â Â Â public static void main(String[]() args) &#123; </span><br><span class="line">Â Â Â Â Â Â Â ClassLoader loader = ClassLoaderTree.class.getClassLoader(); </span><br><span class="line">Â Â Â Â Â Â Â while (loader != null) &#123; </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â System.out.println(loader.toString()); </span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â loader = loader.getParent(); </span><br><span class="line">Â Â Â Â Â Â Â &#125; </span><br><span class="line">Â Â Â &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç±»åŠ è½½å™¨çš„åŸºæœ¬æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#ç±»åŠ è½½å™¨çš„åŸºæœ¬æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;ç±»åŠ è½½å™¨çš„åŸºæœ¬æ¦‚å¿µ&quot;&gt;&lt;/a&gt;ç±»åŠ è½½å™¨çš„åŸºæœ¬æ¦‚å¿µ&lt;/h2&gt;&lt;p&gt;é¡¾åæ€ä¹‰ï¼Œç±»åŠ è½½å™¨ï¼ˆclass loaderï¼‰ç”¨æ¥åŠ è½½ Java ç±»åˆ° Java è™šæ‹Ÿæœºä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava è™šæ‹Ÿæœºä½¿ç”¨ Java ç±»çš„æ–¹å¼å¦‚ä¸‹ï¼šJava æºç¨‹åºï¼ˆ.java æ–‡ä»¶ï¼‰åœ¨ç»è¿‡ Java ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åå°±è¢«è½¬æ¢æˆ Java å­—èŠ‚ä»£ç ï¼ˆ.class æ–‡ä»¶ï¼‰ã€‚ç±»åŠ è½½å™¨è´Ÿè´£è¯»å– Java å­—èŠ‚ä»£ç ï¼Œå¹¶è½¬æ¢æˆ java.lang.Classç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æ¯ä¸ªè¿™æ ·çš„å®ä¾‹ç”¨æ¥è¡¨ç¤ºä¸€ä¸ª Java ç±»ã€‚é€šè¿‡æ­¤å®ä¾‹çš„ newInstance()æ–¹æ³•å°±å¯ä»¥åˆ›å»ºå‡ºè¯¥ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚å®é™…çš„æƒ…å†µå¯èƒ½æ›´åŠ å¤æ‚ï¼Œæ¯”å¦‚ Java å­—èŠ‚ä»£ç å¯èƒ½æ˜¯é€šè¿‡å·¥å…·åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯é€šè¿‡ç½‘ç»œä¸‹è½½çš„ã€‚åŸºæœ¬ä¸Šæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æ˜¯ java.lang.ClassLoaderç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œ</title>
    <link href="http://yoursite.com/2018/06/12/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20-%20%E4%BC%A0%E8%BE%93%E5%B1%82/"/>
    <id>http://yoursite.com/2018/06/12/è®¡ç®—æœºç½‘ç»œ - ä¼ è¾“å±‚/</id>
    <published>2018-06-12T03:21:00.000Z</published>
    <updated>2019-06-28T14:39:26.997Z</updated>
    
    <content type="html"><![CDATA[<p>ç½‘ç»œå±‚åªæŠŠåˆ†ç»„å‘é€åˆ°ç›®çš„ä¸»æœºï¼Œä½†æ˜¯çœŸæ­£é€šä¿¡çš„å¹¶ä¸æ˜¯ä¸»æœºè€Œæ˜¯ä¸»æœºä¸­çš„è¿›ç¨‹ã€‚ä¼ è¾“å±‚æä¾›äº†è¿›ç¨‹é—´çš„é€»è¾‘é€šä¿¡ï¼Œä¼ è¾“å±‚å‘é«˜å±‚ç”¨æˆ·å±è”½äº†ä¸‹é¢ç½‘ç»œå±‚çš„æ ¸å¿ƒç»†èŠ‚ï¼Œä½¿åº”ç”¨ç¨‹åºçœ‹èµ·æ¥åƒ<br><a id="more"></a>æ˜¯åœ¨ä¸¤ä¸ªä¼ è¾“å±‚å®ä½“ä¹‹é—´æœ‰ä¸€æ¡ç«¯åˆ°ç«¯çš„é€»è¾‘é€šä¿¡ä¿¡é“ã€‚</p><h1 id="UDP-å’Œ-TCP-çš„ç‰¹ç‚¹"><a href="#UDP-å’Œ-TCP-çš„ç‰¹ç‚¹" class="headerlink" title="UDP å’Œ TCP çš„ç‰¹ç‚¹"></a>UDP å’Œ TCP çš„ç‰¹ç‚¹</h1><ul><li><p>ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼ˆUser Datagram Protocolï¼‰æ˜¯æ— è¿æ¥çš„ï¼Œå°½æœ€å¤§å¯èƒ½äº¤ä»˜ï¼Œæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œé¢å‘æŠ¥æ–‡ï¼ˆå¯¹äºåº”ç”¨ç¨‹åºä¼ ä¸‹æ¥çš„æŠ¥æ–‡ä¸åˆå¹¶ä¹Ÿä¸æ‹†åˆ†ï¼Œåªæ˜¯æ·»åŠ  UDP é¦–éƒ¨ï¼‰ï¼Œæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ã€‚</p></li><li><p>ä¼ è¾“æ§åˆ¶åè®® TCPï¼ˆTransmission Control Protocolï¼‰æ˜¯é¢å‘è¿æ¥çš„ï¼Œæä¾›å¯é äº¤ä»˜ï¼Œæœ‰æµé‡æ§åˆ¶ï¼Œæ‹¥å¡æ§åˆ¶ï¼Œæä¾›å…¨åŒå·¥é€šä¿¡ï¼Œé¢å‘å­—èŠ‚æµï¼ˆæŠŠåº”ç”¨å±‚ä¼ ä¸‹æ¥çš„æŠ¥æ–‡çœ‹æˆå­—èŠ‚æµï¼ŒæŠŠå­—èŠ‚æµç»„ç»‡æˆå¤§å°ä¸ç­‰çš„æ•°æ®å—ï¼‰ï¼Œæ¯ä¸€æ¡ TCP è¿æ¥åªèƒ½æ˜¯ç‚¹å¯¹ç‚¹çš„ï¼ˆä¸€å¯¹ä¸€ï¼‰ã€‚</p></li></ul><h1 id="UDP-é¦–éƒ¨æ ¼å¼"><a href="#UDP-é¦–éƒ¨æ ¼å¼" class="headerlink" title="UDP é¦–éƒ¨æ ¼å¼"></a>UDP é¦–éƒ¨æ ¼å¼</h1><p><div align="center"> <img src="pics/d4c3a4a1-0846-46ec-9cc3-eaddfca71254.jpg" width="600"> </div><br></p><p>é¦–éƒ¨å­—æ®µåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼ŒåŒ…æ‹¬æºç«¯å£ã€ç›®çš„ç«¯å£ã€é•¿åº¦ã€æ£€éªŒå’Œã€‚12 å­—èŠ‚çš„ä¼ªé¦–éƒ¨æ˜¯ä¸ºäº†è®¡ç®—æ£€éªŒå’Œä¸´æ—¶æ·»åŠ çš„ã€‚</p><h1 id="TCP-é¦–éƒ¨æ ¼å¼"><a href="#TCP-é¦–éƒ¨æ ¼å¼" class="headerlink" title="TCP é¦–éƒ¨æ ¼å¼"></a>TCP é¦–éƒ¨æ ¼å¼</h1><p><div align="center"> <img src="pics/55dc4e84-573d-4c13-a765-52ed1dd251f9.png" width="700"> </div><br></p><ul><li><p><strong>åºå·</strong>  ï¼šç”¨äºå¯¹å­—èŠ‚æµè¿›è¡Œç¼–å·ï¼Œä¾‹å¦‚åºå·ä¸º 301ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ä¸º 301ï¼Œå¦‚æœæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 100 å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·åº”ä¸º 401ã€‚</p></li><li><p><strong>ç¡®è®¤å·</strong>  ï¼šæœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ã€‚ä¾‹å¦‚ B æ­£ç¡®æ”¶åˆ° A å‘é€æ¥çš„ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œåºå·ä¸º 501ï¼Œæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 200 å­—èŠ‚ï¼Œå› æ­¤ B æœŸæœ›ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ä¸º 701ï¼ŒB å‘é€ç»™ A çš„ç¡®è®¤æŠ¥æ–‡æ®µä¸­ç¡®è®¤å·å°±ä¸º 701ã€‚</p></li><li><p><strong>æ•°æ®åç§»</strong>  ï¼šæŒ‡çš„æ˜¯æ•°æ®éƒ¨åˆ†è·ç¦»æŠ¥æ–‡æ®µèµ·å§‹å¤„çš„åç§»é‡ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯é¦–éƒ¨çš„é•¿åº¦ã€‚</p></li><li><p><strong>ç¡®è®¤ ACK</strong>  ï¼šå½“ ACK=1 æ—¶ç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼Œå¦åˆ™æ— æ•ˆã€‚TCP è§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK ç½® 1ã€‚</p></li><li><p><strong>åŒæ­¥ SYN</strong>  ï¼šåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å½“ SYN=1ï¼ŒACK=0 æ—¶è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è‹¥å¯¹æ–¹åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å“åº”æŠ¥æ–‡ä¸­ SYN=1ï¼ŒACK=1ã€‚</p></li><li><p><strong>ç»ˆæ­¢ FIN</strong>  ï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ï¼Œå½“ FIN=1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿æ¥ã€‚</p></li><li><p><strong>çª—å£</strong>  ï¼šçª—å£å€¼ä½œä¸ºæ¥æ”¶æ–¹è®©å‘é€æ–¹è®¾ç½®å…¶å‘é€çª—å£çš„ä¾æ®ã€‚ä¹‹æ‰€ä»¥è¦æœ‰è¿™ä¸ªé™åˆ¶ï¼Œæ˜¯å› ä¸ºæ¥æ”¶æ–¹çš„æ•°æ®ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ã€‚</p></li></ul><h1 id="TCP-çš„ä¸‰æ¬¡æ¡æ‰‹"><a href="#TCP-çš„ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCP çš„ä¸‰æ¬¡æ¡æ‰‹"></a>TCP çš„ä¸‰æ¬¡æ¡æ‰‹</h1><p><div align="center"> <img src="pics/e92d0ebc-7d46-413b-aec1-34a39602f787.png" width="600"> </div><br></p><p>å‡è®¾ A ä¸ºå®¢æˆ·ç«¯ï¼ŒB ä¸ºæœåŠ¡å™¨ç«¯ã€‚</p><ul><li><p>é¦–å…ˆ B å¤„äº LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·çš„è¿æ¥è¯·æ±‚ã€‚</p></li><li><p>A å‘ B å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼ŒSYN=1ï¼ŒACK=0ï¼Œé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· xã€‚</p></li><li><p>B æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘ A å‘é€è¿æ¥ç¡®è®¤æŠ¥æ–‡ï¼ŒSYN=1ï¼ŒACK=1ï¼Œç¡®è®¤å·ä¸º x+1ï¼ŒåŒæ—¶ä¹Ÿé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· yã€‚</p></li><li><p>A æ”¶åˆ° B çš„è¿æ¥ç¡®è®¤æŠ¥æ–‡åï¼Œè¿˜è¦å‘ B å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·ä¸º y+1ï¼Œåºå·ä¸º x+1ã€‚</p></li><li><p>B æ”¶åˆ° A çš„ç¡®è®¤åï¼Œè¿æ¥å»ºç«‹ã€‚</p></li></ul><p><strong>ä¸‰æ¬¡æ¡æ‰‹çš„åŸå› </strong> </p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†é˜²æ­¢å¤±æ•ˆçš„è¿æ¥è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ï¼Œè®©æœåŠ¡å™¨é”™è¯¯æ‰“å¼€è¿æ¥ã€‚</p><p>å®¢æˆ·ç«¯å‘é€çš„è¿æ¥è¯·æ±‚å¦‚æœåœ¨ç½‘ç»œä¸­æ»ç•™ï¼Œé‚£ä¹ˆå°±ä¼šéš”å¾ˆé•¿ä¸€æ®µæ—¶é—´æ‰èƒ½æ”¶åˆ°æœåŠ¡å™¨ç«¯å‘å›çš„è¿æ¥ç¡®è®¤ã€‚å®¢æˆ·ç«¯ç­‰å¾…ä¸€ä¸ªè¶…æ—¶é‡ä¼ æ—¶é—´ä¹‹åï¼Œå°±ä¼šé‡æ–°è¯·æ±‚è¿æ¥ã€‚ä½†æ˜¯è¿™ä¸ªæ»ç•™çš„è¿æ¥è¯·æ±‚æœ€åè¿˜æ˜¯ä¼šåˆ°è¾¾æœåŠ¡å™¨ï¼Œå¦‚æœä¸è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šæ‰“å¼€ä¸¤ä¸ªè¿æ¥ã€‚å¦‚æœæœ‰ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ä¼šå¿½ç•¥æœåŠ¡å™¨ä¹‹åå‘é€çš„å¯¹æ»ç•™è¿æ¥è¯·æ±‚çš„è¿æ¥ç¡®è®¤ï¼Œä¸è¿›è¡Œç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› æ­¤å°±ä¸ä¼šå†æ¬¡æ‰“å¼€è¿æ¥ã€‚</p><h1 id="TCP-çš„å››æ¬¡æŒ¥æ‰‹"><a href="#TCP-çš„å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCP çš„å››æ¬¡æŒ¥æ‰‹"></a>TCP çš„å››æ¬¡æŒ¥æ‰‹</h1><p><div align="center"> <img src="pics/f87afe72-c2df-4c12-ac03-9b8d581a8af8.jpg" width="600"> </div><br></p><p>ä»¥ä¸‹æè¿°ä¸è®¨è®ºåºå·å’Œç¡®è®¤å·ï¼Œå› ä¸ºåºå·å’Œç¡®è®¤å·çš„è§„åˆ™æ¯”è¾ƒç®€å•ã€‚å¹¶ä¸”ä¸è®¨è®º ACKï¼Œå› ä¸º ACK åœ¨è¿æ¥å»ºç«‹ä¹‹åéƒ½ä¸º 1ã€‚</p><ul><li><p>A å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚</p></li><li><p>B æ”¶åˆ°ä¹‹åå‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶ TCP å±äºåŠå…³é—­çŠ¶æ€ï¼ŒB èƒ½å‘ A å‘é€æ•°æ®ä½†æ˜¯ A ä¸èƒ½å‘ B å‘é€æ•°æ®ã€‚</p></li><li><p>å½“ B ä¸å†éœ€è¦è¿æ¥æ—¶ï¼Œå‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚</p></li><li><p>A æ”¶åˆ°åå‘å‡ºç¡®è®¤ï¼Œè¿›å…¥ TIME-WAIT çŠ¶æ€ï¼Œç­‰å¾… 2 MSLï¼ˆæœ€å¤§æŠ¥æ–‡å­˜æ´»æ—¶é—´ï¼‰åé‡Šæ”¾è¿æ¥ã€‚</p></li><li><p>B æ”¶åˆ° A çš„ç¡®è®¤åé‡Šæ”¾è¿æ¥ã€‚</p></li></ul><p><strong>å››æ¬¡æŒ¥æ‰‹çš„åŸå› </strong> </p><p>å®¢æˆ·ç«¯å‘é€äº† FIN è¿æ¥é‡Šæ”¾æŠ¥æ–‡ä¹‹åï¼ŒæœåŠ¡å™¨æ”¶åˆ°äº†è¿™ä¸ªæŠ¥æ–‡ï¼Œå°±è¿›å…¥äº† CLOSE-WAIT çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€æ˜¯ä¸ºäº†è®©æœåŠ¡å™¨ç«¯å‘é€è¿˜æœªä¼ é€å®Œæ¯•çš„æ•°æ®ï¼Œä¼ é€å®Œæ¯•ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå‘é€ FIN è¿æ¥é‡Šæ”¾æŠ¥æ–‡ã€‚</p><p><strong>TIME_WAIT</strong> </p><p>å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„ FIN æŠ¥æ–‡åè¿›å…¥æ­¤çŠ¶æ€ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾…ä¸€ä¸ªæ—¶é—´è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´ 2MSLã€‚è¿™ä¹ˆåšæœ‰ä¸¤ä¸ªç†ç”±ï¼š</p><ul><li><p>ç¡®ä¿æœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾ã€‚å¦‚æœ B æ²¡æ”¶åˆ° A å‘é€æ¥çš„ç¡®è®¤æŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚æŠ¥æ–‡ï¼ŒA ç­‰å¾…ä¸€æ®µæ—¶é—´å°±æ˜¯ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚</p></li><li><p>ç­‰å¾…ä¸€æ®µæ—¶é—´æ˜¯ä¸ºäº†è®©æœ¬è¿æ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡éƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸ä¼šå‡ºç°æ—§çš„è¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚</p></li></ul><h1 id="TCP-å¯é ä¼ è¾“"><a href="#TCP-å¯é ä¼ è¾“" class="headerlink" title="TCP å¯é ä¼ è¾“"></a>TCP å¯é ä¼ è¾“</h1><p>TCP ä½¿ç”¨è¶…æ—¶é‡ä¼ æ¥å®ç°å¯é ä¼ è¾“ï¼šå¦‚æœä¸€ä¸ªå·²ç»å‘é€çš„æŠ¥æ–‡æ®µåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œé‚£ä¹ˆå°±é‡ä¼ è¿™ä¸ªæŠ¥æ–‡æ®µã€‚</p><p>ä¸€ä¸ªæŠ¥æ–‡æ®µä»å‘é€å†åˆ°æ¥æ”¶åˆ°ç¡®è®¤æ‰€ç»è¿‡çš„æ—¶é—´ç§°ä¸ºå¾€è¿”æ—¶é—´ RTTï¼ŒåŠ æƒå¹³å‡å¾€è¿”æ—¶é—´ RTTs è®¡ç®—å¦‚ä¸‹ï¼š</p><p><div align="center"><img src="https://latex.codecogs.com/gif.latex?RTTs=(1-a)*(RTTs)+a*RTT" class="mathjax-pic"></div> <br></p><p>å…¶ä¸­ï¼Œ0 â‰¤ a ï¼œ 1ï¼ŒRTTs éšç€ a çš„å¢åŠ æ›´å®¹æ˜“å—åˆ° RTT çš„å½±å“ã€‚</p><p>è¶…æ—¶æ—¶é—´ RTO åº”è¯¥ç•¥å¤§äº RTTsï¼ŒTCP ä½¿ç”¨çš„è¶…æ—¶æ—¶é—´è®¡ç®—å¦‚ä¸‹ï¼š</p><p><div align="center"><img src="https://latex.codecogs.com/gif.latex?RTO=RTTs+4*RTT_d" class="mathjax-pic"></div> <br></p><p>å…¶ä¸­ RTT<sub>d</sub> ä¸ºåå·®çš„åŠ æƒå¹³å‡å€¼ã€‚</p><h1 id="TCP-æ»‘åŠ¨çª—å£"><a href="#TCP-æ»‘åŠ¨çª—å£" class="headerlink" title="TCP æ»‘åŠ¨çª—å£"></a>TCP æ»‘åŠ¨çª—å£</h1><p>çª—å£æ˜¯ç¼“å­˜çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥æš‚æ—¶å­˜æ”¾å­—èŠ‚æµã€‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å„æœ‰ä¸€ä¸ªçª—å£ï¼Œæ¥æ”¶æ–¹é€šè¿‡ TCP æŠ¥æ–‡æ®µä¸­çš„çª—å£å­—æ®µå‘Šè¯‰å‘é€æ–¹è‡ªå·±çš„çª—å£å¤§å°ï¼Œå‘é€æ–¹æ ¹æ®è¿™ä¸ªå€¼å’Œå…¶å®ƒä¿¡æ¯è®¾ç½®è‡ªå·±çš„çª—å£å¤§å°ã€‚</p><p>å‘é€çª—å£å†…çš„å­—èŠ‚éƒ½å…è®¸è¢«å‘é€ï¼Œæ¥æ”¶çª—å£å†…çš„å­—èŠ‚éƒ½å…è®¸è¢«æ¥æ”¶ã€‚å¦‚æœå‘é€çª—å£å·¦éƒ¨çš„å­—èŠ‚å·²ç»å‘é€å¹¶ä¸”æ”¶åˆ°äº†ç¡®è®¤ï¼Œé‚£ä¹ˆå°±å°†å‘é€çª—å£å‘å³æ»‘åŠ¨ä¸€å®šè·ç¦»ï¼Œç›´åˆ°å·¦éƒ¨ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸æ˜¯å·²å‘é€å¹¶ä¸”å·²ç¡®è®¤çš„çŠ¶æ€ï¼›æ¥æ”¶çª—å£çš„æ»‘åŠ¨ç±»ä¼¼ï¼Œæ¥æ”¶çª—å£å·¦éƒ¨å­—èŠ‚å·²ç»å‘é€ç¡®è®¤å¹¶äº¤ä»˜ä¸»æœºï¼Œå°±å‘å³æ»‘åŠ¨æ¥æ”¶çª—å£ã€‚</p><p>æ¥æ”¶çª—å£åªä¼šå¯¹çª—å£å†…æœ€åä¸€ä¸ªæŒ‰åºåˆ°è¾¾çš„å­—èŠ‚è¿›è¡Œç¡®è®¤ï¼Œä¾‹å¦‚æ¥æ”¶çª—å£å·²ç»æ”¶åˆ°çš„å­—èŠ‚ä¸º {31, 34, 35}ï¼Œå…¶ä¸­ {31} æŒ‰åºåˆ°è¾¾ï¼Œè€Œ {34, 35} å°±ä¸æ˜¯ï¼Œå› æ­¤åªå¯¹å­—èŠ‚ 31 è¿›è¡Œç¡®è®¤ã€‚å‘é€æ–¹å¾—åˆ°ä¸€ä¸ªå­—èŠ‚çš„ç¡®è®¤ä¹‹åï¼Œå°±çŸ¥é“è¿™ä¸ªå­—èŠ‚ä¹‹å‰çš„æ‰€æœ‰å­—èŠ‚éƒ½å·²ç»è¢«æ¥æ”¶ã€‚</p><p><div align="center"> <img src="pics/a3253deb-8d21-40a1-aae4-7d178e4aa319.jpg" width="800"> </div><br></p><h1 id="TCP-æµé‡æ§åˆ¶"><a href="#TCP-æµé‡æ§åˆ¶" class="headerlink" title="TCP æµé‡æ§åˆ¶"></a>TCP æµé‡æ§åˆ¶</h1><p>æµé‡æ§åˆ¶æ˜¯ä¸ºäº†æ§åˆ¶å‘é€æ–¹å‘é€é€Ÿç‡ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ã€‚</p><p>æ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤æŠ¥æ–‡ä¸­çš„çª—å£å­—æ®µå¯ä»¥ç”¨æ¥æ§åˆ¶å‘é€æ–¹çª—å£å¤§å°ï¼Œä»è€Œå½±å“å‘é€æ–¹çš„å‘é€é€Ÿç‡ã€‚å°†çª—å£å­—æ®µè®¾ç½®ä¸º 0ï¼Œåˆ™å‘é€æ–¹ä¸èƒ½å‘é€æ•°æ®ã€‚</p><h1 id="TCP-æ‹¥å¡æ§åˆ¶"><a href="#TCP-æ‹¥å¡æ§åˆ¶" class="headerlink" title="TCP æ‹¥å¡æ§åˆ¶"></a>TCP æ‹¥å¡æ§åˆ¶</h1><p>å¦‚æœç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œåˆ†ç»„å°†ä¼šä¸¢å¤±ï¼Œæ­¤æ—¶å‘é€æ–¹ä¼šç»§ç»­é‡ä¼ ï¼Œä»è€Œå¯¼è‡´ç½‘ç»œæ‹¥å¡ç¨‹åº¦æ›´é«˜ã€‚å› æ­¤å½“å‡ºç°æ‹¥å¡æ—¶ï¼Œåº”å½“æ§åˆ¶å‘é€æ–¹çš„é€Ÿç‡ã€‚è¿™ä¸€ç‚¹å’Œæµé‡æ§åˆ¶å¾ˆåƒï¼Œä½†æ˜¯å‡ºå‘ç‚¹ä¸åŒã€‚æµé‡æ§åˆ¶æ˜¯ä¸ºäº†è®©æ¥æ”¶æ–¹èƒ½æ¥å¾—åŠæ¥æ”¶ï¼Œè€Œæ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é™ä½æ•´ä¸ªç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ã€‚</p><p><div align="center"> <img src="pics/51e2ed95-65b8-4ae9-8af3-65602d452a25.jpg" width="500"> </div><br></p><p>TCP ä¸»è¦é€šè¿‡å››ä¸ªç®—æ³•æ¥è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼šæ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤ã€‚</p><p>å‘é€æ–¹éœ€è¦ç»´æŠ¤ä¸€ä¸ªå«åšæ‹¥å¡çª—å£ï¼ˆcwndï¼‰çš„çŠ¶æ€å˜é‡ï¼Œæ³¨æ„æ‹¥å¡çª—å£ä¸å‘é€æ–¹çª—å£çš„åŒºåˆ«ï¼šæ‹¥å¡çª—å£åªæ˜¯ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œå®é™…å†³å®šå‘é€æ–¹èƒ½å‘é€å¤šå°‘æ•°æ®çš„æ˜¯å‘é€æ–¹çª—å£ã€‚</p><p>ä¸ºäº†ä¾¿äºè®¨è®ºï¼Œåšå¦‚ä¸‹å‡è®¾ï¼š</p><ul><li>æ¥æ”¶æ–¹æœ‰è¶³å¤Ÿå¤§çš„æ¥æ”¶ç¼“å­˜ï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿæµé‡æ§åˆ¶ï¼›</li><li>è™½ç„¶ TCP çš„çª—å£åŸºäºå­—èŠ‚ï¼Œä½†æ˜¯è¿™é‡Œè®¾çª—å£çš„å¤§å°å•ä½ä¸ºæŠ¥æ–‡æ®µã€‚</li></ul><p><div align="center"> <img src="pics/910f613f-514f-4534-87dd-9b4699d59d31.png" width="800"> </div><br></p><h2 id="1-æ…¢å¼€å§‹ä¸æ‹¥å¡é¿å…"><a href="#1-æ…¢å¼€å§‹ä¸æ‹¥å¡é¿å…" class="headerlink" title="1. æ…¢å¼€å§‹ä¸æ‹¥å¡é¿å…"></a>1. æ…¢å¼€å§‹ä¸æ‹¥å¡é¿å…</h2><p>å‘é€çš„æœ€åˆæ‰§è¡Œæ…¢å¼€å§‹ï¼Œä»¤ cwnd = 1ï¼Œå‘é€æ–¹åªèƒ½å‘é€ 1 ä¸ªæŠ¥æ–‡æ®µï¼›å½“æ”¶åˆ°ç¡®è®¤åï¼Œå°† cwnd åŠ å€ï¼Œå› æ­¤ä¹‹åå‘é€æ–¹èƒ½å¤Ÿå‘é€çš„æŠ¥æ–‡æ®µæ•°é‡ä¸ºï¼š2ã€4ã€8 â€¦</p><p>æ³¨æ„åˆ°æ…¢å¼€å§‹æ¯ä¸ªè½®æ¬¡éƒ½å°† cwnd åŠ å€ï¼Œè¿™æ ·ä¼šè®© cwnd å¢é•¿é€Ÿåº¦éå¸¸å¿«ï¼Œä»è€Œä½¿å¾—å‘é€æ–¹å‘é€çš„é€Ÿåº¦å¢é•¿é€Ÿåº¦è¿‡å¿«ï¼Œç½‘ç»œæ‹¥å¡çš„å¯èƒ½æ€§ä¹Ÿå°±æ›´é«˜ã€‚è®¾ç½®ä¸€ä¸ªæ…¢å¼€å§‹é—¨é™ ssthreshï¼Œå½“ cwnd &gt;= ssthresh æ—¶ï¼Œè¿›å…¥æ‹¥å¡é¿å…ï¼Œæ¯ä¸ªè½®æ¬¡åªå°† cwnd åŠ  1ã€‚</p><p>å¦‚æœå‡ºç°äº†è¶…æ—¶ï¼Œåˆ™ä»¤ ssthresh = cwnd / 2ï¼Œç„¶åé‡æ–°æ‰§è¡Œæ…¢å¼€å§‹ã€‚</p><h2 id="2-å¿«é‡ä¼ ä¸å¿«æ¢å¤"><a href="#2-å¿«é‡ä¼ ä¸å¿«æ¢å¤" class="headerlink" title="2. å¿«é‡ä¼ ä¸å¿«æ¢å¤"></a>2. å¿«é‡ä¼ ä¸å¿«æ¢å¤</h2><p>åœ¨æ¥æ”¶æ–¹ï¼Œè¦æ±‚æ¯æ¬¡æ¥æ”¶åˆ°æŠ¥æ–‡æ®µéƒ½åº”è¯¥å¯¹æœ€åä¸€ä¸ªå·²æ”¶åˆ°çš„æœ‰åºæŠ¥æ–‡æ®µè¿›è¡Œç¡®è®¤ã€‚ä¾‹å¦‚å·²ç»æ¥æ”¶åˆ° M<sub>1</sub> å’Œ M<sub>2</sub>ï¼Œæ­¤æ—¶æ”¶åˆ° M<sub>4</sub>ï¼Œåº”å½“å‘é€å¯¹ M<sub>2</sub> çš„ç¡®è®¤ã€‚</p><p>åœ¨å‘é€æ–¹ï¼Œå¦‚æœæ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤ï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±ï¼Œæ­¤æ—¶æ‰§è¡Œå¿«é‡ä¼ ï¼Œç«‹å³é‡ä¼ ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µã€‚ä¾‹å¦‚æ”¶åˆ°ä¸‰ä¸ª M<sub>2</sub>ï¼Œåˆ™ M<sub>3</sub> ä¸¢å¤±ï¼Œç«‹å³é‡ä¼  M<sub>3</sub>ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæ˜¯ä¸¢å¤±ä¸ªåˆ«æŠ¥æ–‡æ®µï¼Œè€Œä¸æ˜¯ç½‘ç»œæ‹¥å¡ã€‚å› æ­¤æ‰§è¡Œå¿«æ¢å¤ï¼Œä»¤ ssthresh = cwnd / 2 ï¼Œcwnd = ssthreshï¼Œæ³¨æ„åˆ°æ­¤æ—¶ç›´æ¥è¿›å…¥æ‹¥å¡é¿å…ã€‚</p><p>æ…¢å¼€å§‹å’Œå¿«æ¢å¤çš„å¿«æ…¢æŒ‡çš„æ˜¯ cwnd çš„è®¾å®šå€¼ï¼Œè€Œä¸æ˜¯ cwnd çš„å¢é•¿é€Ÿç‡ã€‚æ…¢å¼€å§‹ cwnd è®¾å®šä¸º 1ï¼Œè€Œå¿«æ¢å¤ cwnd è®¾å®šä¸º ssthreshã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç½‘ç»œå±‚åªæŠŠåˆ†ç»„å‘é€åˆ°ç›®çš„ä¸»æœºï¼Œä½†æ˜¯çœŸæ­£é€šä¿¡çš„å¹¶ä¸æ˜¯ä¸»æœºè€Œæ˜¯ä¸»æœºä¸­çš„è¿›ç¨‹ã€‚ä¼ è¾“å±‚æä¾›äº†è¿›ç¨‹é—´çš„é€»è¾‘é€šä¿¡ï¼Œä¼ è¾“å±‚å‘é«˜å±‚ç”¨æˆ·å±è”½äº†ä¸‹é¢ç½‘ç»œå±‚çš„æ ¸å¿ƒç»†èŠ‚ï¼Œä½¿åº”ç”¨ç¨‹åºçœ‹èµ·æ¥åƒ&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JAVA å®¹å™¨</title>
    <link href="http://yoursite.com/2016/12/12/Java%20%E5%AE%B9%E5%99%A8/"/>
    <id>http://yoursite.com/2016/12/12/Java å®¹å™¨/</id>
    <published>2016-12-12T07:23:00.000Z</published>
    <updated>2019-06-28T14:39:12.159Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ¦‚è§ˆ"><a href="#ä¸€ã€æ¦‚è§ˆ" class="headerlink" title="ä¸€ã€æ¦‚è§ˆ"></a>ä¸€ã€æ¦‚è§ˆ</h1><p>å®¹å™¨ä¸»è¦åŒ…æ‹¬ Collection å’Œ Map ä¸¤ç§ï¼ŒCollection å­˜å‚¨ç€å¯¹è±¡çš„é›†åˆï¼Œè€Œ Map å­˜å‚¨ç€é”®å€¼å¯¹ï¼ˆä¸¤ä¸ªå¯¹è±¡ï¼‰çš„æ˜ å°„è¡¨ã€‚<br><a id="more"></a></p><h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><h3 id="1-Set"><a href="#1-Set" class="headerlink" title="1. Set"></a>1. Set</h3><ul><li><p>TreeSetï¼šåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œæ”¯æŒæœ‰åºæ€§æ“ä½œï¼Œä¾‹å¦‚æ ¹æ®ä¸€ä¸ªèŒƒå›´æŸ¥æ‰¾å…ƒç´ çš„æ“ä½œã€‚ä½†æ˜¯æŸ¥æ‰¾æ•ˆç‡ä¸å¦‚ HashSetï¼ŒHashSet æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼ŒTreeSet åˆ™ä¸º O(logN)ã€‚</p></li><li><p>HashSetï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ï¼Œä½†ä¸æ”¯æŒæœ‰åºæ€§æ“ä½œã€‚å¹¶ä¸”å¤±å»äº†å…ƒç´ çš„æ’å…¥é¡ºåºä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ Iterator éå† HashSet å¾—åˆ°çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚</p></li><li><p>LinkedHashSetï¼šå…·æœ‰ HashSet çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œä¸”å†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚</p></li></ul><h3 id="2-List"><a href="#2-List" class="headerlink" title="2. List"></a>2. List</h3><ul><li><p>ArrayListï¼šåŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œæ”¯æŒéšæœºè®¿é—®ã€‚</p></li><li><p>Vectorï¼šå’Œ ArrayList ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></li><li><p>LinkedListï¼šåŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œåªèƒ½é¡ºåºè®¿é—®ï¼Œä½†æ˜¯å¯ä»¥å¿«é€Ÿåœ°åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒLinkedList è¿˜å¯ä»¥ç”¨ä½œæ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—ã€‚</p></li></ul><h3 id="3-Queue"><a href="#3-Queue" class="headerlink" title="3. Queue"></a>3. Queue</h3><ul><li><p>LinkedListï¼šå¯ä»¥ç”¨å®ƒæ¥å®ç°åŒå‘é˜Ÿåˆ—ã€‚</p></li><li><p>PriorityQueueï¼šåŸºäºå †ç»“æ„å®ç°ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ã€‚</p></li></ul><h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p><div align="center"> <img src="pics/774d756b-902a-41a3-a3fd-81ca3ef688dc.png" width="500px"> </div><br></p><ul><li><p>TreeMapï¼šåŸºäºçº¢é»‘æ ‘å®ç°ã€‚</p></li><li><p>HashMapï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ã€‚</p></li><li><p>HashTableï¼šå’Œ HashMap ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å†™å…¥ HashTable å¹¶ä¸”ä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚å®ƒæ˜¯é—ç•™ç±»ï¼Œä¸åº”è¯¥å»ä½¿ç”¨å®ƒã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨ ConcurrentHashMap æ¥æ”¯æŒçº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸” ConcurrentHashMap çš„æ•ˆç‡ä¼šæ›´é«˜ï¼Œå› ä¸º ConcurrentHashMap å¼•å…¥äº†åˆ†æ®µé”ã€‚</p></li><li><p>LinkedHashMapï¼šä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„é¡ºåºï¼Œé¡ºåºä¸ºæ’å…¥é¡ºåºæˆ–è€…æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰é¡ºåºã€‚</p></li></ul><h1 id="äºŒã€å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼"><a href="#äºŒã€å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼" class="headerlink" title="äºŒã€å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼"></a>äºŒã€å®¹å™¨ä¸­çš„è®¾è®¡æ¨¡å¼</h1><h2 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h2><p><div align="center"> <img src="pics/93fb1d38-83f9-464a-a733-67b2e6bfddda.png" width="600px"> </div><br></p><p>Collection ç»§æ‰¿äº† Iterable æ¥å£ï¼Œå…¶ä¸­çš„ iterator() æ–¹æ³•èƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ª Iterator å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¿­ä»£éå† Collection ä¸­çš„å…ƒç´ ã€‚</p><p>ä» JDK 1.5 ä¹‹åå¯ä»¥ä½¿ç”¨ foreach æ–¹æ³•æ¥éå†å®ç°äº† Iterable æ¥å£çš„èšåˆå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(<span class="string">"a"</span>);</span><br><span class="line">list.add(<span class="string">"b"</span>);</span><br><span class="line"><span class="keyword">for</span> (String item : list) &#123;</span><br><span class="line">    System.out.println(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><p>java.util.Arrays#asList() å¯ä»¥æŠŠæ•°ç»„ç±»å‹è½¬æ¢ä¸º List ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SafeVarargs</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">asList</span><span class="params">(T... a)</span></span></span><br></pre></td></tr></table></figure><p>åº”è¯¥æ³¨æ„çš„æ˜¯ asList() çš„å‚æ•°ä¸ºæ³›å‹çš„å˜é•¿å‚æ•°ï¼Œä¸èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œåªèƒ½ä½¿ç”¨ç›¸åº”çš„åŒ…è£…ç±»å‹æ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">List list = Arrays.asList(arr);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è°ƒç”¨ asList()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><h1 id="ä¸‰ã€æºç åˆ†æ"><a href="#ä¸‰ã€æºç åˆ†æ" class="headerlink" title="ä¸‰ã€æºç åˆ†æ"></a>ä¸‰ã€æºç åˆ†æ</h1><p>å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä»¥ä¸‹æºç åˆ†æåŸºäº JDK 1.8ã€‚</p><p>åœ¨ IDEA ä¸­ double shift è°ƒå‡º Search EveryWhereï¼ŒæŸ¥æ‰¾æºç æ–‡ä»¶ï¼Œæ‰¾åˆ°ä¹‹åå°±å¯ä»¥é˜…è¯»æºç ã€‚</p><h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h2><h3 id="1-æ¦‚è§ˆ"><a href="#1-æ¦‚è§ˆ" class="headerlink" title="1. æ¦‚è§ˆ"></a>1. æ¦‚è§ˆ</h3><p>å› ä¸º ArrayList æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚RandomAccess æ¥å£æ ‡è¯†ç€è¯¥ç±»æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure><p>æ•°ç»„çš„é»˜è®¤å¤§å°ä¸º 10ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><div align="center"> <img src="pics/52a7744f-5bce-4ff3-a6f0-8449334d9f3d.png" width="400px"> </div><br></p><h3 id="2-æ‰©å®¹"><a href="#2-æ‰©å®¹" class="headerlink" title="2. æ‰©å®¹"></a>2. æ‰©å®¹</h3><p>æ·»åŠ å…ƒç´ æ—¶ä½¿ç”¨ ensureCapacityInternal() æ–¹æ³•æ¥ä¿è¯å®¹é‡è¶³å¤Ÿï¼Œå¦‚æœä¸å¤Ÿæ—¶ï¼Œéœ€è¦ä½¿ç”¨ grow() æ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œæ–°å®¹é‡çš„å¤§å°ä¸º <code>oldCapacity + (oldCapacity &gt;&gt; 1)</code>ï¼Œä¹Ÿå°±æ˜¯æ—§å®¹é‡çš„ 1.5 å€ã€‚</p><p>æ‰©å®¹æ“ä½œéœ€è¦è°ƒç”¨ <code>Arrays.copyOf()</code> æŠŠåŸæ•°ç»„æ•´ä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™ä¸ªæ“ä½œä»£ä»·å¾ˆé«˜ï¼Œå› æ­¤æœ€å¥½åœ¨åˆ›å»º ArrayList å¯¹è±¡æ—¶å°±æŒ‡å®šå¤§æ¦‚çš„å®¹é‡å¤§å°ï¼Œå‡å°‘æ‰©å®¹æ“ä½œçš„æ¬¡æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    ensureExplicitCapacity(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-åˆ é™¤å…ƒç´ "><a href="#3-åˆ é™¤å…ƒç´ " class="headerlink" title="3. åˆ é™¤å…ƒç´ "></a>3. åˆ é™¤å…ƒç´ </h3><p>éœ€è¦è°ƒç”¨ System.arraycopy() å°† index+1 åé¢çš„å…ƒç´ éƒ½å¤åˆ¶åˆ° index ä½ç½®ä¸Šï¼Œè¯¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œå¯ä»¥çœ‹å‡º ArrayList åˆ é™¤å…ƒç´ çš„ä»£ä»·æ˜¯éå¸¸é«˜çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    rangeCheck(index);</span><br><span class="line">    modCount++;</span><br><span class="line">    E oldValue = elementData(index);</span><br><span class="line">    <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index, numMoved);</span><br><span class="line">    elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Fail-Fast"><a href="#4-Fail-Fast" class="headerlink" title="4. Fail-Fast"></a>4. Fail-Fast</h3><p>modCount ç”¨æ¥è®°å½• ArrayList ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–æ˜¯æŒ‡æ·»åŠ æˆ–è€…åˆ é™¤è‡³å°‘ä¸€ä¸ªå…ƒç´ çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…æ˜¯è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°ï¼Œä»…ä»…åªæ˜¯è®¾ç½®å…ƒç´ çš„å€¼ä¸ç®—ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚</p><p>åœ¨è¿›è¡Œåºåˆ—åŒ–æˆ–è€…è¿­ä»£ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦æ¯”è¾ƒæ“ä½œå‰å modCount æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæ”¹å˜äº†éœ€è¦æŠ›å‡º ConcurrentModificationExceptionã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException</span>&#123;</span><br><span class="line">    <span class="comment">// Write out element count, and any hidden stuff</span></span><br><span class="line">    <span class="keyword">int</span> expectedModCount = modCount;</span><br><span class="line">    s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out size as capacity for behavioural compatibility with clone()</span></span><br><span class="line">    s.writeInt(size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out all elements in the proper order.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">        s.writeObject(elementData[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-åºåˆ—åŒ–"><a href="#5-åºåˆ—åŒ–" class="headerlink" title="5. åºåˆ—åŒ–"></a>5. åºåˆ—åŒ–</h3><p>ArrayList åŸºäºæ•°ç»„å®ç°ï¼Œå¹¶ä¸”å…·æœ‰åŠ¨æ€æ‰©å®¹ç‰¹æ€§ï¼Œå› æ­¤ä¿å­˜å…ƒç´ çš„æ•°ç»„ä¸ä¸€å®šéƒ½ä¼šè¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦å…¨éƒ¨è¿›è¡Œåºåˆ—åŒ–ã€‚</p><p>ä¿å­˜å…ƒç´ çš„æ•°ç»„ elementData ä½¿ç”¨ transient ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å£°æ˜æ•°ç»„é»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Object[] elementData; <span class="comment">// non-private to simplify nested class access</span></span><br></pre></td></tr></table></figure><p>ArrayList å®ç°äº† writeObject() å’Œ readObject() æ¥æ§åˆ¶åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å…ƒç´ å¡«å……é‚£éƒ¨åˆ†å†…å®¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    elementData = EMPTY_ELEMENTDATA;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read in size, and any hidden stuff</span></span><br><span class="line">    s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read in capacity</span></span><br><span class="line">    s.readInt(); <span class="comment">// ignored</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// be like clone(), allocate array based upon size not capacity</span></span><br><span class="line">        ensureCapacityInternal(size);</span><br><span class="line"></span><br><span class="line">        Object[] a = elementData;</span><br><span class="line">        <span class="comment">// Read in all elements in the proper order.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">            a[i] = s.readObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> java.io.IOException</span>&#123;</span><br><span class="line">    <span class="comment">// Write out element count, and any hidden stuff</span></span><br><span class="line">    <span class="keyword">int</span> expectedModCount = modCount;</span><br><span class="line">    s.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out size as capacity for behavioural compatibility with clone()</span></span><br><span class="line">    s.writeInt(size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Write out all elements in the proper order.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++) &#123;</span><br><span class="line">        s.writeObject(elementData[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–æ—¶éœ€è¦ä½¿ç”¨ ObjectOutputStream çš„ writeObject() å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµå¹¶è¾“å‡ºã€‚è€Œ writeObject() æ–¹æ³•åœ¨ä¼ å…¥çš„å¯¹è±¡å­˜åœ¨ writeObject() çš„æ—¶å€™ä¼šå»åå°„è°ƒç”¨è¯¥å¯¹è±¡çš„ writeObject() æ¥å®ç°åºåˆ—åŒ–ã€‚ååºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯ ObjectInputStream çš„ readObject() æ–¹æ³•ï¼ŒåŸç†ç±»ä¼¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayList list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(file));</span><br><span class="line">oos.writeObject(list);</span><br></pre></td></tr></table></figure><h2 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h2><h3 id="1-åŒæ­¥"><a href="#1-åŒæ­¥" class="headerlink" title="1. åŒæ­¥"></a>1. åŒæ­¥</h3><p>å®ƒçš„å®ç°ä¸ ArrayList ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨äº† synchronized è¿›è¡ŒåŒæ­¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    ensureCapacityHelper(elementCount + <span class="number">1</span>);</span><br><span class="line">    elementData[elementCount++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= elementCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> elementData(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ä¸-ArrayList-çš„æ¯”è¾ƒ"><a href="#2-ä¸-ArrayList-çš„æ¯”è¾ƒ" class="headerlink" title="2. ä¸ ArrayList çš„æ¯”è¾ƒ"></a>2. ä¸ ArrayList çš„æ¯”è¾ƒ</h3><ul><li>Vector æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤å¼€é”€å°±æ¯” ArrayList è¦å¤§ï¼Œè®¿é—®é€Ÿåº¦æ›´æ…¢ã€‚æœ€å¥½ä½¿ç”¨ ArrayList è€Œä¸æ˜¯ Vectorï¼Œå› ä¸ºåŒæ­¥æ“ä½œå®Œå…¨å¯ä»¥ç”±ç¨‹åºå‘˜è‡ªå·±æ¥æ§åˆ¶ï¼›</li><li>Vector æ¯æ¬¡æ‰©å®¹è¯·æ±‚å…¶å¤§å°çš„ 2 å€ç©ºé—´ï¼Œè€Œ ArrayList æ˜¯ 1.5 å€ã€‚</li></ul><h3 id="3-æ›¿ä»£æ–¹æ¡ˆ"><a href="#3-æ›¿ä»£æ–¹æ¡ˆ" class="headerlink" title="3. æ›¿ä»£æ–¹æ¡ˆ"></a>3. æ›¿ä»£æ–¹æ¡ˆ</h3><p>å¯ä»¥ä½¿ç”¨ <code>Collections.synchronizedList();</code> å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ ArrayListã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">List&lt;String&gt; synList = Collections.synchronizedList(list);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ concurrent å¹¶å‘åŒ…ä¸‹çš„ CopyOnWriteArrayList ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure><h2 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h2><h3 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h3><p>å†™æ“ä½œåœ¨ä¸€ä¸ªå¤åˆ¶çš„æ•°ç»„ä¸Šè¿›è¡Œï¼Œè¯»æ“ä½œè¿˜æ˜¯åœ¨åŸå§‹æ•°ç»„ä¸­è¿›è¡Œï¼Œè¯»å†™åˆ†ç¦»ï¼Œäº’ä¸å½±å“ã€‚</p><p>å†™æ“ä½œéœ€è¦åŠ é”ï¼Œé˜²æ­¢å¹¶å‘å†™å…¥æ—¶å¯¼è‡´å†™å…¥æ•°æ®ä¸¢å¤±ã€‚</p><p>å†™æ“ä½œç»“æŸä¹‹åéœ€è¦æŠŠåŸå§‹æ•°ç»„æŒ‡å‘æ–°çš„å¤åˆ¶æ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="keyword">int</span> len = elements.length;</span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setArray</span><span class="params">(Object[] a)</span> </span>&#123;</span><br><span class="line">    array = a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">get</span><span class="params">(Object[] a, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (E) a[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><p>CopyOnWriteArrayList åœ¨å†™æ“ä½œçš„åŒæ—¶å…è®¸è¯»æ“ä½œï¼Œå¤§å¤§æé«˜äº†è¯»æ“ä½œçš„æ€§èƒ½ï¼Œå› æ­¤å¾ˆé€‚åˆè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ã€‚</p><p>ä½†æ˜¯ CopyOnWriteArrayList æœ‰å…¶ç¼ºé™·ï¼š</p><ul><li>å†…å­˜å ç”¨ï¼šåœ¨å†™æ“ä½œæ—¶éœ€è¦å¤åˆ¶ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œä½¿å¾—å†…å­˜å ç”¨ä¸ºåŸæ¥çš„ä¸¤å€å·¦å³ï¼›</li><li>æ•°æ®ä¸ä¸€è‡´ï¼šè¯»æ“ä½œä¸èƒ½è¯»å–å®æ—¶æ€§çš„æ•°æ®ï¼Œå› ä¸ºéƒ¨åˆ†å†™æ“ä½œçš„æ•°æ®è¿˜æœªåŒæ­¥åˆ°è¯»æ•°ç»„ä¸­ã€‚</li></ul><p>æ‰€ä»¥ CopyOnWriteArrayList ä¸é€‚åˆå†…å­˜æ•æ„Ÿä»¥åŠå¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ã€‚</p><h2 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h2><h3 id="1-æ¦‚è§ˆ-1"><a href="#1-æ¦‚è§ˆ-1" class="headerlink" title="1. æ¦‚è§ˆ"></a>1. æ¦‚è§ˆ</h3><p>åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œä½¿ç”¨ Node å­˜å‚¨é“¾è¡¨èŠ‚ç‚¹ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªé“¾è¡¨å­˜å‚¨äº† first å’Œ last æŒ‡é’ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; first;</span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; last;</span><br></pre></td></tr></table></figure><p><div align="center"> <img src="pics/c8563120-cb00-4dd6-9213-9d9b337a7f7c.png" width="500px"> </div><br></p><h3 id="2-ä¸-ArrayList-çš„æ¯”è¾ƒ-1"><a href="#2-ä¸-ArrayList-çš„æ¯”è¾ƒ-1" class="headerlink" title="2. ä¸ ArrayList çš„æ¯”è¾ƒ"></a>2. ä¸ ArrayList çš„æ¯”è¾ƒ</h3><ul><li>ArrayList åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼ŒLinkedList åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼›</li><li>ArrayList æ”¯æŒéšæœºè®¿é—®ï¼ŒLinkedList ä¸æ”¯æŒï¼›</li><li>LinkedList åœ¨ä»»æ„ä½ç½®æ·»åŠ åˆ é™¤å…ƒç´ æ›´å¿«ã€‚</li></ul><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œä»¥ä¸‹æºç åˆ†æä»¥ JDK 1.7 ä¸ºä¸»ã€‚</p><h3 id="1-å­˜å‚¨ç»“æ„"><a href="#1-å­˜å‚¨ç»“æ„" class="headerlink" title="1. å­˜å‚¨ç»“æ„"></a>1. å­˜å‚¨ç»“æ„</h3><p>å†…éƒ¨åŒ…å«äº†ä¸€ä¸ª Entry ç±»å‹çš„æ•°ç»„ tableã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> Entry[] table;</span><br></pre></td></tr></table></figure><p>Entry å­˜å‚¨ç€é”®å€¼å¯¹ã€‚å®ƒåŒ…å«äº†å››ä¸ªå­—æ®µï¼Œä» next å­—æ®µæˆ‘ä»¬å¯ä»¥çœ‹å‡º Entry æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚å³æ•°ç»„ä¸­çš„æ¯ä¸ªä½ç½®è¢«å½“æˆä¸€ä¸ªæ¡¶ï¼Œä¸€ä¸ªæ¡¶å­˜æ”¾ä¸€ä¸ªé“¾è¡¨ã€‚HashMap ä½¿ç”¨æ‹‰é“¾æ³•æ¥è§£å†³å†²çªï¼ŒåŒä¸€ä¸ªé“¾è¡¨ä¸­å­˜æ”¾å“ˆå¸Œå€¼å’Œæ•£åˆ—æ¡¶å–æ¨¡è¿ç®—ç»“æœç›¸åŒçš„ Entryã€‚</p><p><div align="center"> <img src="pics/9420a703-1f9d-42ce-808e-bcb82b56483d.png" width="550px"> </div><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Entry&lt;K,V&gt; next;</span><br><span class="line">    <span class="keyword">int</span> hash;</span><br><span class="line"></span><br><span class="line">    Entry(<span class="keyword">int</span> h, K k, V v, Entry&lt;K,V&gt; n) &#123;</span><br><span class="line">        value = v;</span><br><span class="line">        next = n;</span><br><span class="line">        key = k;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">        V oldValue = value;</span><br><span class="line">        value = newValue;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Map.Entry))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        Map.Entry e = (Map.Entry)o;</span><br><span class="line">        Object k1 = getKey();</span><br><span class="line">        Object k2 = e.getKey();</span><br><span class="line">        <span class="keyword">if</span> (k1 == k2 || (k1 != <span class="keyword">null</span> &amp;&amp; k1.equals(k2))) &#123;</span><br><span class="line">            Object v1 = getValue();</span><br><span class="line">            Object v2 = e.getValue();</span><br><span class="line">            <span class="keyword">if</span> (v1 == v2 || (v1 != <span class="keyword">null</span> &amp;&amp; v1.equals(v2)))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(getKey()) ^ Objects.hashCode(getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getKey() + <span class="string">"="</span> + getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ‹‰é“¾æ³•çš„å·¥ä½œåŸç†"><a href="#2-æ‹‰é“¾æ³•çš„å·¥ä½œåŸç†" class="headerlink" title="2. æ‹‰é“¾æ³•çš„å·¥ä½œåŸç†"></a>2. æ‹‰é“¾æ³•çš„å·¥ä½œåŸç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">"K1"</span>, <span class="string">"V1"</span>);</span><br><span class="line">map.put(<span class="string">"K2"</span>, <span class="string">"V2"</span>);</span><br><span class="line">map.put(<span class="string">"K3"</span>, <span class="string">"V3"</span>);</span><br></pre></td></tr></table></figure><ul><li>æ–°å»ºä¸€ä¸ª HashMapï¼Œé»˜è®¤å¤§å°ä¸º 16ï¼›</li><li>æ’å…¥ &lt;K1,V1&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K1 çš„ hashCode ä¸º 115ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 115%16=3ã€‚</li><li>æ’å…¥ &lt;K2,V2&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K2 çš„ hashCode ä¸º 118ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 118%16=6ã€‚</li><li>æ’å…¥ &lt;K3,V3&gt; é”®å€¼å¯¹ï¼Œå…ˆè®¡ç®— K3 çš„ hashCode ä¸º 118ï¼Œä½¿ç”¨é™¤ç•™ä½™æ•°æ³•å¾—åˆ°æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ 118%16=6ï¼Œæ’åœ¨ &lt;K2,V2&gt; å‰é¢ã€‚</li></ul><p>åº”è¯¥æ³¨æ„åˆ°é“¾è¡¨çš„æ’å…¥æ˜¯ä»¥å¤´æ’æ³•æ–¹å¼è¿›è¡Œçš„ï¼Œä¾‹å¦‚ä¸Šé¢çš„ &lt;K3,V3&gt; ä¸æ˜¯æ’åœ¨ &lt;K2,V2&gt; åé¢ï¼Œè€Œæ˜¯æ’å…¥åœ¨é“¾è¡¨å¤´éƒ¨ã€‚</p><p>æŸ¥æ‰¾éœ€è¦åˆ†æˆä¸¤æ­¥è¿›è¡Œï¼š</p><ul><li>è®¡ç®—é”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶ï¼›</li><li>åœ¨é“¾è¡¨ä¸Šé¡ºåºæŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¾ç„¶å’Œé“¾è¡¨çš„é•¿åº¦æˆæ­£æ¯”ã€‚</li></ul><p><div align="center"> <img src="pics/e0870f80-b79e-4542-ae39-7420d4b0d8fe.png" width="550px"> </div><br></p><h3 id="3-put-æ“ä½œ"><a href="#3-put-æ“ä½œ" class="headerlink" title="3. put æ“ä½œ"></a>3. put æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (table == EMPTY_TABLE) &#123;</span><br><span class="line">        inflateTable(threshold);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é”®ä¸º null å•ç‹¬å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">    <span class="keyword">int</span> hash = hash(key);</span><br><span class="line">    <span class="comment">// ç¡®å®šæ¡¶ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">int</span> i = indexFor(hash, table.length);</span><br><span class="line">    <span class="comment">// å…ˆæ‰¾å‡ºæ˜¯å¦å·²ç»å­˜åœ¨é”®ä¸º key çš„é”®å€¼å¯¹ï¼Œå¦‚æœå­˜åœ¨çš„è¯å°±æ›´æ–°è¿™ä¸ªé”®å€¼å¯¹çš„å€¼ä¸º value</span></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">        Object k;</span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            e.value = value;</span><br><span class="line">            e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// æ’å…¥æ–°é”®å€¼å¯¹</span></span><br><span class="line">    addEntry(hash, key, value, i);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HashMap å…è®¸æ’å…¥é”®ä¸º null çš„é”®å€¼å¯¹ã€‚ä½†æ˜¯å› ä¸ºæ— æ³•è°ƒç”¨ null çš„ hashCode() æ–¹æ³•ï¼Œä¹Ÿå°±æ— æ³•ç¡®å®šè¯¥é”®å€¼å¯¹çš„æ¡¶ä¸‹æ ‡ï¼Œåªèƒ½é€šè¿‡å¼ºåˆ¶æŒ‡å®šä¸€ä¸ªæ¡¶ä¸‹æ ‡æ¥å­˜æ”¾ã€‚HashMap ä½¿ç”¨ç¬¬ 0 ä¸ªæ¡¶å­˜æ”¾é”®ä¸º null çš„é”®å€¼å¯¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> V <span class="title">putForNullKey</span><span class="params">(V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[<span class="number">0</span>]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.key == <span class="keyword">null</span>) &#123;</span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            e.value = value;</span><br><span class="line">            e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    modCount++;</span><br><span class="line">    addEntry(<span class="number">0</span>, <span class="keyword">null</span>, value, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é“¾è¡¨çš„å¤´æ’æ³•ï¼Œä¹Ÿå°±æ˜¯æ–°çš„é”®å€¼å¯¹æ’åœ¨é“¾è¡¨çš„å¤´éƒ¨ï¼Œè€Œä¸æ˜¯é“¾è¡¨çš„å°¾éƒ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((size &gt;= threshold) &amp;&amp; (<span class="keyword">null</span> != table[bucketIndex])) &#123;</span><br><span class="line">        resize(<span class="number">2</span> * table.length);</span><br><span class="line">        hash = (<span class="keyword">null</span> != key) ? hash(key) : <span class="number">0</span>;</span><br><span class="line">        bucketIndex = indexFor(hash, table.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    createEntry(hash, key, value, bucketIndex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;</span><br><span class="line">    Entry&lt;K,V&gt; e = table[bucketIndex];</span><br><span class="line">    <span class="comment">// å¤´æ’æ³•ï¼Œé“¾è¡¨å¤´éƒ¨æŒ‡å‘æ–°çš„é”®å€¼å¯¹</span></span><br><span class="line">    table[bucketIndex] = <span class="keyword">new</span> Entry&lt;&gt;(hash, key, value, e);</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Entry(<span class="keyword">int</span> h, K k, V v, Entry&lt;K,V&gt; n) &#123;</span><br><span class="line">    value = v;</span><br><span class="line">    next = n;</span><br><span class="line">    key = k;</span><br><span class="line">    hash = h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-ç¡®å®šæ¡¶ä¸‹æ ‡"><a href="#4-ç¡®å®šæ¡¶ä¸‹æ ‡" class="headerlink" title="4. ç¡®å®šæ¡¶ä¸‹æ ‡"></a>4. ç¡®å®šæ¡¶ä¸‹æ ‡</h3><p>å¾ˆå¤šæ“ä½œéƒ½éœ€è¦å…ˆç¡®å®šä¸€ä¸ªé”®å€¼å¯¹æ‰€åœ¨çš„æ¡¶ä¸‹æ ‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> hash = hash(key);</span><br><span class="line"><span class="keyword">int</span> i = indexFor(hash, table.length);</span><br></pre></td></tr></table></figure><p><strong>4.1 è®¡ç®— hash å€¼</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = hashSeed;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != h &amp;&amp; k <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        <span class="keyword">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    h ^= k.hashCode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This function ensures that hashCodes that differ only by</span></span><br><span class="line">    <span class="comment">// constant multiples at each bit position have a bounded</span></span><br><span class="line">    <span class="comment">// number of collisions (approximately 8 at default load factor).</span></span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">20</span>) ^ (h &gt;&gt;&gt; <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="number">7</span>) ^ (h &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4.2 å–æ¨¡</strong> </p><p>ä»¤ x = 1&lt;&lt;4ï¼Œå³ x ä¸º 2 çš„ 4 æ¬¡æ–¹ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x   : 00010000</span><br><span class="line">x-1 : 00001111</span><br></pre></td></tr></table></figure><p>ä»¤ä¸€ä¸ªæ•° y ä¸ x-1 åšä¸è¿ç®—ï¼Œå¯ä»¥å»é™¤ y ä½çº§è¡¨ç¤ºçš„ç¬¬ 4 ä½ä»¥ä¸Šæ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y       : 10110010</span><br><span class="line">x-1     : 00001111</span><br><span class="line">y&amp;(x-1) : 00000010</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ€§è´¨å’Œ y å¯¹ x å–æ¨¡æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y   : 10110010</span><br><span class="line">x   : 00010000</span><br><span class="line">y%x : 00000010</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“ï¼Œä½è¿ç®—çš„ä»£ä»·æ¯”æ±‚æ¨¡è¿ç®—å°çš„å¤šï¼Œå› æ­¤åœ¨è¿›è¡Œè¿™ç§è®¡ç®—æ—¶ç”¨ä½è¿ç®—çš„è¯èƒ½å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚</p><p>ç¡®å®šæ¡¶ä¸‹æ ‡çš„æœ€åä¸€æ­¥æ˜¯å°† key çš„ hash å€¼å¯¹æ¡¶ä¸ªæ•°å–æ¨¡ï¼šhash%capacityï¼Œå¦‚æœèƒ½ä¿è¯ capacity ä¸º 2 çš„ n æ¬¡æ–¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†è¿™ä¸ªæ“ä½œè½¬æ¢ä¸ºä½è¿ç®—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-æ‰©å®¹-åŸºæœ¬åŸç†"><a href="#5-æ‰©å®¹-åŸºæœ¬åŸç†" class="headerlink" title="5. æ‰©å®¹-åŸºæœ¬åŸç†"></a>5. æ‰©å®¹-åŸºæœ¬åŸç†</h3><p>è®¾ HashMap çš„ table é•¿åº¦ä¸º Mï¼Œéœ€è¦å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡ä¸º Nï¼Œå¦‚æœå“ˆå¸Œå‡½æ•°æ»¡è¶³å‡åŒ€æ€§çš„è¦æ±‚ï¼Œé‚£ä¹ˆæ¯æ¡é“¾è¡¨çš„é•¿åº¦å¤§çº¦ä¸º N/Mï¼Œå› æ­¤å¹³å‡æŸ¥æ‰¾æ¬¡æ•°çš„å¤æ‚åº¦ä¸º O(N/M)ã€‚</p><p>ä¸ºäº†è®©æŸ¥æ‰¾çš„æˆæœ¬é™ä½ï¼Œåº”è¯¥å°½å¯èƒ½ä½¿å¾— N/M å°½å¯èƒ½å°ï¼Œå› æ­¤éœ€è¦ä¿è¯ M å°½å¯èƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´ table è¦å°½å¯èƒ½å¤§ã€‚HashMap é‡‡ç”¨åŠ¨æ€æ‰©å®¹æ¥æ ¹æ®å½“å‰çš„ N å€¼æ¥è°ƒæ•´ M å€¼ï¼Œä½¿å¾—ç©ºé—´æ•ˆç‡å’Œæ—¶é—´æ•ˆç‡éƒ½èƒ½å¾—åˆ°ä¿è¯ã€‚</p><p>å’Œæ‰©å®¹ç›¸å…³çš„å‚æ•°ä¸»è¦æœ‰ï¼šcapacityã€sizeã€threshold å’Œ load_factorã€‚</p><table><thead><tr><th style="text-align:center">å‚æ•°</th><th style="text-align:left">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">capacity</td><td style="text-align:left">table çš„å®¹é‡å¤§å°ï¼Œé»˜è®¤ä¸º 16ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ capacity å¿…é¡»ä¿è¯ä¸º 2 çš„ n æ¬¡æ–¹ã€‚</td></tr><tr><td style="text-align:center">size</td><td style="text-align:left">é”®å€¼å¯¹æ•°é‡ã€‚</td></tr><tr><td style="text-align:center">threshold</td><td style="text-align:left">size çš„ä¸´ç•Œå€¼ï¼Œå½“ size å¤§äºç­‰äº threshold å°±å¿…é¡»è¿›è¡Œæ‰©å®¹æ“ä½œã€‚</td></tr><tr><td style="text-align:center">loadFactor</td><td style="text-align:left">è£…è½½å› å­ï¼Œtable èƒ½å¤Ÿä½¿ç”¨çš„æ¯”ä¾‹ï¼Œthreshold = capacity * loadFactorã€‚</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">transient</span> Entry[] table;</span><br><span class="line"></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br></pre></td></tr></table></figure><p>ä»ä¸‹é¢çš„æ·»åŠ å…ƒç´ ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“éœ€è¦æ‰©å®¹æ—¶ï¼Œä»¤ capacity ä¸ºåŸæ¥çš„ä¸¤å€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;</span><br><span class="line">    Entry&lt;K,V&gt; e = table[bucketIndex];</span><br><span class="line">    table[bucketIndex] = <span class="keyword">new</span> Entry&lt;&gt;(hash, key, value, e);</span><br><span class="line">    <span class="keyword">if</span> (size++ &gt;= threshold)</span><br><span class="line">        resize(<span class="number">2</span> * table.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰©å®¹ä½¿ç”¨ resize() å®ç°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰©å®¹æ“ä½œåŒæ ·éœ€è¦æŠŠ oldTable çš„æ‰€æœ‰é”®å€¼å¯¹é‡æ–°æ’å…¥ newTable ä¸­ï¼Œå› æ­¤è¿™ä¸€æ­¥æ˜¯å¾ˆè´¹æ—¶çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;</span><br><span class="line">    Entry[] oldTable = table;</span><br><span class="line">    <span class="keyword">int</span> oldCapacity = oldTable.length;</span><br><span class="line">    <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;</span><br><span class="line">        threshold = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Entry[] newTable = <span class="keyword">new</span> Entry[newCapacity];</span><br><span class="line">    transfer(newTable);</span><br><span class="line">    table = newTable;</span><br><span class="line">    threshold = (<span class="keyword">int</span>)(newCapacity * loadFactor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Entry[] newTable)</span> </span>&#123;</span><br><span class="line">    Entry[] src = table;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = newTable.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.length; j++) &#123;</span><br><span class="line">        Entry&lt;K,V&gt; e = src[j];</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            src[j] = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">                <span class="keyword">int</span> i = indexFor(e.hash, newCapacity);</span><br><span class="line">                e.next = newTable[i];</span><br><span class="line">                newTable[i] = e;</span><br><span class="line">                e = next;</span><br><span class="line">            &#125; <span class="keyword">while</span> (e != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-æ‰©å®¹-é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡"><a href="#6-æ‰©å®¹-é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡" class="headerlink" title="6. æ‰©å®¹-é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡"></a>6. æ‰©å®¹-é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡</h3><p>åœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œéœ€è¦æŠŠé”®å€¼å¯¹é‡æ–°æ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸Šã€‚HashMap ä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„æœºåˆ¶ï¼Œå¯ä»¥é™ä½é‡æ–°è®¡ç®—æ¡¶ä¸‹æ ‡çš„æ“ä½œã€‚</p><p>å‡è®¾åŸæ•°ç»„é•¿åº¦ capacity ä¸º 16ï¼Œæ‰©å®¹ä¹‹å new capacity ä¸º 32ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">capacity     : 00010000</span><br><span class="line">new capacity : 00100000</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸€ä¸ª Keyï¼Œ</p><ul><li>å®ƒçš„å“ˆå¸Œå€¼å¦‚æœåœ¨ç¬¬ 5 ä½ä¸Šä¸º 0ï¼Œé‚£ä¹ˆå–æ¨¡å¾—åˆ°çš„ç»“æœå’Œä¹‹å‰ä¸€æ ·ï¼›</li><li>å¦‚æœä¸º 1ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç»“æœä¸ºåŸæ¥çš„ç»“æœ +16ã€‚</li></ul><h3 id="7-è®¡ç®—æ•°ç»„å®¹é‡"><a href="#7-è®¡ç®—æ•°ç»„å®¹é‡" class="headerlink" title="7. è®¡ç®—æ•°ç»„å®¹é‡"></a>7. è®¡ç®—æ•°ç»„å®¹é‡</h3><p>HashMap æ„é€ å‡½æ•°å…è®¸ç”¨æˆ·ä¼ å…¥çš„å®¹é‡ä¸æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œå› ä¸ºå®ƒå¯ä»¥è‡ªåŠ¨åœ°å°†ä¼ å…¥çš„å®¹é‡è½¬æ¢ä¸º 2 çš„ n æ¬¡æ–¹ã€‚</p><p>å…ˆè€ƒè™‘å¦‚ä½•æ±‚ä¸€ä¸ªæ•°çš„æ©ç ï¼Œå¯¹äº 10010000ï¼Œå®ƒçš„æ©ç ä¸º 11111111ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¾—åˆ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mask |= mask &gt;&gt; 1    11011000</span><br><span class="line">mask |= mask &gt;&gt; 2    11111110</span><br><span class="line">mask |= mask &gt;&gt; 4    11111111</span><br></pre></td></tr></table></figure><p>mask+1 æ˜¯å¤§äºåŸå§‹æ•°å­—çš„æœ€å°çš„ 2 çš„ n æ¬¡æ–¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num     10010000</span><br><span class="line">mask+1 100000000</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ HashMap ä¸­è®¡ç®—æ•°ç»„å®¹é‡çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = cap - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-é“¾è¡¨è½¬çº¢é»‘æ ‘"><a href="#8-é“¾è¡¨è½¬çº¢é»‘æ ‘" class="headerlink" title="8. é“¾è¡¨è½¬çº¢é»‘æ ‘"></a>8. é“¾è¡¨è½¬çº¢é»‘æ ‘</h3><p>ä» JDK 1.8 å¼€å§‹ï¼Œä¸€ä¸ªæ¡¶å­˜å‚¨çš„é“¾è¡¨é•¿åº¦å¤§äº 8 æ—¶ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p><h3 id="9-ä¸-HashTable-çš„æ¯”è¾ƒ"><a href="#9-ä¸-HashTable-çš„æ¯”è¾ƒ" class="headerlink" title="9. ä¸ HashTable çš„æ¯”è¾ƒ"></a>9. ä¸ HashTable çš„æ¯”è¾ƒ</h3><ul><li>HashTable ä½¿ç”¨ synchronized æ¥è¿›è¡ŒåŒæ­¥ã€‚</li><li>HashMap å¯ä»¥æ’å…¥é”®ä¸º null çš„ Entryã€‚</li><li>HashMap çš„è¿­ä»£å™¨æ˜¯ fail-fast è¿­ä»£å™¨ã€‚</li><li>HashMap ä¸èƒ½ä¿è¯éšç€æ—¶é—´çš„æ¨ç§» Map ä¸­çš„å…ƒç´ æ¬¡åºæ˜¯ä¸å˜çš„ã€‚</li></ul><h2 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h2><h3 id="1-å­˜å‚¨ç»“æ„-1"><a href="#1-å­˜å‚¨ç»“æ„-1" class="headerlink" title="1. å­˜å‚¨ç»“æ„"></a>1. å­˜å‚¨ç»“æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HashEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    <span class="keyword">volatile</span> V value;</span><br><span class="line">    <span class="keyword">volatile</span> HashEntry&lt;K,V&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ConcurrentHashMap å’Œ HashMap å®ç°ä¸Šç±»ä¼¼ï¼Œæœ€ä¸»è¦çš„å·®åˆ«æ˜¯ ConcurrentHashMap é‡‡ç”¨äº†åˆ†æ®µé”ï¼ˆSegmentï¼‰ï¼Œæ¯ä¸ªåˆ†æ®µé”ç»´æŠ¤ç€å‡ ä¸ªæ¡¶ï¼ˆHashEntryï¼‰ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ä¸åŒåˆ†æ®µé”ä¸Šçš„æ¡¶ï¼Œä»è€Œä½¿å…¶å¹¶å‘åº¦æ›´é«˜ï¼ˆå¹¶å‘åº¦å°±æ˜¯ Segment çš„ä¸ªæ•°ï¼‰ã€‚</p><p>Segment ç»§æ‰¿è‡ª ReentrantLockã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Segment</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">ReentrantLock</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2249069246763182397L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SCAN_RETRIES =</span><br><span class="line">        Runtime.getRuntime().availableProcessors() &gt; <span class="number">1</span> ? <span class="number">64</span> : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Segment&lt;K,V&gt;[] segments;</span><br></pre></td></tr></table></figure><p>é»˜è®¤çš„å¹¶å‘çº§åˆ«ä¸º 16ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤åˆ›å»º 16 ä¸ª Segmentã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CONCURRENCY_LEVEL = <span class="number">16</span>;</span><br></pre></td></tr></table></figure><p><div align="center"> <img src="pics/db808eff-31d7-4229-a4ad-b8ae71870a3a.png" width="550px"> </div><br></p><h3 id="2-size-æ“ä½œ"><a href="#2-size-æ“ä½œ" class="headerlink" title="2. size æ“ä½œ"></a>2. size æ“ä½œ</h3><p>æ¯ä¸ª Segment ç»´æŠ¤äº†ä¸€ä¸ª count å˜é‡æ¥ç»Ÿè®¡è¯¥ Segment ä¸­çš„é”®å€¼å¯¹ä¸ªæ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The number of elements. Accessed only either within locks</span></span><br><span class="line"><span class="comment"> * or among other volatile reads that maintain visibility.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> count;</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œ size æ“ä½œæ—¶ï¼Œéœ€è¦éå†æ‰€æœ‰ Segment ç„¶åæŠŠ count ç´¯è®¡èµ·æ¥ã€‚</p><p>ConcurrentHashMap åœ¨æ‰§è¡Œ size æ“ä½œæ—¶å…ˆå°è¯•ä¸åŠ é”ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡ä¸åŠ é”æ“ä½œå¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p><p>å°è¯•æ¬¡æ•°ä½¿ç”¨ RETRIES_BEFORE_LOCK å®šä¹‰ï¼Œè¯¥å€¼ä¸º 2ï¼Œretries åˆå§‹å€¼ä¸º -1ï¼Œå› æ­¤å°è¯•æ¬¡æ•°ä¸º 3ã€‚</p><p>å¦‚æœå°è¯•çš„æ¬¡æ•°è¶…è¿‡ 3 æ¬¡ï¼Œå°±éœ€è¦å¯¹æ¯ä¸ª Segment åŠ é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Number of unsynchronized retries in size and containsValue</span></span><br><span class="line"><span class="comment"> * methods before resorting to locking. This is used to avoid</span></span><br><span class="line"><span class="comment"> * unbounded retries if tables undergo continuous modification</span></span><br><span class="line"><span class="comment"> * which would make it impossible to obtain an accurate result.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RETRIES_BEFORE_LOCK = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Try a few times to get accurate count. On failure due to</span></span><br><span class="line">    <span class="comment">// continuous async changes in table, resort to locking.</span></span><br><span class="line">    <span class="keyword">final</span> Segment&lt;K,V&gt;[] segments = <span class="keyword">this</span>.segments;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">boolean</span> overflow; <span class="comment">// true if size overflows 32 bits</span></span><br><span class="line">    <span class="keyword">long</span> sum;         <span class="comment">// sum of modCounts</span></span><br><span class="line">    <span class="keyword">long</span> last = <span class="number">0L</span>;   <span class="comment">// previous sum</span></span><br><span class="line">    <span class="keyword">int</span> retries = -<span class="number">1</span>; <span class="comment">// first iteration isn't retry</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">// è¶…è¿‡å°è¯•æ¬¡æ•°ï¼Œåˆ™å¯¹æ¯ä¸ª Segment åŠ é”</span></span><br><span class="line">            <span class="keyword">if</span> (retries++ == RETRIES_BEFORE_LOCK) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; segments.length; ++j)</span><br><span class="line">                    ensureSegment(j).lock(); <span class="comment">// force creation</span></span><br><span class="line">            &#125;</span><br><span class="line">            sum = <span class="number">0L</span>;</span><br><span class="line">            size = <span class="number">0</span>;</span><br><span class="line">            overflow = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; segments.length; ++j) &#123;</span><br><span class="line">                Segment&lt;K,V&gt; seg = segmentAt(segments, j);</span><br><span class="line">                <span class="keyword">if</span> (seg != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    sum += seg.modCount;</span><br><span class="line">                    <span class="keyword">int</span> c = seg.count;</span><br><span class="line">                    <span class="keyword">if</span> (c &lt; <span class="number">0</span> || (size += c) &lt; <span class="number">0</span>)</span><br><span class="line">                        overflow = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¿ç»­ä¸¤æ¬¡å¾—åˆ°çš„ç»“æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªç»“æœæ˜¯æ­£ç¡®çš„</span></span><br><span class="line">            <span class="keyword">if</span> (sum == last)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            last = sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (retries &gt; RETRIES_BEFORE_LOCK) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; segments.length; ++j)</span><br><span class="line">                segmentAt(segments, j).unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> overflow ? Integer.MAX_VALUE : size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-JDK-1-8-çš„æ”¹åŠ¨"><a href="#3-JDK-1-8-çš„æ”¹åŠ¨" class="headerlink" title="3. JDK 1.8 çš„æ”¹åŠ¨"></a>3. JDK 1.8 çš„æ”¹åŠ¨</h3><p>JDK 1.7 ä½¿ç”¨åˆ†æ®µé”æœºåˆ¶æ¥å®ç°å¹¶å‘æ›´æ–°æ“ä½œï¼Œæ ¸å¿ƒç±»ä¸º Segmentï¼Œå®ƒç»§æ‰¿è‡ªé‡å…¥é” ReentrantLockï¼Œå¹¶å‘åº¦ä¸ Segment æ•°é‡ç›¸ç­‰ã€‚</p><p>JDK 1.8 ä½¿ç”¨äº† CAS æ“ä½œæ¥æ”¯æŒæ›´é«˜çš„å¹¶å‘åº¦ï¼Œåœ¨ CAS æ“ä½œå¤±è´¥æ—¶ä½¿ç”¨å†…ç½®é” synchronizedã€‚</p><p>å¹¶ä¸” JDK 1.8 çš„å®ç°ä¹Ÿåœ¨é“¾è¡¨è¿‡é•¿æ—¶ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</p><h2 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h2><h3 id="å­˜å‚¨ç»“æ„"><a href="#å­˜å‚¨ç»“æ„" class="headerlink" title="å­˜å‚¨ç»“æ„"></a>å­˜å‚¨ç»“æ„</h3><p>ç»§æ‰¿è‡ª HashMapï¼Œå› æ­¤å…·æœ‰å’Œ HashMap ä¸€æ ·çš„å¿«é€ŸæŸ¥æ‰¾ç‰¹æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨æ¥ç»´æŠ¤æ’å…¥é¡ºåºæˆ–è€… LRU é¡ºåºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The head (eldest) of the doubly linked list.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; head;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The tail (youngest) of the doubly linked list.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; tail;</span><br></pre></td></tr></table></figure><p>accessOrder å†³å®šäº†é¡ºåºï¼Œé»˜è®¤ä¸º falseï¼Œæ­¤æ—¶ç»´æŠ¤çš„æ˜¯æ’å…¥é¡ºåºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">boolean</span> accessOrder;</span><br></pre></td></tr></table></figure><p>LinkedHashMap æœ€é‡è¦çš„æ˜¯ä»¥ä¸‹ç”¨äºç»´æŠ¤é¡ºåºçš„å‡½æ•°ï¼Œå®ƒä»¬ä¼šåœ¨ putã€get ç­‰æ–¹æ³•ä¸­è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeAccess</span><span class="params">(Node&lt;K,V&gt; p)</span> </span>&#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeInsertion</span><span class="params">(<span class="keyword">boolean</span> evict)</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure><h3 id="afterNodeAccess"><a href="#afterNodeAccess" class="headerlink" title="afterNodeAccess()"></a>afterNodeAccess()</h3><p>å½“ä¸€ä¸ªèŠ‚ç‚¹è¢«è®¿é—®æ—¶ï¼Œå¦‚æœ accessOrder ä¸º trueï¼Œåˆ™ä¼šå°†è¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´æŒ‡å®šä¸º LRU é¡ºåºä¹‹åï¼Œåœ¨æ¯æ¬¡è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œä¿è¯é“¾è¡¨å°¾éƒ¨æ˜¯æœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé“¾è¡¨é¦–éƒ¨å°±æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeAccess</span><span class="params">(Node&lt;K,V&gt; e)</span> </span>&#123; <span class="comment">// move node to last</span></span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class="line">    <span class="keyword">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">            (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">        p.after = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (b == <span class="keyword">null</span>)</span><br><span class="line">            head = a;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            b.after = a;</span><br><span class="line">        <span class="keyword">if</span> (a != <span class="keyword">null</span>)</span><br><span class="line">            a.before = b;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            last = b;</span><br><span class="line">        <span class="keyword">if</span> (last == <span class="keyword">null</span>)</span><br><span class="line">            head = p;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            p.before = last;</span><br><span class="line">            last.after = p;</span><br><span class="line">        &#125;</span><br><span class="line">        tail = p;</span><br><span class="line">        ++modCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="afterNodeInsertion"><a href="#afterNodeInsertion" class="headerlink" title="afterNodeInsertion()"></a>afterNodeInsertion()</h3><p>åœ¨ put ç­‰æ“ä½œä¹‹åæ‰§è¡Œï¼Œå½“ removeEldestEntry() æ–¹æ³•è¿”å› true æ—¶ä¼šç§»é™¤æœ€æ™šçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨é¦–éƒ¨èŠ‚ç‚¹ firstã€‚</p><p>evict åªæœ‰åœ¨æ„å»º Map çš„æ—¶å€™æ‰ä¸º falseï¼Œåœ¨è¿™é‡Œä¸º trueã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeInsertion</span><span class="params">(<span class="keyword">boolean</span> evict)</span> </span>&#123; <span class="comment">// possibly remove eldest</span></span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; first;</span><br><span class="line">    <span class="keyword">if</span> (evict &amp;&amp; (first = head) != <span class="keyword">null</span> &amp;&amp; removeEldestEntry(first)) &#123;</span><br><span class="line">        K key = first.key;</span><br><span class="line">        removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>removeEldestEntry() é»˜è®¤ä¸º falseï¼Œå¦‚æœéœ€è¦è®©å®ƒä¸º trueï¼Œéœ€è¦ç»§æ‰¿ LinkedHashMap å¹¶ä¸”è¦†ç›–è¿™ä¸ªæ–¹æ³•çš„å®ç°ï¼Œè¿™åœ¨å®ç° LRU çš„ç¼“å­˜ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œé€šè¿‡ç§»é™¤æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯ç¼“å­˜ç©ºé—´è¶³å¤Ÿï¼Œå¹¶ä¸”ç¼“å­˜çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry&lt;K,V&gt; eldest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LRU-ç¼“å­˜"><a href="#LRU-ç¼“å­˜" class="headerlink" title="LRU ç¼“å­˜"></a>LRU ç¼“å­˜</h3><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ LinkedHashMap å®ç°çš„ä¸€ä¸ª LRU ç¼“å­˜ï¼š</p><ul><li>è®¾å®šæœ€å¤§ç¼“å­˜ç©ºé—´ MAX_ENTRIES  ä¸º 3ï¼›</li><li>ä½¿ç”¨ LinkedHashMap çš„æ„é€ å‡½æ•°å°† accessOrder è®¾ç½®ä¸º trueï¼Œå¼€å¯ LRU é¡ºåºï¼›</li><li>è¦†ç›– removeEldestEntry() æ–¹æ³•å®ç°ï¼Œåœ¨èŠ‚ç‚¹å¤šäº MAX_ENTRIES å°±ä¼šå°†æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ç§»é™¤ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ENTRIES = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">removeEldestEntry</span><span class="params">(Map.Entry eldest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size() &gt; MAX_ENTRIES;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LRUCache() &#123;</span><br><span class="line">        <span class="keyword">super</span>(MAX_ENTRIES, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LRUCache&lt;Integer, String&gt; cache = <span class="keyword">new</span> LRUCache&lt;&gt;();</span><br><span class="line">    cache.put(<span class="number">1</span>, <span class="string">"a"</span>);</span><br><span class="line">    cache.put(<span class="number">2</span>, <span class="string">"b"</span>);</span><br><span class="line">    cache.put(<span class="number">3</span>, <span class="string">"c"</span>);</span><br><span class="line">    cache.get(<span class="number">1</span>);</span><br><span class="line">    cache.put(<span class="number">4</span>, <span class="string">"d"</span>);</span><br><span class="line">    System.out.println(cache.keySet());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[3, 1, 4]</span><br></pre></td></tr></table></figure><h2 id="WeakHashMap"><a href="#WeakHashMap" class="headerlink" title="WeakHashMap"></a>WeakHashMap</h2><h3 id="å­˜å‚¨ç»“æ„-1"><a href="#å­˜å‚¨ç»“æ„-1" class="headerlink" title="å­˜å‚¨ç»“æ„"></a>å­˜å‚¨ç»“æ„</h3><p>WeakHashMap çš„ Entry ç»§æ‰¿è‡ª WeakReferenceï¼Œè¢« WeakReference å…³è”çš„å¯¹è±¡åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ã€‚</p><p>WeakHashMap ä¸»è¦ç”¨æ¥å®ç°ç¼“å­˜ï¼Œé€šè¿‡ä½¿ç”¨ WeakHashMap æ¥å¼•ç”¨ç¼“å­˜å¯¹è±¡ï¼Œç”± JVM å¯¹è¿™éƒ¨åˆ†ç¼“å­˜è¿›è¡Œå›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">Object</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ConcurrentCache"><a href="#ConcurrentCache" class="headerlink" title="ConcurrentCache"></a>ConcurrentCache</h3><p>Tomcat ä¸­çš„ ConcurrentCache ä½¿ç”¨äº† WeakHashMap æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚</p><p>ConcurrentCache é‡‡å–çš„æ˜¯åˆ†ä»£ç¼“å­˜ï¼š</p><ul><li>ç»å¸¸ä½¿ç”¨çš„å¯¹è±¡æ”¾å…¥ eden ä¸­ï¼Œeden ä½¿ç”¨ ConcurrentHashMap å®ç°ï¼Œä¸ç”¨æ‹…å¿ƒä¼šè¢«å›æ”¶ï¼ˆä¼Šç”¸å›­ï¼‰ï¼›</li><li>ä¸å¸¸ç”¨çš„å¯¹è±¡æ”¾å…¥ longtermï¼Œlongterm ä½¿ç”¨ WeakHashMap å®ç°ï¼Œè¿™äº›è€å¯¹è±¡ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚</li><li>å½“è°ƒç”¨  get() æ–¹æ³•æ—¶ï¼Œä¼šå…ˆä» eden åŒºè·å–ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯å†åˆ° longterm è·å–ï¼Œå½“ä» longterm è·å–åˆ°å°±æŠŠå¯¹è±¡æ”¾å…¥ eden ä¸­ï¼Œä»è€Œä¿è¯ç»å¸¸è¢«è®¿é—®çš„èŠ‚ç‚¹ä¸å®¹æ˜“è¢«å›æ”¶ã€‚</li><li>å½“è°ƒç”¨ put() æ–¹æ³•æ—¶ï¼Œå¦‚æœ eden çš„å¤§å°è¶…è¿‡äº† sizeï¼Œé‚£ä¹ˆå°±å°† eden ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ”¾å…¥ longterm ä¸­ï¼Œåˆ©ç”¨è™šæ‹Ÿæœºå›æ”¶æ‰ä¸€éƒ¨åˆ†ä¸ç»å¸¸ä½¿ç”¨çš„å¯¹è±¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentCache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, V&gt; eden;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, V&gt; longterm;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcurrentCache</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">        <span class="keyword">this</span>.eden = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(size);</span><br><span class="line">        <span class="keyword">this</span>.longterm = <span class="keyword">new</span> WeakHashMap&lt;&gt;(size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K k)</span> </span>&#123;</span><br><span class="line">        V v = <span class="keyword">this</span>.eden.get(k);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="keyword">null</span>) &#123;</span><br><span class="line">            v = <span class="keyword">this</span>.longterm.get(k);</span><br><span class="line">            <span class="keyword">if</span> (v != <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">this</span>.eden.put(k, v);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(K k, V v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.eden.size() &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">this</span>.longterm.putAll(<span class="keyword">this</span>.eden);</span><br><span class="line">            <span class="keyword">this</span>.eden.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.eden.put(k, v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul><li>Eckel B. Java ç¼–ç¨‹æ€æƒ³ [M]. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2002.</li><li><a href="https://www.w3resource.com/java-tutorial/java-collections.php" target="_blank" rel="noopener">Java Collection Framework</a></li><li><a href="https://openhome.cc/Gossip/DesignPattern/IteratorPattern.htm" target="_blank" rel="noopener">Iterator æ¨¡å¼</a></li><li><a href="https://tech.meituan.com/java_hashmap.html" target="_blank" rel="noopener">Java 8 ç³»åˆ—ä¹‹é‡æ–°è®¤è¯† HashMap</a></li><li><a href="http://javarevisited.blogspot.hk/2010/10/difference-between-hashmap-and.html" target="_blank" rel="noopener">What is difference between HashMap and Hashtable in Java?</a></li><li><a href="http://www.zhangchangle.com/2018/02/07/Java%E9%9B%86%E5%90%88%E4%B9%8BHashMap/" target="_blank" rel="noopener">Java é›†åˆä¹‹ HashMap</a></li><li><a href="http://www.programering.com/a/MDO3QDNwATM.html" target="_blank" rel="noopener">The principle of ConcurrentHashMap analysis</a></li><li><a href="https://www.ibm.com/developerworks/cn/java/java-lo-concurrenthashmap/" target="_blank" rel="noopener">æ¢ç´¢ ConcurrentHashMap é«˜å¹¶å‘æ€§çš„å®ç°æœºåˆ¶</a></li><li><a href="https://www.jianshu.com/p/75adf47958a7" target="_blank" rel="noopener">HashMap ç›¸å…³é¢è¯•é¢˜åŠå…¶è§£ç­”</a></li><li><a href="http://wiki.jikexueyuan.com/project/java-enhancement/java-thirtysix.html" target="_blank" rel="noopener">Java é›†åˆç»†èŠ‚ï¼ˆäºŒï¼‰ï¼šasList çš„ç¼ºé™·</a></li><li><a href="http://javaconceptoftheday.com/java-collection-framework-linkedlist-class/" target="_blank" rel="noopener">Java Collection Framework â€“ The LinkedList Class</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä¸€ã€æ¦‚è§ˆ&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ¦‚è§ˆ&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ¦‚è§ˆ&quot;&gt;&lt;/a&gt;ä¸€ã€æ¦‚è§ˆ&lt;/h1&gt;&lt;p&gt;å®¹å™¨ä¸»è¦åŒ…æ‹¬ Collection å’Œ Map ä¸¤ç§ï¼ŒCollection å­˜å‚¨ç€å¯¹è±¡çš„é›†åˆï¼Œè€Œ Map å­˜å‚¨ç€é”®å€¼å¯¹ï¼ˆä¸¤ä¸ªå¯¹è±¡ï¼‰çš„æ˜ å°„è¡¨ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JAVA GC</title>
    <link href="http://yoursite.com/2016/11/22/JAVA-GC/"/>
    <id>http://yoursite.com/2016/11/22/JAVA-GC/</id>
    <published>2016-11-22T13:33:00.000Z</published>
    <updated>2018-09-09T15:24:18.989Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Understanding-Java-Garbage-Collection"><a href="#Understanding-Java-Garbage-Collection" class="headerlink" title="Understanding Java Garbage Collection"></a>Understanding Java Garbage Collection</h2><p>What are the benefits of knowing how garbage collection (GC) works in Java? Satisfying the intellectual curiosity as a software engineer would be a valid cause, but also, understanding how GC works can help you write much better Java applications.<br><a id="more"></a><br>This is a very personal and subjective opinion of mine, but I believe that a person well versed in GC tends to be a better Java developer. If you are interested in the GC process, that means you have experience in developing applications of certain size. If you have thought carefully about choosing the right GC algorithm, that means you completely understand the features of the application you have developed. Of course, this may not be common standards for a good developer. However, few would object when I say that understanding GC is a requirement for being a great Java developer.<br>This is the first of a series of â€œBecome a Java GC Expertâ€ articles. I will cover the GC introduction this time, and in the next article, I will talk about analyzing GC status and GC tuning examples from NHN.<br>There is a term that you should know before learning about GC. The term is â€œstop-the-world.â€ Stop-the-world will occur no matter which GC algorithm you choose. Stop-the-world means that the JVM is stopping the application from running to execute a GC. When stop-the-world occurs, every thread except for the threads needed for the GC will stop their tasks. The interrupted tasks will resume only after the GC task has completed. GC tuning often means reducing this stop-the-world time.</p><h2 id="Generational-Garbage-Collection"><a href="#Generational-Garbage-Collection" class="headerlink" title="Generational Garbage Collection"></a>Generational Garbage Collection</h2><p>Java does not explicitly specify a memory and remove it in the program code. Some people sets the relevant object to null or use System.gc() method to remove the memory explicitly. Setting it to null is not a big deal, but calling System.gc() method will affect the system performance drastically, and must not be carried out. (Thankfully, I have not yet seen any developer in NHN calling this method.)<br>In Java, as the developer does not explicitly remove the memory in the program code, the garbage collector finds the unnecessary (garbage) objects and removes them. This garbage collector was created based on the following two hypotheses. (It is more correct to call them suppositions or preconditions, rather than hypotheses.) </p><ul><li>Most objects soon become unreachable.</li><li>References from old objects to young objects only exist in small numbers.</li></ul><p>These hypotheses are called the weak generational hypothesis. So in order to preserve the strengths of this hypothesis, it is physically divided into two - young generation and old generation - in HotSpot VM.<br>Young generation: Most of the newly created objects are located here. Since most objects soon become unreachable, many objects are created in the young generation, then disappear. When objects disappear from this area, we say a â€œminor GCâ€ has occurred.<br>Old generation: The objects that did not become unreachable and survived from the young generation are copied here. It is generally larger than the young generation. As it is bigger in size, the GC occurs less frequently than in the young generation. When objects disappear from the old generation, we say a â€œmajor GCâ€ (or a â€œfull GCâ€) has occurred. </p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Understanding-Java-Garbage-Collection&quot;&gt;&lt;a href=&quot;#Understanding-Java-Garbage-Collection&quot; class=&quot;headerlink&quot; title=&quot;Understanding Java Garbage Collection&quot;&gt;&lt;/a&gt;Understanding Java Garbage Collection&lt;/h2&gt;&lt;p&gt;What are the benefits of knowing how garbage collection (GC) works in Java? Satisfying the intellectual curiosity as a software engineer would be a valid cause, but also, understanding how GC works can help you write much better Java applications.&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <link href="http://yoursite.com/2016/09/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2016/09/08/è®¾è®¡æ¨¡å¼/</id>
    <published>2016-09-08T08:13:45.000Z</published>
    <updated>2018-09-09T15:24:21.467Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h3><pre><code>è®¾è®¡æ¨¡å¼æ˜¯å¼€å‘è¿‡ç¨‹ï¼Œå¸¸ç”¨çš„ä¸€äº›ç†è®ºæ–¹æ³•ã€‚æ¯”å¦‚å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ç­‰ã€‚æ—¨åœ¨å¿«é€Ÿæ„é€ å‡ºï¼Œå¯å¤ç”¨ï¼Œä¾¿ç»´æŠ¤ï¼Œæœ‰åŠ©äºå›¢é˜Ÿåä½œçš„é«˜è´¨é‡ä»£ç ã€‚è®¾è®¡æ¨¡å¼æ˜¯ä¸€å¥—ä»£ç è®¾è®¡ã€Œç»éªŒçš„æ€»ç»“ã€ã€‚é¡¹ç›®ä¸­ã€Œåˆç†çš„ã€è¿ç”¨è®¾è®¡æ¨¡å¼å¯ä»¥ã€Œå·§å¦™çš„è§£å†³å¾ˆå¤šé—®é¢˜ã€ã€‚   </code></pre><a id="more"></a>   <p>åˆç†çš„ï¼šè¦å¯¹è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯æœ‰ä¸€å®šçš„è®¤è¯†åæ‰ä½¿ç”¨ï¼Œã€Œä¸è¦æ»¥ç”¨ã€ã€‚å¦‚ï¼šè¾“å‡ºä¸€å¥â€œhello worldâ€ï¼Œéè¦å¼ºè¡Œç»™åŠ ä¸Šå„ç§æ¨¡å¼ã€‚<br>ç»éªŒçš„æ€»ç»“ï¼šæŠ±ç€ã€Œä»£ç è™æˆ‘åƒç™¾éï¼Œæˆ‘å¾…ä»£ç å¦‚åˆæ‹ã€çš„å¿ƒæ€ï¼Œæœ€ç»ˆå¾—å‡ºæ¥çš„ã€Œå¥—è·¯ã€ã€‚<br>å·§å¦™çš„è§£å†³äº†å¾ˆå¤šé—®é¢˜ï¼šè¢«å¹¿æ³›åº”ç”¨çš„åŸå› ã€‚</p><h2 id="ä¸‰å¤§åŸºæœ¬ç‰¹æ€§ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€"><a href="#ä¸‰å¤§åŸºæœ¬ç‰¹æ€§ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€" class="headerlink" title="ä¸‰å¤§åŸºæœ¬ç‰¹æ€§ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€"></a>ä¸‰å¤§åŸºæœ¬ç‰¹æ€§ï¼šå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€</h2><h3 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h3><p>å°è£…ï¼Œå°±æ˜¯æŠŠå®¢è§‚äº‹ç‰©å°è£…æˆæŠ½è±¡çš„ç±»ï¼Œå¹¶ä¸”ç±»å¯ä»¥æŠŠè‡ªå·±çš„æ•°æ®å’Œæ–¹æ³•åªè®©å¯ä¿¡çš„ç±»æˆ–è€…å¯¹è±¡æ“ä½œï¼Œå¯¹ä¸å¯ä¿¡çš„è¿›è¡Œä¿¡æ¯éšè—ã€‚ä¸€ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå°è£…äº†æ•°æ®ä»¥åŠæ“ä½œè¿™äº›æ•°æ®çš„ä»£ç çš„é€»è¾‘å®ä½“ã€‚åœ¨ä¸€ä¸ªå¯¹è±¡å†…éƒ¨ï¼ŒæŸäº›ä»£ç æˆ–æŸäº›æ•°æ®å¯ä»¥æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½è¢«å¤–ç•Œè®¿é—®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯¹è±¡å¯¹å†…éƒ¨æ•°æ®æä¾›äº†ä¸åŒçº§åˆ«çš„ä¿æŠ¤ï¼Œä»¥é˜²æ­¢ç¨‹åºä¸­æ— å…³çš„éƒ¨åˆ†æ„å¤–çš„æ”¹å˜æˆ–é”™è¯¯çš„ä½¿ç”¨äº†å¯¹è±¡çš„ç§æœ‰éƒ¨åˆ†ã€‚</p><h3 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h3><p>ç»§æ‰¿ï¼ŒæŒ‡å¯ä»¥è®©æŸä¸ªç±»å‹çš„å¯¹è±¡è·å¾—å¦ä¸€ä¸ªç±»å‹çš„å¯¹è±¡çš„å±æ€§çš„æ–¹æ³•ã€‚å®ƒæ”¯æŒæŒ‰çº§åˆ†ç±»çš„æ¦‚å¿µã€‚ç»§æ‰¿æ˜¯æŒ‡è¿™æ ·ä¸€ç§èƒ½åŠ›ï¼šå®ƒå¯ä»¥ä½¿ç”¨ç°æœ‰ç±»çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶åœ¨æ— éœ€é‡æ–°ç¼–å†™åŸæ¥çš„ç±»çš„æƒ…å†µä¸‹å¯¹è¿™äº›åŠŸèƒ½è¿›è¡Œæ‰©å±•ã€‚ é€šè¿‡ç»§æ‰¿åˆ›å»ºçš„æ–°ç±»ç§°ä¸ºâ€œå­ç±»â€æˆ–â€œæ´¾ç”Ÿç±»â€ï¼Œè¢«ç»§æ‰¿çš„ç±»ç§°ä¸ºâ€œåŸºç±»â€ã€â€œçˆ¶ç±»â€æˆ–â€œè¶…ç±»â€ã€‚ç»§æ‰¿çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä»ä¸€èˆ¬åˆ°ç‰¹æ®Šçš„è¿‡ç¨‹ã€‚è¦å®ç°ç»§æ‰¿ï¼Œå¯ä»¥é€šè¿‡ â€œç»§æ‰¿â€ï¼ˆInheritanceï¼‰å’Œâ€œç»„åˆâ€ï¼ˆCompositionï¼‰æ¥å®ç°ã€‚ç»§æ‰¿æ¦‚å¿µçš„å®ç°æ–¹å¼æœ‰äºŒç±»ï¼šå®ç°ç»§æ‰¿ä¸æ¥å£ç»§æ‰¿ã€‚å®ç°ç»§æ‰¿æ˜¯æŒ‡ç›´æ¥ä½¿ç”¨ åŸºç±»çš„å±æ€§å’Œæ–¹æ³•è€Œæ— éœ€é¢å¤–ç¼–ç çš„èƒ½åŠ›ï¼›æ¥å£ç»§æ‰¿æ˜¯æŒ‡ä»…ä½¿ç”¨å±æ€§å’Œæ–¹æ³•çš„åç§°ã€ä½†æ˜¯å­ç±»å¿…é¡»æä¾›å®ç°çš„èƒ½åŠ›ã€‚</p><h3 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h3><p>å¤šæ€ï¼Œæ˜¯æŒ‡ä¸€ä¸ªç±»å®ä¾‹çš„ç›¸åŒæ–¹æ³•åœ¨ä¸åŒæƒ…å½¢æœ‰ä¸åŒè¡¨ç°å½¢å¼ã€‚å¤šæ€æœºåˆ¶ä½¿å…·æœ‰ä¸åŒå†…éƒ¨ç»“æ„çš„å¯¹è±¡å¯ä»¥å…±äº«ç›¸åŒçš„å¤–éƒ¨æ¥å£ã€‚è¿™æ„å‘³ç€ï¼Œè™½ç„¶é’ˆå¯¹ä¸åŒå¯¹è±¡çš„å…·ä½“æ“ä½œä¸åŒï¼Œä½†é€šè¿‡ä¸€ä¸ªå…¬å…±çš„ç±»ï¼Œå®ƒä»¬ï¼ˆé‚£äº›æ“ä½œï¼‰å¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹å¼äºˆä»¥è°ƒç”¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€ï¼š&quot;&gt;&lt;a href=&quot;#å‰è¨€ï¼š&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€ï¼š&quot;&gt;&lt;/a&gt;å‰è¨€ï¼š&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;è®¾è®¡æ¨¡å¼æ˜¯å¼€å‘è¿‡ç¨‹ï¼Œå¸¸ç”¨çš„ä¸€äº›ç†è®ºæ–¹æ³•ã€‚æ¯”å¦‚å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ç­‰ã€‚æ—¨åœ¨å¿«é€Ÿæ„é€ å‡ºï¼Œå¯å¤ç”¨ï¼Œä¾¿ç»´æŠ¤ï¼Œæœ‰åŠ©äºå›¢é˜Ÿåä½œçš„é«˜è´¨é‡ä»£ç ã€‚
è®¾è®¡æ¨¡å¼æ˜¯ä¸€å¥—ä»£ç è®¾è®¡ã€Œç»éªŒçš„æ€»ç»“ã€ã€‚é¡¹ç›®ä¸­ã€Œåˆç†çš„ã€è¿ç”¨è®¾è®¡æ¨¡å¼å¯ä»¥ã€Œå·§å¦™çš„è§£å†³å¾ˆå¤šé—®é¢˜ã€ã€‚   
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
  </entry>
  
  <entry>
    <title>é›†ç¾¤ç›¸å…³</title>
    <link href="http://yoursite.com/2016/01/14/%E9%9B%86%E7%BE%A4/"/>
    <id>http://yoursite.com/2016/01/14/é›†ç¾¤/</id>
    <published>2016-01-14T01:31:00.000Z</published>
    <updated>2019-06-28T14:39:35.942Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€è´Ÿè½½å‡è¡¡"><a href="#ä¸€ã€è´Ÿè½½å‡è¡¡" class="headerlink" title="ä¸€ã€è´Ÿè½½å‡è¡¡"></a>ä¸€ã€è´Ÿè½½å‡è¡¡</h1><p>é›†ç¾¤ä¸­çš„åº”ç”¨æœåŠ¡å™¨ï¼ˆèŠ‚ç‚¹ï¼‰é€šå¸¸è¢«è®¾è®¡æˆæ— çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥è¯·æ±‚ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p>è´Ÿè½½å‡è¡¡å™¨ä¼šæ ¹æ®é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½æƒ…å†µï¼Œå°†ç”¨æˆ·è¯·æ±‚è½¬å‘åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚<br><a id="more"></a></p><p>è´Ÿè½½å‡è¡¡å™¨å¯ä»¥ç”¨æ¥å®ç°é«˜å¯ç”¨ä»¥åŠä¼¸ç¼©æ€§ï¼š</p><ul><li>é«˜å¯ç”¨ï¼šå½“æŸä¸ªèŠ‚ç‚¹æ•…éšœæ—¶ï¼Œè´Ÿè½½å‡è¡¡å™¨ä¼šå°†ç”¨æˆ·è¯·æ±‚è½¬å‘åˆ°å¦å¤–çš„èŠ‚ç‚¹ä¸Šï¼Œä»è€Œä¿è¯æ‰€æœ‰æœåŠ¡æŒç»­å¯ç”¨ï¼›</li><li>ä¼¸ç¼©æ€§ï¼šæ ¹æ®ç³»ç»Ÿæ•´ä½“è´Ÿè½½æƒ…å†µï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ æˆ–ç§»é™¤èŠ‚ç‚¹ã€‚</li></ul><p>è´Ÿè½½å‡è¡¡å™¨è¿è¡Œè¿‡ç¨‹åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å¾—åˆ°è½¬å‘çš„èŠ‚ç‚¹ï¼›</li><li>è¿›è¡Œè½¬å‘ã€‚</li></ol><h2 id="è´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#è´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="è´Ÿè½½å‡è¡¡ç®—æ³•"></a>è´Ÿè½½å‡è¡¡ç®—æ³•</h2><h3 id="1-è½®è¯¢ï¼ˆRound-Robinï¼‰"><a href="#1-è½®è¯¢ï¼ˆRound-Robinï¼‰" class="headerlink" title="1. è½®è¯¢ï¼ˆRound Robinï¼‰"></a>1. è½®è¯¢ï¼ˆRound Robinï¼‰</h3><p>è½®è¯¢ç®—æ³•æŠŠæ¯ä¸ªè¯·æ±‚è½®æµå‘é€åˆ°æ¯ä¸ªæœåŠ¡å™¨ä¸Šã€‚</p><p>ä¸‹å›¾ä¸­ï¼Œä¸€å…±æœ‰ 6 ä¸ªå®¢æˆ·ç«¯äº§ç”Ÿäº† 6 ä¸ªè¯·æ±‚ï¼Œè¿™ 6 ä¸ªè¯·æ±‚æŒ‰ (1, 2, 3, 4, 5, 6) çš„é¡ºåºå‘é€ã€‚(1, 3, 5) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(2, 4, 6) çš„è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚</p><p><div align="center"> <img src="pics/9daa3616-00a4-48c4-9146-792dc8499be3.jpg" width="500px"> </div><br></p><p>è¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæ¯ä¸ªæœåŠ¡å™¨çš„æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ï¼Œå¦‚æœæœ‰æ€§èƒ½å­˜åœ¨å·®å¼‚çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆæ€§èƒ½è¾ƒå·®çš„æœåŠ¡å™¨å¯èƒ½æ— æ³•æ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ï¼ˆä¸‹å›¾çš„ Server 2ï¼‰ã€‚</p><p><div align="center"> <img src="pics/bfea8772-d01b-4a51-8adc-edfd7d3dce84.jpg" width="500px"> </div><br></p><h3 id="2-åŠ æƒè½®è¯¢ï¼ˆWeighted-Round-Robbinï¼‰"><a href="#2-åŠ æƒè½®è¯¢ï¼ˆWeighted-Round-Robbinï¼‰" class="headerlink" title="2. åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robbinï¼‰"></a>2. åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robbinï¼‰</h3><p>åŠ æƒè½®è¯¢æ˜¯åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½å·®å¼‚ï¼Œä¸ºæœåŠ¡å™¨èµ‹äºˆä¸€å®šçš„æƒå€¼ï¼Œæ€§èƒ½é«˜çš„æœåŠ¡å™¨åˆ†é…æ›´é«˜çš„æƒå€¼ã€‚</p><p>ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 5ï¼ŒæœåŠ¡å™¨ 2 è¢«èµ‹äºˆçš„æƒå€¼ä¸º 1ï¼Œé‚£ä¹ˆ (1, 2, 3, 4, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œ(6) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 2ã€‚</p><p><div align="center"> <img src="pics/4ab87717-e264-4232-825d-8aaf08f14e8b.jpg" width="500px"> </div><br></p><h3 id="3-æœ€å°‘è¿æ¥ï¼ˆleast-Connectionsï¼‰"><a href="#3-æœ€å°‘è¿æ¥ï¼ˆleast-Connectionsï¼‰" class="headerlink" title="3. æœ€å°‘è¿æ¥ï¼ˆleast Connectionsï¼‰"></a>3. æœ€å°‘è¿æ¥ï¼ˆleast Connectionsï¼‰</h3><p>ç”±äºæ¯ä¸ªè¯·æ±‚çš„è¿æ¥æ—¶é—´ä¸ä¸€æ ·ï¼Œä½¿ç”¨è½®è¯¢æˆ–è€…åŠ æƒè½®è¯¢ç®—æ³•çš„è¯ï¼Œå¯èƒ½ä¼šè®©ä¸€å°æœåŠ¡å™¨å½“å‰è¿æ¥æ•°è¿‡å¤§ï¼Œè€Œå¦ä¸€å°æœåŠ¡å™¨çš„è¿æ¥è¿‡å°ï¼Œé€ æˆè´Ÿè½½ä¸å‡è¡¡ã€‚</p><p>ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œ(1, 3, 5) è¯·æ±‚ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1ï¼Œä½†æ˜¯ (1, 3) å¾ˆå¿«å°±æ–­å¼€è¿æ¥ï¼Œæ­¤æ—¶åªæœ‰ (5) è¯·æ±‚è¿æ¥æœåŠ¡å™¨ 1ï¼›(2, 4, 6) è¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ 2ï¼Œåªæœ‰ (2) çš„è¿æ¥æ–­å¼€ï¼Œæ­¤æ—¶ (6, 4) è¯·æ±‚è¿æ¥æœåŠ¡å™¨ 2ã€‚è¯¥ç³»ç»Ÿç»§ç»­è¿è¡Œæ—¶ï¼ŒæœåŠ¡å™¨ 2 ä¼šæ‰¿æ‹…è¿‡å¤§çš„è´Ÿè½½ã€‚</p><p><div align="center"> <img src="pics/e98deb5a-d5d4-4294-aa9b-9220d4483403.jpg" width="500px"> </div><br></p><p>æœ€å°‘è¿æ¥ç®—æ³•å°±æ˜¯å°†è¯·æ±‚å‘é€ç»™å½“å‰æœ€å°‘è¿æ¥æ•°çš„æœåŠ¡å™¨ä¸Šã€‚</p><p>ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼ŒæœåŠ¡å™¨ 1 å½“å‰è¿æ¥æ•°æœ€å°ï¼Œé‚£ä¹ˆæ–°åˆ°æ¥çš„è¯·æ±‚ 6 å°±ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ 1 ä¸Šã€‚</p><p><div align="center"> <img src="pics/43d323ac-9f07-4e4a-a315-4eaf8c38766c.jpg" width="500px"> </div><br></p><h3 id="4-åŠ æƒæœ€å°‘è¿æ¥ï¼ˆWeighted-Least-Connectionï¼‰"><a href="#4-åŠ æƒæœ€å°‘è¿æ¥ï¼ˆWeighted-Least-Connectionï¼‰" class="headerlink" title="4. åŠ æƒæœ€å°‘è¿æ¥ï¼ˆWeighted Least Connectionï¼‰"></a>4. åŠ æƒæœ€å°‘è¿æ¥ï¼ˆWeighted Least Connectionï¼‰</h3><p>åœ¨æœ€å°‘è¿æ¥çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ€§èƒ½ä¸ºæ¯å°æœåŠ¡å™¨åˆ†é…æƒé‡ï¼Œå†æ ¹æ®æƒé‡è®¡ç®—å‡ºæ¯å°æœåŠ¡å™¨èƒ½å¤„ç†çš„è¿æ¥æ•°ã€‚</p><h3 id="5-éšæœºç®—æ³•ï¼ˆRandomï¼‰"><a href="#5-éšæœºç®—æ³•ï¼ˆRandomï¼‰" class="headerlink" title="5. éšæœºç®—æ³•ï¼ˆRandomï¼‰"></a>5. éšæœºç®—æ³•ï¼ˆRandomï¼‰</h3><p>æŠŠè¯·æ±‚éšæœºå‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚</p><p>å’Œè½®è¯¢ç®—æ³•ç±»ä¼¼ï¼Œè¯¥ç®—æ³•æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨æ€§èƒ½å·®ä¸å¤šçš„åœºæ™¯ã€‚</p><p><div align="center"> <img src="pics/a42ad3a7-3574-4c48-a783-ed3d08a0688a.jpg" width="500px"> </div><br></p><h3 id="6-æºåœ°å€å“ˆå¸Œæ³•-IP-Hash"><a href="#6-æºåœ°å€å“ˆå¸Œæ³•-IP-Hash" class="headerlink" title="6. æºåœ°å€å“ˆå¸Œæ³• (IP Hash)"></a>6. æºåœ°å€å“ˆå¸Œæ³• (IP Hash)</h3><p>æºåœ°å€å“ˆå¸Œé€šè¿‡å¯¹å®¢æˆ·ç«¯ IP è®¡ç®—å“ˆå¸Œå€¼ä¹‹åï¼Œå†å¯¹æœåŠ¡å™¨æ•°é‡å–æ¨¡å¾—åˆ°ç›®æ ‡æœåŠ¡å™¨çš„åºå·ã€‚</p><p>å¯ä»¥ä¿è¯åŒä¸€ IP çš„å®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šè½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œç”¨æ¥å®ç°ä¼šè¯ç²˜æ»ï¼ˆSticky Sessionï¼‰</p><p><div align="center"> <img src="pics/0f399a9f-1351-4b2d-b8a4-2ebe82b1a703.jpg" width="500px"> </div><br></p><h2 id="è½¬å‘å®ç°"><a href="#è½¬å‘å®ç°" class="headerlink" title="è½¬å‘å®ç°"></a>è½¬å‘å®ç°</h2><h3 id="1-HTTP-é‡å®šå‘"><a href="#1-HTTP-é‡å®šå‘" class="headerlink" title="1. HTTP é‡å®šå‘"></a>1. HTTP é‡å®šå‘</h3><p>HTTP é‡å®šå‘è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä½¿ç”¨æŸç§è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—å¾—åˆ°æœåŠ¡å™¨çš„ IP åœ°å€ä¹‹åï¼Œå°†è¯¥åœ°å€å†™å…¥ HTTP é‡å®šå‘æŠ¥æ–‡ä¸­ï¼ŒçŠ¶æ€ç ä¸º 302ã€‚å®¢æˆ·ç«¯æ”¶åˆ°é‡å®šå‘æŠ¥æ–‡ä¹‹åï¼Œéœ€è¦é‡æ–°å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>éœ€è¦ä¸¤æ¬¡è¯·æ±‚ï¼Œå› æ­¤è®¿é—®å»¶è¿Ÿæ¯”è¾ƒé«˜ï¼›</li><li>HTTP è´Ÿè½½å‡è¡¡å™¨å¤„ç†èƒ½åŠ›æœ‰é™ï¼Œä¼šé™åˆ¶é›†ç¾¤çš„è§„æ¨¡ã€‚</li></ul><p>è¯¥è´Ÿè½½å‡è¡¡è½¬å‘çš„ç¼ºç‚¹æ¯”è¾ƒæ˜æ˜¾ï¼Œå®é™…åœºæ™¯ä¸­å¾ˆå°‘ä½¿ç”¨å®ƒã€‚</p><p><div align="center"> <img src="pics/02a1fbfd-7a9d-4114-95df-ca2445587a1f.jpg" width="500px"> </div><br></p><h3 id="2-DNS-åŸŸåè§£æ"><a href="#2-DNS-åŸŸåè§£æ" class="headerlink" title="2. DNS åŸŸåè§£æ"></a>2. DNS åŸŸåè§£æ</h3><p>åœ¨ DNS è§£æåŸŸåçš„åŒæ—¶ä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—æœåŠ¡å™¨ IP åœ°å€ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>DNS èƒ½å¤Ÿæ ¹æ®åœ°ç†ä½ç½®è¿›è¡ŒåŸŸåè§£æï¼Œè¿”å›ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨ IP åœ°å€ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ç”±äº DNS å…·æœ‰å¤šçº§ç»“æ„ï¼Œæ¯ä¸€çº§çš„åŸŸåè®°å½•éƒ½å¯èƒ½è¢«ç¼“å­˜ï¼Œå½“ä¸‹çº¿ä¸€å°æœåŠ¡å™¨éœ€è¦ä¿®æ”¹ DNS è®°å½•æ—¶ï¼Œéœ€è¦è¿‡å¾ˆé•¿ä¸€æ®µæ—¶é—´æ‰èƒ½ç”Ÿæ•ˆã€‚</li></ul><p>å¤§å‹ç½‘ç«™åŸºæœ¬ä½¿ç”¨äº† DNS åšä¸ºç¬¬ä¸€çº§è´Ÿè½½å‡è¡¡æ‰‹æ®µï¼Œç„¶ååœ¨å†…éƒ¨ä½¿ç”¨å…¶å®ƒæ–¹å¼åšç¬¬äºŒçº§è´Ÿè½½å‡è¡¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸŸåè§£æçš„ç»“æœä¸ºå†…éƒ¨çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ IP åœ°å€ã€‚</p><p><div align="center"> <img src="pics/d2c072cc-8b17-480c-813e-18cdb3b4b51f.jpg" width="500px"> </div><br></p><h3 id="3-åå‘ä»£ç†æœåŠ¡å™¨"><a href="#3-åå‘ä»£ç†æœåŠ¡å™¨" class="headerlink" title="3. åå‘ä»£ç†æœåŠ¡å™¨"></a>3. åå‘ä»£ç†æœåŠ¡å™¨</h3><p>åå‘ä»£ç†æœåŠ¡å™¨ä½äºæºæœåŠ¡å™¨å‰é¢ï¼Œç”¨æˆ·çš„è¯·æ±‚éœ€è¦å…ˆç»è¿‡åå‘ä»£ç†æœåŠ¡å™¨æ‰èƒ½åˆ°è¾¾æºæœåŠ¡å™¨ã€‚åå‘ä»£ç†å¯ä»¥ç”¨æ¥è¿›è¡Œç¼“å­˜ã€æ—¥å¿—è®°å½•ç­‰ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥åšä¸ºè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ã€‚</p><p>åœ¨è¿™ç§è´Ÿè½½å‡è¡¡è½¬å‘æ–¹å¼ä¸‹ï¼Œå®¢æˆ·ç«¯ä¸ç›´æ¥è¯·æ±‚æºæœåŠ¡å™¨ï¼Œå› æ­¤æºæœåŠ¡å™¨ä¸éœ€è¦å¤–éƒ¨ IP åœ°å€ï¼Œè€Œåå‘ä»£ç†éœ€è¦é…ç½®å†…éƒ¨å’Œå¤–éƒ¨ä¸¤å¥— IP åœ°å€ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ä¸å…¶å®ƒåŠŸèƒ½é›†æˆåœ¨ä¸€èµ·ï¼Œéƒ¨ç½²ç®€å•ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ‰€æœ‰è¯·æ±‚å’Œå“åº”éƒ½éœ€è¦ç»è¿‡åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒå¯èƒ½ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</li></ul><h3 id="4-ç½‘ç»œå±‚"><a href="#4-ç½‘ç»œå±‚" class="headerlink" title="4. ç½‘ç»œå±‚"></a>4. ç½‘ç»œå±‚</h3><p>åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸è¿›ç¨‹è·å–ç½‘ç»œæ•°æ®åŒ…ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—æºæœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå¹¶ä¿®æ”¹è¯·æ±‚æ•°æ®åŒ…çš„ç›®çš„ IP åœ°å€ï¼Œæœ€åè¿›è¡Œè½¬å‘ã€‚</p><p>æºæœåŠ¡å™¨è¿”å›çš„å“åº”ä¹Ÿéœ€è¦ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œé€šå¸¸æ˜¯è®©è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åŒæ—¶ä½œä¸ºé›†ç¾¤çš„ç½‘å…³æœåŠ¡å™¨æ¥å®ç°ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>åœ¨å†…æ ¸è¿›ç¨‹ä¸­è¿›è¡Œå¤„ç†ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å’Œåå‘ä»£ç†ä¸€æ ·ï¼Œæ‰€æœ‰çš„è¯·æ±‚å’Œå“åº”éƒ½ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</li></ul><h3 id="5-é“¾è·¯å±‚"><a href="#5-é“¾è·¯å±‚" class="headerlink" title="5. é“¾è·¯å±‚"></a>5. é“¾è·¯å±‚</h3><p>åœ¨é“¾è·¯å±‚æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•è®¡ç®—æºæœåŠ¡å™¨çš„ MAC åœ°å€ï¼Œå¹¶ä¿®æ”¹è¯·æ±‚æ•°æ®åŒ…çš„ç›®çš„ MAC åœ°å€ï¼Œå¹¶è¿›è¡Œè½¬å‘ã€‚</p><p>é€šè¿‡é…ç½®æºæœåŠ¡å™¨çš„è™šæ‹Ÿ IP åœ°å€å’Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨çš„ IP åœ°å€ä¸€è‡´ï¼Œä»è€Œä¸éœ€è¦ä¿®æ”¹ IP åœ°å€å°±å¯ä»¥è¿›è¡Œè½¬å‘ã€‚ä¹Ÿæ­£å› ä¸º IP åœ°å€ä¸€æ ·ï¼Œæ‰€ä»¥æºæœåŠ¡å™¨çš„å“åº”ä¸éœ€è¦è½¬å‘å›è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥è½¬å‘ç»™å®¢æˆ·ç«¯ï¼Œé¿å…äº†è´Ÿè½½å‡è¡¡æœåŠ¡å™¨çš„æˆä¸ºç“¶é¢ˆã€‚</p><p>è¿™æ˜¯ä¸€ç§ä¸‰è§’ä¼ è¾“æ¨¡å¼ï¼Œè¢«ç§°ä¸ºç›´æ¥è·¯ç”±ã€‚å¯¹äºæä¾›ä¸‹è½½å’Œè§†é¢‘æœåŠ¡çš„ç½‘ç«™æ¥è¯´ï¼Œç›´æ¥è·¯ç”±é¿å…äº†å¤§é‡çš„ç½‘ç»œä¼ è¾“æ•°æ®ç»è¿‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ã€‚</p><p>è¿™æ˜¯ç›®å‰å¤§å‹ç½‘ç«™ä½¿ç”¨æœ€å¹¿è´Ÿè½½å‡è¡¡è½¬å‘æ–¹å¼ï¼Œåœ¨ Linux å¹³å°å¯ä»¥ä½¿ç”¨çš„è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¸º LVSï¼ˆLinux Virtual Serverï¼‰ã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href="http://www.jscape.com/blog/load-balancing-algorithms" target="_blank" rel="noopener">Comparing Load Balancing Algorithms</a></li><li><a href="http://slideplayer.com/slide/6599069/#" target="_blank" rel="noopener">Redirection and Load Balancing</a></li></ul><h1 id="äºŒã€é›†ç¾¤ä¸‹çš„-Session-ç®¡ç†"><a href="#äºŒã€é›†ç¾¤ä¸‹çš„-Session-ç®¡ç†" class="headerlink" title="äºŒã€é›†ç¾¤ä¸‹çš„ Session ç®¡ç†"></a>äºŒã€é›†ç¾¤ä¸‹çš„ Session ç®¡ç†</h1><p>ä¸€ä¸ªç”¨æˆ·çš„ Session ä¿¡æ¯å¦‚æœå­˜å‚¨åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå½“è´Ÿè½½å‡è¡¡å™¨æŠŠç”¨æˆ·çš„ä¸‹ä¸€ä¸ªè¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç”±äºæœåŠ¡å™¨æ²¡æœ‰ç”¨æˆ·çš„ Session ä¿¡æ¯ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å°±éœ€è¦é‡æ–°è¿›è¡Œç™»å½•ç­‰æ“ä½œã€‚</p><h2 id="Sticky-Session"><a href="#Sticky-Session" class="headerlink" title="Sticky Session"></a>Sticky Session</h2><p>éœ€è¦é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿å¾—ä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½è·¯ç”±åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠç”¨æˆ·çš„ Session å­˜æ”¾åœ¨è¯¥æœåŠ¡å™¨ä¸­ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>å½“æœåŠ¡å™¨å®•æœºæ—¶ï¼Œå°†ä¸¢å¤±è¯¥æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰ Sessionã€‚</li></ul><p><div align="center"> <img src="pics/1623f524-b011-40c8-b83f-eab38d538f76.png" width="400px"> </div><br></p><h2 id="Session-Replication"><a href="#Session-Replication" class="headerlink" title="Session Replication"></a>Session Replication</h2><p>åœ¨æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œ Session åŒæ­¥æ“ä½œï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½æœ‰æ‰€æœ‰ç”¨æˆ·çš„ Session ä¿¡æ¯ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥å‘ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œè¯·æ±‚ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>å ç”¨è¿‡å¤šå†…å­˜ï¼›</li><li>åŒæ­¥è¿‡ç¨‹å ç”¨ç½‘ç»œå¸¦å®½ä»¥åŠæœåŠ¡å™¨å¤„ç†å™¨æ—¶é—´ã€‚</li></ul><h2 id="Session-Server"><a href="#Session-Server" class="headerlink" title="Session Server"></a>Session Server</h2><p>ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨å­˜å‚¨ Session æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„ MySQLï¼Œä¹Ÿä½¿ç”¨ Redis æˆ–è€… Memcached è¿™ç§å†…å­˜å‹æ•°æ®åº“ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ä¸ºäº†ä½¿å¾—å¤§å‹ç½‘ç«™å…·æœ‰ä¼¸ç¼©æ€§ï¼Œé›†ç¾¤ä¸­çš„åº”ç”¨æœåŠ¡å™¨é€šå¸¸éœ€è¦ä¿æŒæ— çŠ¶æ€ï¼Œé‚£ä¹ˆåº”ç”¨æœåŠ¡å™¨ä¸èƒ½å­˜å‚¨ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚Session Server å°†ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯å•ç‹¬è¿›è¡Œå­˜å‚¨ï¼Œä»è€Œä¿è¯äº†åº”ç”¨æœåŠ¡å™¨çš„æ— çŠ¶æ€ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>éœ€è¦å»å®ç°å­˜å– Session çš„ä»£ç ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä¸€ã€è´Ÿè½½å‡è¡¡&quot;&gt;&lt;a href=&quot;#ä¸€ã€è´Ÿè½½å‡è¡¡&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€è´Ÿè½½å‡è¡¡&quot;&gt;&lt;/a&gt;ä¸€ã€è´Ÿè½½å‡è¡¡&lt;/h1&gt;&lt;p&gt;é›†ç¾¤ä¸­çš„åº”ç”¨æœåŠ¡å™¨ï¼ˆèŠ‚ç‚¹ï¼‰é€šå¸¸è¢«è®¾è®¡æˆæ— çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥è¯·æ±‚ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;è´Ÿè½½å‡è¡¡å™¨ä¼šæ ¹æ®é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½æƒ…å†µï¼Œå°†ç”¨æˆ·è¯·æ±‚è½¬å‘åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
</feed>
