<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Xia.Blog()</title>
  
  <subtitle>Stay Hungry</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-06-28T14:46:47.224Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Xia Xiang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ— é”¡</title>
    <link href="http://yoursite.com/2019/06/28/%E6%97%A0%E9%94%A1/"/>
    <id>http://yoursite.com/2019/06/28/æ— é”¡/</id>
    <published>2019-06-28T09:37:01.000Z</published>
    <updated>2019-06-28T14:46:47.224Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®°"><a href="#ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®°" class="headerlink" title="ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®° = ="></a>ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®° = =</h2><p>ğŸ³ğŸ³ğŸ³</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®°&quot;&gt;&lt;a href=&quot;#ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®° = =&quot;&gt;&lt;/a&gt;ä¸€åº§å°åŸï¼Œæ— äº‹å¯è®° = =&lt;/h2&gt;&lt;p&gt;ğŸ³ğŸ³ğŸ³&lt;/p&gt;

      
    
    </summary>
    
      <category term="life" scheme="http://yoursite.com/categories/life/"/>
    
    
      <category term="æ—¥å¸¸" scheme="http://yoursite.com/tags/%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>OOM Killer</title>
    <link href="http://yoursite.com/2019/03/01/oom/"/>
    <id>http://yoursite.com/2019/03/01/oom/</id>
    <published>2019-03-01T15:55:00.000Z</published>
    <updated>2019-07-07T10:18:11.486Z</updated>
    
    <content type="html"><![CDATA[<h3 id="OOM-KilleråŸç†"><a href="#OOM-KilleråŸç†" class="headerlink" title="OOM KilleråŸç†"></a>OOM KilleråŸç†<a id="more"></a></h3><ul><li>å½“ç‰©ç†å†…å­˜å’Œäº¤æ¢ç©ºé—´çˆ†æ»¡æ—¶ï¼ŒOOM Killerä¼šè®¡ç®—æ¯ä¸ªè¿›ç¨‹çš„oom_scoreå¹¶é€‰æ‹©æ€æ­»è¿›ç¨‹ã€‚oom_scoreçš„å€¼è¶Šå¤§å°±è¶Šæœ‰å¯èƒ½è¢« OOM Killer é€‰ä¸­ã€‚è¿™é‡Œåˆ—ä¸¾ä¸¤ä¸ªä¸»è¦å› ç´ ï¼š</li></ul><p>è¿›ç¨‹æ¶ˆè€—çš„å†…å­˜è¶Šå¤§ï¼Œoom_scoreè¶Šå¤§<br>è¿›ç¨‹è¿è¡Œæ¶ˆè€—çš„CPUæ—¶é—´è¶Šå°ï¼Œoom_scoreè¶Šå¤§</p><ul><li>Windowsä¸‹æ²¡æœ‰OOM Killeræœºåˆ¶ï¼Œç”¨æˆ·åªèƒ½å¼ºåˆ¶æ€æ­»è¿›ç¨‹æˆ–è€…é‡å¯æœºå™¨ã€‚</li></ul><h4 id="å†…å­˜æº¢å‡ºOOMåˆ¤æ–­å’Œdumpè·å–"><a href="#å†…å­˜æº¢å‡ºOOMåˆ¤æ–­å’Œdumpè·å–" class="headerlink" title="å†…å­˜æº¢å‡ºOOMåˆ¤æ–­å’Œdumpè·å–"></a>å†…å­˜æº¢å‡ºOOMåˆ¤æ–­å’Œdumpè·å–</h4><p>å†…å­˜æº¢å‡ºçš„å¯¼è‡´æ— å“åº”çš„ä¸»è¦åŸå› ï¼Œæ˜¯ç”±äºJVMçš„å†…å­˜å…¨éƒ¨è€—å…‰ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦è¿›ä¸€æ­¥åˆ†é…å†…å­˜ã€‚æ­¤æ—¶JVMå°±ä¼šè¿›è¡Œå¾ˆå¤šæ¬¡çš„çš„Full GCï¼Œå¸Œæœ›å›æ”¶ä¸ä½¿ç”¨çš„å†…å­˜ã€‚ä½†æ˜¯ç”±äºæ•°æ®éƒ½åœ¨ä½¿ç”¨ï¼Œå› æ­¤ä¸€ç›´é‡Šæ”¾ä¸æ‰å†…å­˜ï¼Œäºæ˜¯å°±ä¸€ééçš„è¿›è¡ŒFull GCã€‚</p><h4 id="æŒ‰ç…§ä»¥ä¸‹åŠæ³•åˆ¤æ–­æ˜¯å› ä¸ºå†…å­˜æº¢å‡ºå¯¼è‡´çš„å®•æœº"><a href="#æŒ‰ç…§ä»¥ä¸‹åŠæ³•åˆ¤æ–­æ˜¯å› ä¸ºå†…å­˜æº¢å‡ºå¯¼è‡´çš„å®•æœº" class="headerlink" title="æŒ‰ç…§ä»¥ä¸‹åŠæ³•åˆ¤æ–­æ˜¯å› ä¸ºå†…å­˜æº¢å‡ºå¯¼è‡´çš„å®•æœº"></a>æŒ‰ç…§ä»¥ä¸‹åŠæ³•åˆ¤æ–­æ˜¯å› ä¸ºå†…å­˜æº¢å‡ºå¯¼è‡´çš„å®•æœº</h4><ul><li>åˆ©ç”¨topå‘½ä»¤å‘ç°è¿›ç¨‹çš„CPUä½¿ç”¨ç‡éå¸¸é«˜ã€‚</li><li>CPUé«˜å¹¶ä¸ä¸€å®šæ˜¯åœ¨åšFull GCï¼Œéœ€è¦è¿›ä¸€æ­¥ç¡®è®¤ã€‚åˆ©ç”¨jstat -gc pid 2000 2000 è¿™ä¸€å‘½ä»¤ã€‚å¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼Œå…³æ³¨FGCä¸€æ ï¼Œå¦‚æœæ•°å€¼å¢åŠ å¾ˆå¿«ï¼Œè€Œä¸”FGCT(Full GC çš„æ€»æ—¶é—´)æ•°å€¼å¾ˆå¤§ï¼Œä¾‹å¦‚FGC ä¸º20 FGCTå·²ç»2000ä»¥ä¸Šï¼Œå¹³å‡ä¸€æ¬¡FGCè€—æ—¶100sã€‚è¿™é‡Œå°±å¯ä»¥ç¡®å®šæ˜¯å†…å­˜æº¢å‡ºäº†å¯¼è‡´çš„å®•æœºï¼Œéœ€è¦è·å–dump</li><li>æ»¡è¶³ä¸Šé¢æ¡ä»¶æ‰è®¤ä¸ºæ˜¯å†…å­˜æº¢å‡ºï¼Œå¦åˆ™ä¸åœ¨è¿™ä¸ªå†…å­˜æº¢å‡ºå¤„ç†èŒƒç•´å†…ã€‚</li><li>ä¼˜å…ˆé€šè¿‡é…ç½®æ¥è®©JVMè‡ªå·±ç”Ÿäº§dumpï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰é…ç½®çš„è¯é‚£å°±æ˜¯æ‰‹åŠ¨è·å–ã€‚æ‰§è¡Œâ€œ jmap -dump:format=b,live,file=è·¯å¾„   è¿›ç¨‹pidâ€ï¼Œä¾‹å¦‚ ä»£ç å—ä¸­è·å–22374è¿›ç¨‹çš„dumpã€‚</li><li>å¦‚æœå®¢æˆ·ç¯å¢ƒæ²¡æœ‰é…ç½®JVMè¿›è¡Œdumpçš„å‚æ•°ï¼Œéœ€è¦åŠ ä¸Šä»¥é˜²ä¸‡ä¸€ã€‚é…ç½®å®•æœºæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ</li></ul><h3 id="ç³»ç»Ÿçš„OOM-Killer"><a href="#ç³»ç»Ÿçš„OOM-Killer" class="headerlink" title="ç³»ç»Ÿçš„OOM Killer"></a>ç³»ç»Ÿçš„OOM Killer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡Œä¸‹é¢ä¸‰ä¸ªå‘½ä»¤</span><br><span class="line">egrep -i <span class="string">'killed process'</span> /var/log/messages</span><br><span class="line">egrep -i <span class="string">'killed process'</span> /var/log/dmesg</span><br><span class="line">egrep -i -r <span class="string">'killed process'</span> /var/log</span><br><span class="line"></span><br><span class="line">å¦‚æœæœ‰ä¸‹åˆ—ç›¸å…³ä¿¡æ¯</span><br><span class="line"><span class="string">"Out of memory: Kill process 31201 (java) score 783 or sacrifice child"</span></span><br><span class="line"><span class="string">"Killed process 13090 (java)"</span></span><br><span class="line">å¯ä»¥åˆ¤æ–­å‘ç”Ÿäº†OOM Killerï¼Œä½†æ˜¯è¿˜éœ€è¦é€šè¿‡å†…å­˜å ç”¨å’Œæ—¶é—´æ¥ç¡®è®¤ä¸æ¶ˆå¤±çš„BIè¿›ç¨‹æ˜¯å¦å»åˆ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚</span><br><span class="line">$ egrep -i -r <span class="string">'killed process'</span> /var/log</span><br><span class="line">/var/log/messages-<span class="number">20190421</span>:Apr <span class="number">19</span> <span class="number">00</span>:<span class="number">20</span>:<span class="number">37</span> FineBI6 kernel: Killed process <span class="number">30353</span> (abrt-hook-ccpp) total-vm:<span class="number">49637864</span>kB, anon-rss:<span class="number">31433096</span>kB, file-rss:<span class="number">32</span>kB, shmem-rss:<span class="number">0</span>kB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æœ‰çš„ç³»ç»Ÿè¾“å‡ºçš„æ—¶é—´æˆ³ï¼Œåˆ©ç”¨ä¸‹é¢çš„å·¥å…·æ¥è½¬æ¢</span><br><span class="line">https:<span class="comment">//tool.lu/timestamp/</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•æ–¹æ³•"><a href="#æµ‹è¯•æ–¹æ³•" class="headerlink" title="æµ‹è¯•æ–¹æ³•"></a>æµ‹è¯•æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// oom_adj=15æ—¶ï¼Œå¿…ç„¶ä¼šè¢«OOM Killeré€‰ä¸­</span></span><br><span class="line">echo <span class="number">15</span> &gt; /proc/[PID]/oom_adj</span><br><span class="line"><span class="comment">// æ‰‹åŠ¨è§¦å‘OOM Killer</span></span><br><span class="line">echo f &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure><h4 id="ç›‘æµ‹å®•æœº-ï¼ˆä¿¡å·é‡-JVM-Shutdown-Hookï¼‰"><a href="#ç›‘æµ‹å®•æœº-ï¼ˆä¿¡å·é‡-JVM-Shutdown-Hookï¼‰" class="headerlink" title="ç›‘æµ‹å®•æœº ï¼ˆä¿¡å·é‡ + JVM Shutdown Hookï¼‰"></a>ç›‘æµ‹å®•æœº ï¼ˆä¿¡å·é‡ + JVM Shutdown Hookï¼‰</h4><ul><li><p>ä¿¡å·é‡<br>åˆ©ç”¨sun.misc.SignalHandlerç±»ï¼Œå¯ä»¥ç›‘å¬é™¤äº†kill -9ä¹‹å¤–çš„å…¶ä»–å…³é—­ä¿¡å·ã€‚Javaå¯¹æ¯ä¸ªä¿¡å·é‡éƒ½å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œæ³¨å†Œä¿¡å·é‡åä¼šå¯åŠ¨â€SIGTERM handlerâ€ çº¿ç¨‹ã€‚å³ä¾¿ä¸»çº¿ç¨‹è¢«é˜»å¡ï¼Œä¿¡å·ä¾ç„¶å¯ä»¥å¾—åˆ°å¤„ç†ã€‚</p></li><li><p>JVM Shutdown Hook<br>å½“ç¨‹åºæ‰§è¡ŒSystem.exit(0)é€€å‡ºæ—¶ï¼Œä¿¡å·é‡æ–¹æ³•æ˜¯æ— æ³•çŸ¥é“çš„ï¼Œè¿™æ—¶å€™éœ€è¦ä½¿ç”¨JVM Shutdown Hookã€‚</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;OOM-KilleråŸç†&quot;&gt;&lt;a href=&quot;#OOM-KilleråŸç†&quot; class=&quot;headerlink&quot; title=&quot;OOM KilleråŸç†&quot;&gt;&lt;/a&gt;OOM KilleråŸç†
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>javaassiståŠ¨æ€ä¿®æ”¹æ³¨è§£</title>
    <link href="http://yoursite.com/2019/02/11/javaassist/"/>
    <id>http://yoursite.com/2019/02/11/javaassist/</id>
    <published>2019-02-11T15:55:00.000Z</published>
    <updated>2019-07-05T09:50:34.677Z</updated>
    
    <content type="html"><![CDATA[<h4 id="JavaassistAnno-obå˜é‡åŠ ä¸Šäº†æ³¨è§£Aï¼Œéœ€è¦æ”¹æˆBã€‚"><a href="#JavaassistAnno-obå˜é‡åŠ ä¸Šäº†æ³¨è§£Aï¼Œéœ€è¦æ”¹æˆBã€‚" class="headerlink" title="JavaassistAnno obå˜é‡åŠ ä¸Šäº†æ³¨è§£Aï¼Œéœ€è¦æ”¹æˆBã€‚"></a>JavaassistAnno obå˜é‡åŠ ä¸Šäº†æ³¨è§£Aï¼Œéœ€è¦æ”¹æˆBã€‚</h4><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> vm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> vm.anno.A;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaassistAnno</span> </span>&#123;</span><br><span class="line">    <span class="meta">@A</span></span><br><span class="line">    <span class="keyword">private</span> Object ob;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> A &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> B &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç›´æ¥ä¿®æ”¹fieldçš„å±æ€§å°±å¯ä»¥"><a href="#ç›´æ¥ä¿®æ”¹fieldçš„å±æ€§å°±å¯ä»¥" class="headerlink" title="ç›´æ¥ä¿®æ”¹fieldçš„å±æ€§å°±å¯ä»¥"></a>ç›´æ¥ä¿®æ”¹fieldçš„å±æ€§å°±å¯ä»¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ClassPool classPool = ClassPool.getDefault();</span><br><span class="line">CtClass ctClass = classPool.getCtClass(<span class="string">"vm.JavaassistAnno"</span>);</span><br><span class="line"><span class="keyword">for</span>(CtField ctField : ctClass.getDeclaredFields())&#123;</span><br><span class="line">    FieldInfo fieldInfo = ctField.getFieldInfo();</span><br><span class="line">    ConstPool cp = fieldInfo.getConstPool();</span><br><span class="line">    AnnotationsAttribute att = (AnnotationsAttribute) fieldInfo.getAttribute(AnnotationsAttribute.visibleTag);</span><br><span class="line">    AnnotationsAttribute attribute = <span class="keyword">new</span> AnnotationsAttribute(cp, AnnotationsAttribute.visibleTag);</span><br><span class="line">    <span class="keyword">for</span> (Annotation ann : att.getAnnotations())&#123;</span><br><span class="line">        <span class="keyword">if</span>(ann.getTypeName().equals(<span class="string">"vm.anno.A"</span>))&#123;</span><br><span class="line">            Annotation annotation = <span class="keyword">new</span> Annotation(<span class="string">"vm.anno.B"</span>, cp);</span><br><span class="line">            attribute.addAnnotation(annotation);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            attribute.addAnnotation(ann);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fieldInfo.addAttribute(attribute);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿™ä¸ªé»˜è®¤æ˜¯è°ƒç”¨äº†Thread.currentThread().getContextClassLoader()çš„defineClassæ–¹æ³•ï¼Œä¹Ÿæœ‰apiå¯ä»¥æŒ‡å®šclassloaderï¼Œæˆ–è®¸å–åˆ°äº†hibernateçš„classloaderå°±å¯ä»¥è¾“å‡ºè¿‡å»ã€‚</span></span><br><span class="line">ctClass.toClass();</span><br><span class="line">Class clz = JavaassistAnno.class;</span><br><span class="line">Field field = clz.getDeclaredField(<span class="string">"ob"</span>);</span><br><span class="line"><span class="keyword">for</span> (java.lang.annotation.Annotation annotation : field.getAnnotations())&#123;</span><br><span class="line">    <span class="comment">//å¯ä»¥çœ‹åˆ°èƒ½æˆåŠŸè¾“å‡º@vm.anno.B</span></span><br><span class="line">    System.out.println(annotation);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;JavaassistAnno-obå˜é‡åŠ ä¸Šäº†æ³¨è§£Aï¼Œéœ€è¦æ”¹æˆBã€‚&quot;&gt;&lt;a href=&quot;#JavaassistAnno-obå˜é‡åŠ ä¸Šäº†æ³¨è§£Aï¼Œéœ€è¦æ”¹æˆBã€‚&quot; class=&quot;headerlink&quot; title=&quot;JavaassistAnno obå˜é‡åŠ ä¸Šäº†æ³¨è§£Aï¼Œéœ€è¦æ”¹æˆBã€‚&quot;&gt;&lt;/a&gt;JavaassistAnno obå˜é‡åŠ ä¸Šäº†æ³¨è§£Aï¼Œéœ€è¦æ”¹æˆBã€‚&lt;/h4&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›Javaå°æŠ€å·§</title>
    <link href="http://yoursite.com/2019/01/05/tips/"/>
    <id>http://yoursite.com/2019/01/05/tips/</id>
    <published>2019-01-05T03:21:00.000Z</published>
    <updated>2019-07-05T09:59:31.377Z</updated>
    
    <content type="html"><![CDATA[<h2 id="äº¤æ¢åˆ¤æ–­æ¡ä»¶æé«˜æ€§èƒ½"><a href="#äº¤æ¢åˆ¤æ–­æ¡ä»¶æé«˜æ€§èƒ½" class="headerlink" title="äº¤æ¢åˆ¤æ–­æ¡ä»¶æé«˜æ€§èƒ½"></a>äº¤æ¢åˆ¤æ–­æ¡ä»¶æé«˜æ€§èƒ½</h2><h3 id="åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­"><a href="#åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­" class="headerlink" title="åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­"></a>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Utils.string2Number((String) value) != <span class="keyword">null</span> || style.getFormat() <span class="keyword">instanceof</span> NumberFormat) &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (style.getFormat() <span class="keyword">instanceof</span> NumberFormat || Utils.string2Number((String) value) != <span class="keyword">null</span>) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>ä¸Šä¸‹ä¸¤ä¸ªä»£ç ï¼Œç¬¬ä¸€ä¸ªçš„åˆ¤æ–­å…ˆè½¬æ•°å€¼ç±»å‹ ç¬¬äºŒä¸ªåˆ™å…ˆåˆ¤æ–­formatç±»å‹</p><p>ç¬¬ä¸€æ®µä»£ç ä¸ç®¡ä»€ä¹ˆç±»å‹éƒ½ä¼šåšä¸€æ¬¡ç±»å‹çš„è½¬æ¢ï¼Œè¿™æ ·çš„æ•ˆç‡æ˜¯å¾ˆä½çš„ï¼Œè€Œåˆ¤æ–­ç±»å‹åˆ™è¦å¿«å¾ˆå¤š</p><p>æ‰€ä»¥å†™ifæ¡ä»¶çš„æ—¶å€™è¦éµå¾ªçš„åŸåˆ™æ˜¯åˆ¤æ–­ç®€å•çš„æ¡ä»¶å†™åœ¨å‰é¢<br>ä¸è¿‡è¯´ä¸€ç‚¹ï¼Œæœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯å°è£…å¥½å¤šæ€ï¼Œè€Œä¸æ˜¯ç”¨instanceofåˆ¤æ–­ç±»å‹æ¥æ‰§è¡Œæ–¹æ³•</p><h2 id="å…³äºç®€å•å¯¹è±¡"><a href="#å…³äºç®€å•å¯¹è±¡" class="headerlink" title="å…³äºç®€å•å¯¹è±¡"></a>å…³äºç®€å•å¯¹è±¡</h2><p>åœ¨jdk8ä»¥ä¸‹æ„é€ å¤§é‡ç®€å•å¯¹è±¡æ•ˆç‡ä¹Ÿæ˜¯æå·®ï¼Œjdk8é€Ÿåº¦å¾ˆå¿«å·®ä¸å¤šå·®ä¸Šåƒå€ï¼Œæ‰€ä»¥èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹å°½é‡ä½¿ç”¨åŸºæœ¬ç±»å‹ï¼Œè€Œä¸æ˜¯ç”¨ä¸€ä¸ªç®€å•çš„å¯¹è±¡å¯¹åŸºæœ¬ç±»å‹è¿›è¡Œå°è£…</p><h2 id="å¤§é‡è½»é‡çº§è®¡ç®—æ—¶ä¸è¦ç›´æ¥æäº¤åˆ°çº¿ç¨‹æ± "><a href="#å¤§é‡è½»é‡çº§è®¡ç®—æ—¶ä¸è¦ç›´æ¥æäº¤åˆ°çº¿ç¨‹æ± " class="headerlink" title="å¤§é‡è½»é‡çº§è®¡ç®—æ—¶ä¸è¦ç›´æ¥æäº¤åˆ°çº¿ç¨‹æ± "></a>å¤§é‡è½»é‡çº§è®¡ç®—æ—¶ä¸è¦ç›´æ¥æäº¤åˆ°çº¿ç¨‹æ± </h2><p>æ¯”å¦‚æœ‰80wä¸ªè®¡ç®—ï¼Œæ¯ä¸ªè€—æ—¶éƒ½å¾ˆçŸ­ï¼Œæ’é˜Ÿçš„æ—¶å€™ä¼šæµªè´¹å¤§é‡çš„ç­‰å¾…æ—¶é—´ï¼Œä¸å¦‚ç›´æ¥åˆ†æˆå‡ ç»„ï¼Œæ¯”å¦‚åˆ†æˆ8ç»„ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ10wä¸ªè®¡ç®—ï¼Œä»¥åå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ¥å‡è¡¡æ¯ä¸ªçº¿ç¨‹çš„è´Ÿè½½</p><p>##æœ‰ç”¨çš„ç½‘ç«™</p><p><a href="https://gceasy.io/" target="_blank" rel="noopener">åˆ†æGCæ—¥å¿—</a></p><p><a href="https://fastthread.io" target="_blank" rel="noopener">åˆ†æThreadDump</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;äº¤æ¢åˆ¤æ–­æ¡ä»¶æé«˜æ€§èƒ½&quot;&gt;&lt;a href=&quot;#äº¤æ¢åˆ¤æ–­æ¡ä»¶æé«˜æ€§èƒ½&quot; class=&quot;headerlink&quot; title=&quot;äº¤æ¢åˆ¤æ–­æ¡ä»¶æé«˜æ€§èƒ½&quot;&gt;&lt;/a&gt;äº¤æ¢åˆ¤æ–­æ¡ä»¶æé«˜æ€§èƒ½&lt;/h2&gt;&lt;h3 id=&quot;åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­&quot;&gt;&lt;a href=&quot;#åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­&quot; class=&quot;headerlink&quot; title=&quot;åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­&quot;&gt;&lt;/a&gt;åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (Utils.string2Number((String) value) != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || style.getFormat() &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; NumberFormat) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (style.getFormat() &lt;span class=&quot;keyword&quot;&gt;instanceof&lt;/span&gt; NumberFormat || Utils.string2Number((String) value) != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JVMTI å¼ºåˆ¶GC</title>
    <link href="http://yoursite.com/2018/11/22/JAVA-GC/"/>
    <id>http://yoursite.com/2018/11/22/JAVA-GC/</id>
    <published>2018-11-22T13:33:00.000Z</published>
    <updated>2019-07-05T09:49:15.786Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVM-TI-JVM-Tool-Interface-æ˜¯ç”¨æ¥å¼€å‘å’Œç›‘æµ‹jvmçš„ç¼–ç¨‹æ¥å£ã€‚"><a href="#JVM-TI-JVM-Tool-Interface-æ˜¯ç”¨æ¥å¼€å‘å’Œç›‘æµ‹jvmçš„ç¼–ç¨‹æ¥å£ã€‚" class="headerlink" title="JVM TI (JVM Tool Interface) æ˜¯ç”¨æ¥å¼€å‘å’Œç›‘æµ‹jvmçš„ç¼–ç¨‹æ¥å£ã€‚"></a>JVM TI (JVM Tool Interface) æ˜¯ç”¨æ¥å¼€å‘å’Œç›‘æµ‹jvmçš„ç¼–ç¨‹æ¥å£ã€‚<a id="more"></a></h2><p>å¼€å‘æ–‡æ¡£:<a href="https://docs.oracle.com/javase/8/docs/platform/jvmti/jvmti.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/platform/jvmti/jvmti.html</a></p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://stackoverflow.com/questions/2178296/java-how-do-you-really-force-a-gc-using-jvmtis-forcegargabecollection" target="_blank" rel="noopener">https://stackoverflow.com/questions/2178296/java-how-do-you-really-force-a-gc-using-jvmtis-forcegargabecollection</a></p><p><a href="https://blog.csdn.net/yczz/article/details/39034223" target="_blank" rel="noopener">https://blog.csdn.net/yczz/article/details/39034223</a></p><p><a href="https://blog.csdn.net/ddelphine/article/details/79695947" target="_blank" rel="noopener">https://blog.csdn.net/ddelphine/article/details/79695947</a></p><h3 id="JVM-TI-æä¾›äº†è®¸å¤šJVMç›¸å…³çš„æ¥å£ï¼Œå¼ºåˆ¶GCçš„æ¥å£æ˜¯ï¼š"><a href="#JVM-TI-æä¾›äº†è®¸å¤šJVMç›¸å…³çš„æ¥å£ï¼Œå¼ºåˆ¶GCçš„æ¥å£æ˜¯ï¼š" class="headerlink" title="JVM TI æä¾›äº†è®¸å¤šJVMç›¸å…³çš„æ¥å£ï¼Œå¼ºåˆ¶GCçš„æ¥å£æ˜¯ï¼š"></a>JVM TI æä¾›äº†è®¸å¤šJVMç›¸å…³çš„æ¥å£ï¼Œå¼ºåˆ¶GCçš„æ¥å£æ˜¯ï¼š</h3><p>jvmtiError ForceGarbageCollection(jvmtiEnv* env)<br>å¯ä»¥åœ¨è¢«ç›‘æµ‹çš„æµ‹è¯•ç±»ä¸­å®šä¹‰åŸç”Ÿçš„nativeæ–¹æ³•ï¼Œç„¶åç”¨C/C++è°ƒç”¨JVM TIæä¾›çš„æ¥å£æ¥å®ç°nativeæ–¹æ³•ï¼Œæœ€åç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“.dllï¼ˆlinuxç³»ç»Ÿä¸º shared object æ–‡ä»¶ï¼Œ.soï¼‰</p><h4 id="ç¼–å†™ç®€å•çš„agent"><a href="#ç¼–å†™ç®€å•çš„agent" class="headerlink" title="ç¼–å†™ç®€å•çš„agent"></a>ç¼–å†™ç®€å•çš„agent</h4><p>æºç å¼•ç”¨å¤´æ–‡ä»¶#include&lt;jvmti.h&gt;,è¯¥å¤´æ–‡ä»¶åœ¨jdkå®‰è£…ç›®å½•çš„includeç›®å½•ä¸‹ã€‚#include&lt;jni_md.h&gt;ï¼Œwindowsç³»ç»Ÿä¸­è¯¥å¤´æ–‡ä»¶åœ¨jdkå®‰è£…ç›®å½•include\win32ä¸‹ï¼Œlinuxç³»ç»Ÿåˆ™åœ¨ç›¸åº”çš„include/linuxç›®å½•ä¸‹ã€‚åœ¨ç¼–è¯‘ç”Ÿæˆ.dll/.soæ–‡ä»¶æ—¶è¦æ·»åŠ è¿™ä¸¤ä¸ªå¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„ã€‚</p><p>ForceGC.c -fPIC -shared -o forceGC.so<br>å…·ä½“ç¼–è¯‘æƒ…å†µä¾æ®ç³»ç»Ÿï¼Œè¯­è¨€å’Œç¼–è¯‘å™¨</p><p>linuxç¯å¢ƒä¸‹ ForceGC.c<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jvmti.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni_md.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ForceGC.h"</span></span></span><br><span class="line"><span class="comment">/**&lt; æ­¤å¤„å®šä¹‰ç»“æ„ä½“GobalAgentDataç”¨äºä¿å­˜jvmtiEnvæŒ‡é’ˆ */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    jvmtiEnv * jvmti;</span><br><span class="line">&#125;GlobalAgentData;</span><br><span class="line"><span class="keyword">static</span> GlobalAgentData * gdata;</span><br><span class="line"><span class="function">JNIEXPORT jint JNICALL <span class="title">Agent_OnLoad</span><span class="params">(JavaVM *jvm, <span class="keyword">char</span> * options, <span class="keyword">void</span> *reserved)</span></span>&#123;</span><br><span class="line">    jvmtiEnv * jvmti = <span class="literal">NULL</span>;</span><br><span class="line">    jvmtiCapabilities capa;</span><br><span class="line">    jvmtiError error;</span><br><span class="line">    jint result = (*jvm)-&gt;GetEnv(jvm,(<span class="keyword">void</span>**)&amp;jvmti, JVMTI_VERSION_1_2);</span><br><span class="line">    <span class="keyword">if</span>(result != JNI_OK)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ERROR : Unable to access JVMTI! \n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"GC_Agent was loaded success.\n"</span>);</span><br><span class="line">    (<span class="keyword">void</span>)<span class="built_in">memset</span>(&amp;capa,<span class="number">0</span>,<span class="keyword">sizeof</span>(jvmtiCapabilities));</span><br><span class="line">   </span><br><span class="line">    capa.can_tag_objects = <span class="number">1</span>;</span><br><span class="line">    error = (*jvmti)-&gt;AddCapabilities(jvmti,&amp;capa);</span><br><span class="line">   <span class="comment">//å°†jvmtiä¿å­˜åˆ°å…¨å±€å˜é‡</span></span><br><span class="line">    gdata = (GlobalAgentData*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(GlobalAgentData));</span><br><span class="line">    gdata-&gt;jvmti = jvmti;</span><br><span class="line">    <span class="keyword">return</span> JNI_OK;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_Test_forceGC</span><span class="params">(JNIEnv* env, jclass thisClass)</span></span>&#123;</span><br><span class="line">        jvmtiError error = (*(gdata-&gt;jvmti))-&gt;ForceGarbageCollection(gdata-&gt;jvmti);</span><br><span class="line">        <span class="keyword">if</span> (error == <span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\nJVM has been forced to GC.\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">ForceGC.h</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_FinalizeEscapeGC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_FinalizeEscapeGC</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">JNIEXPORT <span class="keyword">void</span> JNICALL Java_Test_forceGC</span><br><span class="line">  (JNIEnv *, jclass);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">Test.javaæµ‹è¯•ç”¨ç±»</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Test SAVE_HOOK = null;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isAlive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"I am still alive"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override </span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span> throws Throwable </span>&#123;</span><br><span class="line">super.finalize();</span><br><span class="line">System.out.println(<span class="string">"finalize method was excuted."</span>);</span><br><span class="line">Test.SAVE_HOOK = <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> native <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">forceGC</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> throws Throwable </span>&#123;</span><br><span class="line">SAVE_HOOK = <span class="keyword">new</span> Test();</span><br><span class="line">SAVE_HOOK = null;</span><br><span class="line"></span><br><span class="line">forceGC();</span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(SAVE_HOOK != null) &#123;</span><br><span class="line">SAVE_HOOK.isAlive();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Oh... I am dead."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SAVE_HOOK = null;</span><br><span class="line"></span><br><span class="line">System.gc();</span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(SAVE_HOOK != null) &#123;</span><br><span class="line">SAVE_HOOK.isAlive();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Oh... I am dead."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå¯åŠ¨agent<br>java -agentpath:./forceGC.so  Test</p><p>ç»“æœå¦‚ä¸‹ï¼š<br><img src="a.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;JVM-TI-JVM-Tool-Interface-æ˜¯ç”¨æ¥å¼€å‘å’Œç›‘æµ‹jvmçš„ç¼–ç¨‹æ¥å£ã€‚&quot;&gt;&lt;a href=&quot;#JVM-TI-JVM-Tool-Interface-æ˜¯ç”¨æ¥å¼€å‘å’Œç›‘æµ‹jvmçš„ç¼–ç¨‹æ¥å£ã€‚&quot; class=&quot;headerlink&quot; title=&quot;JVM TI (JVM Tool Interface) æ˜¯ç”¨æ¥å¼€å‘å’Œç›‘æµ‹jvmçš„ç¼–ç¨‹æ¥å£ã€‚&quot;&gt;&lt;/a&gt;JVM TI (JVM Tool Interface) æ˜¯ç”¨æ¥å¼€å‘å’Œç›‘æµ‹jvmçš„ç¼–ç¨‹æ¥å£ã€‚
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>Gitçš„undoæŠ€å·§</title>
    <link href="http://yoursite.com/2018/11/22/git/"/>
    <id>http://yoursite.com/2018/11/22/git/</id>
    <published>2018-11-22T13:33:00.000Z</published>
    <updated>2019-07-05T08:41:00.369Z</updated>
    
    <content type="html"><![CDATA[<p>GitHubçš„<a href="https://github.com/blog/2019-how-to-undo-almost-anything-with-git" target="_blank" rel="noopener">How to undo (almost) anything with Git</a>è¿™ç¯‡æ–‡ç« ä»‹ç»äº†Gitä½¿ç”¨ä¸­çš„å„ç§UndoæŠ€å·§ã€‚<a id="more"></a></p><p>ä»»ä½•ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­æœ€æœ‰ç”¨çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿ<strong>æ’¤é”€ï¼ˆundoï¼‰</strong>ä½ ä¹‹å‰çš„é”™è¯¯ã€‚åœ¨Gitä¸­â€œundoâ€åŠŸèƒ½å¯èƒ½å› ä¸ºåœºæ™¯çš„ä¸åŒè€Œæœ‰äº›è®¸çš„å·®å¼‚ã€‚</p><p>å½“ä½ è¿›è¡Œä¸€ä¸ªæ–°çš„æäº¤æ—¶ï¼ŒGitä¼šä¿å­˜ä½ åœ¨è¿™ä¸ªç‰¹å®šæ—¶é—´ç‚¹çš„å¿«ç…§åˆ°æœ¬åœ°çš„ä»“åº“ä¸­ï¼Œä¹‹åï¼Œä½ å¯ä»¥é€šè¿‡Gitæ¥å›åˆ°ä½ æ—©æœŸçš„æŸä¸ªç‰ˆæœ¬ã€‚</p><p>æˆ‘ä»¬æ¥å…ˆçœ‹çœ‹ä¸€äº›éœ€è¦ä½ â€œæ’¤é”€â€çš„å¸¸è§åœºæ™¯ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨Gitæ¥ç”¨æœ€ä½³çš„æ–¹å¼æ¥è§£å†³å®ƒã€‚</p><h2 id="æ’¤é”€å·²ç»æ¨é€åˆ°è¿œç¨‹çš„å˜æ›´"><a href="#æ’¤é”€å·²ç»æ¨é€åˆ°è¿œç¨‹çš„å˜æ›´" class="headerlink" title="æ’¤é”€å·²ç»æ¨é€åˆ°è¿œç¨‹çš„å˜æ›´"></a>æ’¤é”€å·²ç»æ¨é€åˆ°è¿œç¨‹çš„å˜æ›´</h2><h4 id="åœºæ™¯ï¼š"><a href="#åœºæ™¯ï¼š" class="headerlink" title="åœºæ™¯ï¼š"></a>åœºæ™¯ï¼š</h4><p>ä½ å·²ç»æ‰§è¡Œgit push,æŠŠä½ çš„ä¿®æ”¹æ¨é€åˆ°è¿œç¨‹çš„ä»“åº“ï¼Œç°åœ¨ä½ æ„è¯†åˆ°ä¹‹å‰æ¨é€çš„commitä¸­æœ‰ä¸€ä¸ªæœ‰äº›é”™è¯¯ï¼Œæƒ³è¦æ’¤é”€è¯¥commitã€‚</p><h4 id="æ–¹æ¡ˆï¼š"><a href="#æ–¹æ¡ˆï¼š" class="headerlink" title="æ–¹æ¡ˆï¼š"></a>æ–¹æ¡ˆï¼š</h4><p>git revert <sha></sha></p><h4 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h4><p>git revert ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„commitï¼Œå®ƒå’ŒæŒ‡å®šSHAå¯¹åº”çš„commitæ˜¯ç›¸åçš„ï¼ˆæˆ–è€…è¯´æ˜¯åè½¬çš„ï¼‰ã€‚å¦‚æœåŸå‹çš„commitæ˜¯â€œç‰©è´¨â€ï¼Œé‚£ä¹ˆæ–°çš„commitå°±æ˜¯â€œåç‰©è´¨â€ã€‚</p><p>ä»»ä½•ä»åŸæ¥çš„commité‡Œåˆ é™¤çš„å†…å®¹éƒ½ä¼šå†æ–°çš„commité‡Œè¢«åŠ å›å»ï¼Œä»»ä½•åŸæ¥çš„commitä¸­åŠ å…¥çš„å†…å®¹éƒ½ä¼šåœ¨æ–°çš„commité‡Œè¢«åˆ é™¤ã€‚</p><p>è¿™æ˜¯Gitä¸­æœ€å®‰å…¨ã€æœ€åŸºæœ¬çš„æ’¤é”€åœºæ™¯ï¼Œå› ä¸ºå®ƒå¹¶ä¸ä¼šæ”¹å˜å†å²ã€‚æ‰€ä»¥ä½ ç°åœ¨å¯ä»¥git pushæ–°çš„â€œåè½¬â€commitæ¥æŠµæ¶ˆä½ é”™è¯¯æäº¤çš„commitã€‚</p><h2 id="ä¿®æ­£æœ€åä¸€ä¸ªcommitçš„æ¶ˆæ¯"><a href="#ä¿®æ­£æœ€åä¸€ä¸ªcommitçš„æ¶ˆæ¯" class="headerlink" title="ä¿®æ­£æœ€åä¸€ä¸ªcommitçš„æ¶ˆæ¯"></a>ä¿®æ­£æœ€åä¸€ä¸ªcommitçš„æ¶ˆæ¯</h2><h4 id="åœºæ™¯ï¼š-1"><a href="#åœºæ™¯ï¼š-1" class="headerlink" title="åœºæ™¯ï¼š"></a>åœºæ™¯ï¼š</h4><p>ä½ åœ¨æœ€åä¸€æ¡commitæ¶ˆæ¯é‡Œæœ‰ä¸€ä¸ªç¬”è¯¯ï¼Œå·²ç»æ‰§è¡Œäº† git commit -m â€˜Fixes bug #42â€™ ,ä½†æ˜¯åœ¨git pushä¹‹å‰ä½ æ„è¯†åˆ°è¿™ä¸ªæ¶ˆæ¯åº”è¯¥æ˜¯â€œFix bug #43â€ã€‚</p><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p>ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><p>git commit â€“amend<br>æˆ–</p><p>git commit â€“amend -m â€˜Fixes bug #43â€™<br>åŸç†ï¼š<br>git commit â€“amend ä¼šç”¨ä¸€ä¸ªæ–°çš„commitæ›´æ–°å¹¶æ›¿æ¢æœ€è¿‘çš„commitï¼Œè¿™ä¸ªæ–°çš„commitä¼šæŠŠä»»ä½•ä¿®æ”¹å†…å®¹å’Œä¸Šä¸€ä¸ªcommitçš„å†…å®¹ç»“åˆèµ·æ¥ã€‚å¦‚æœå½“å‰æ²¡æœ‰æå‡ºä»»ä½•ä¿®æ”¹ï¼Œè¿™ä¸ªæ“ä½œå°±åªä¼šæŠŠä¸Šæ¬¡çš„commité‡å†™ä¸€éã€‚</p><h2 id="æ’¤é”€â€œæœ¬åœ°çš„â€ä¿®æ”¹"><a href="#æ’¤é”€â€œæœ¬åœ°çš„â€ä¿®æ”¹" class="headerlink" title="æ’¤é”€â€œæœ¬åœ°çš„â€ä¿®æ”¹"></a>æ’¤é”€â€œæœ¬åœ°çš„â€ä¿®æ”¹</h2><h4 id="åœºæ™¯ï¼š-2"><a href="#åœºæ™¯ï¼š-2" class="headerlink" title="åœºæ™¯ï¼š"></a>åœºæ™¯ï¼š</h4><p>ä¸€åªå–µä»é”®ç›˜ä¸Šèµ°è¿‡ï¼ˆåœ¨æˆ‘ä»¬å®¶å°±æ˜¯å„¿å­å°æ‰‹åœ¨é”®ç›˜ä¸Šåˆ’æ‹‰ï¼‰ï¼Œæ— æ„ä¸­ä¿å­˜äº†ä¿®æ”¹ï¼Œç„¶åç ´åäº†ç¼–è¾‘å™¨ã€‚ä¸è¿‡ï¼Œä½ è¿˜æ²¡æœ‰commitè¿™äº›ä¿®æ”¹ã€‚ä½ æƒ³è¦æ¢å¤è¢«ä¿®æ”¹æ–‡ä»¶é‡Œçš„æ‰€æœ‰å†…å®¹â€“å°±åƒä¸Šæ¬¡commitçš„æ—¶å€™ä¸€æ¨¡ä¸€æ ·ã€‚</p><h4 id="æ–¹æ³•ï¼š"><a href="#æ–¹æ³•ï¼š" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h4><p>git checkout â€“ <bad filename=""><br>åŸç†<br>git checkoutä¼šæŠŠå·¥ä½œç›®å½•ä¸­çš„æ–‡ä»¶ä¿®æ”¹åˆ°Gitä¹‹å‰è®°å½•çš„æŸä¸ªçŠ¶æ€ã€‚ä½ å¯ä»¥æä¾›ä½ æƒ³è¿”å›çš„åˆ†æ”¯æˆ–è€…ç‰¹å®šçš„SHAï¼Œæˆ–è€…åœ¨ç¼ºçœæƒ…å†µä¸‹ï¼ŒGItä¼šè®¤ä¸ºä½ å¸Œæœ›checkoutçš„æ˜¯HEADï¼Œå½“å‰checkoutåˆ†æ”¯çš„æœ€åä¸€æ¬¡commitã€‚</bad></p><p>è®°ä½ï¼š ä½ ç”¨è¿™ç§æ–¹æ³•â€œæ’¤é”€â€çš„ä»»ä½•ä¿®æ”¹çœŸçš„ä¼šå®Œå…¨æ¶ˆå¤±ã€‚å› ä¸ºå®ƒä»¬ä»æ¥æ²¡æœ‰è¢«æäº¤è¿‡ï¼Œæ‰€ä»¥ä¹‹åGitä¹Ÿæ— æ³•å¸®åŠ©æˆ‘ä»¬æ¢å¤å®ƒä»¬ã€‚ä½ ä¸€å®šè¦ç¡®ä¿è‡ªå·±äº†è§£åœ¨è¿™ä¸ªæ“ä½œä¸­ä¸¢æ‰çš„ä¸œè¥¿æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¹Ÿè¡Œå¯ä»¥åˆ©ç”¨git diffå…ˆç¡®è®¤ä¸€ä¸‹ï¼‰</p><h2 id="é‡ç½®â€œæœ¬åœ°çš„â€ä¿®æ”¹"><a href="#é‡ç½®â€œæœ¬åœ°çš„â€ä¿®æ”¹" class="headerlink" title="é‡ç½®â€œæœ¬åœ°çš„â€ä¿®æ”¹"></a>é‡ç½®â€œæœ¬åœ°çš„â€ä¿®æ”¹</h2><p>åœºæ™¯ï¼š<br>ä½ åœ¨æœ¬åœ°æäº¤äº†ä¸€ä¸‹ä¸œè¥¿ï¼ˆè¿˜æ²¡æœ‰pushï¼‰ï¼Œä½†æ˜¯æ‰€æœ‰è¿™äº›ä¸œè¥¿éƒ½å¾ˆç³Ÿç³•ï¼Œä½ å¸Œæœ›æ’¤é”€å‰é¢çš„ä¸‰æ¬¡æäº¤ï¼ˆå°±åƒå®ƒä»¬ä»æ¥æ²¡æœ‰å‘ç”Ÿè¿‡ä¸€æ ·ï¼‰ã€‚</p><h4 id="æ–¹æ³•ï¼š-1"><a href="#æ–¹æ³•ï¼š-1" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h4><p>git reset <last good="" sha=""><br>æˆ–</last></p><p>git reset â€“hard <last good="" sha=""></last></p><h4 id="åŸç†ï¼š-1"><a href="#åŸç†ï¼š-1" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h4><p>git resetä¼šæŠŠä½ çš„ä»£ç åº“å†å²è¿”å›åˆ°æŒ‡å®šçš„SHAçŠ¶æ€ã€‚è¿™æ ·å°±åƒæ˜¯è¿™äº›æäº¤ä»æ¥æ²¡æœ‰å‘ç”Ÿè¿‡ã€‚ç¼ºçœæƒ…å†µä¸‹ï¼Œgit resetä¼šä¿ç•™å·¥ä½œç›®å½•ã€‚è¿™æ ·ï¼Œæäº¤æ˜¯æ²¡æœ‰äº†ï¼Œä½†æ˜¯ä¿®æ”¹å†…å®¹è¿˜åœ¨ç£ç›˜ä¸Šã€‚è¿™æ˜¯ä¸€ç§å®‰å…¨çš„é€‰æ‹©ï¼Œä½†é€šå¸¸æˆ‘ä»¬ä¼šå¸Œæœ›ä¸€æ­¥å°±â€œæ’¤é”€â€æäº¤å·²ç»ä¿®æ”¹å†…å®¹(è¿™å°±æ˜¯â€“hardé€‰é¡¹çš„åŠŸèƒ½)ã€‚</p><h2 id="åœ¨æ’¤é”€â€œæœ¬åœ°ä¿®æ”¹â€ä¹‹åå†æ¢å¤"><a href="#åœ¨æ’¤é”€â€œæœ¬åœ°ä¿®æ”¹â€ä¹‹åå†æ¢å¤" class="headerlink" title="åœ¨æ’¤é”€â€œæœ¬åœ°ä¿®æ”¹â€ä¹‹åå†æ¢å¤"></a>åœ¨æ’¤é”€â€œæœ¬åœ°ä¿®æ”¹â€ä¹‹åå†æ¢å¤</h2><h4 id="åœºæ™¯ï¼š-3"><a href="#åœºæ™¯ï¼š-3" class="headerlink" title="åœºæ™¯ï¼š"></a>åœºæ™¯ï¼š</h4><p>ä½ æäº¤äº†å‡ ä¸ªcommitï¼Œç„¶åç”¨git reset â€“hardæ’¤é”€äº†è¿™äº›ä¿®æ”¹ï¼ˆè§ä¸Šä¸€æ®µï¼‰ï¼Œæ¥ç€ä½ åˆæ„è¯†åˆ°ï¼šä½ å¸Œæœ›è¿˜åŸè¿™äº›ä¿®æ”¹ï¼</p><h4 id="æ–¹æ³•ï¼š-2"><a href="#æ–¹æ³•ï¼š-2" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h4><p>git reflog<br>å’Œ</p><p>git reset<br>æˆ–</p><p>git checkout</p><h4 id="åŸç†ï¼š-2"><a href="#åŸç†ï¼š-2" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h4><p>git reflogå¯¹äºæ¢å¤é¡¹ç›®å†å²æ˜¯ä¸€ä¸ªè¶…æ£’çš„æ–¹å¼ã€‚ä½ å¯ä»¥æ¢å¤å‡ ä¹ä»»ä½•ï¼ˆcommitè¿‡çš„ï¼‰ä¸œè¥¿ã€‚</p><p>ä½ å¯ä»¥èƒ½ç†Ÿæ‚‰git logå‘½ä»¤ï¼Œå®ƒä¼šæ˜¾ç¤ºcommitçš„åˆ—è¡¨ã€‚ git reflogä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡å®ƒæ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªHEADå‘ç”Ÿæ”¹å˜çš„æ—¶é—´åˆ—è¡¨ã€‚</p><h2 id="ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š"><a href="#ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š"></a>ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š</h2><p>å®ƒæ¶‰åŠçš„åªæ˜¯HEADçš„æ”¹å˜ã€‚åœ¨ä½ åˆ‡æ¢åˆ†æ”¯ã€ç”¨git commitè¿›è¡Œæäº¤ã€ä»¥åŠç”¨git resetæ’¤é”€commitæ—¶ï¼ŒHEADä¼šå‘ç”Ÿæ”¹å˜ï¼Œä½†å½“ä½ ä½¿ç”¨git checkout â€“ <bad filename="">æ’¤é”€æ—¶ï¼ŒHEADå¹¶ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚å°±åƒæˆ‘ä»¬åœ¨ä¸Šé¢è¯´çš„ï¼Œè¿™äº›ä¿®æ”¹ä»æ¥æ²¡æœ‰è¢«æäº¤è¿‡ï¼Œå› æ­¤reflogä¹Ÿæ— æ³•å¸®åŠ©æˆ‘ä»¬æ¢å¤å®ƒä»¬ã€‚<br>git reflogä¸ä¼šæ°¸è¿œä¿æŒã€‚Gitä¼šå®šæœŸæ¸…ç†é‚£äº›â€œç”¨ä¸åˆ°çš„â€å¯¹è±¡ã€‚ä¸è¦æŒ‡æœ›å‡ ä¸ªæœˆå‰çš„æäº¤è¿˜ä¸€ç›´èººç€é‚£é‡Œã€‚<br>ä½ çš„reflogå°±æ˜¯ä½ çš„ï¼Œåªæ˜¯ä½ çš„ï¼Œä½ ä¸èƒ½ç”¨git reflogæ¥æ¢å¤å¦å¤–ä¸€ä¸ªå¼€å‘è€…æ²¡æœ‰pushè¿‡çš„commitã€‚<br>git reflog</bad></p><p>é‚£ä¹ˆâ€¦ä½ å¦‚ä½•æ¥åˆ©ç”¨reflogæ¥â€œæ¢å¤â€ä¹‹å‰â€œæ’¤é”€â€çš„commitå‘¢ï¼Ÿå®ƒå–å†³äºä½ æƒ³åšåˆ°çš„åˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p><p>å¦‚æœä½ å¸Œæœ›å‡†ç¡®çš„æ¢å¤é¡¹ç›®çš„å†å²åˆ°æŸä¸ªæ—¶é—´ç‚¹ï¼Œç”¨git reset â€“hard <sha><br>å¦‚æœä½ å¸Œæœ›é‡å»ºå·¥ä½œç›®å½•é‡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼Œè®©å®ƒä»¬æ¢å¤åˆ°æŸä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€ï¼Œç”¨git checkout <sha> â€“ <filename><br>å¦‚æœä½ å¸Œæœ›æŠŠè¿™äº›commité‡Œçš„æŸä¸ªé‡æ–°æäº¤åˆ°ä½ çš„ä»£ç åº“é‡Œï¼Œç”¨git cherry-pick <sha><br>åˆ©ç”¨åˆ†æ”¯çš„å¦ä¸€ç§åšæ³•</sha></filename></sha></sha></p><h4 id="åœºæ™¯ï¼š-4"><a href="#åœºæ™¯ï¼š-4" class="headerlink" title="åœºæ™¯ï¼š"></a>åœºæ™¯ï¼š</h4><p>ä½ è¿›è¡Œäº†ä¸€äº›æäº¤ï¼Œç„¶åæ„è¯†åˆ°ä½ å¼€å§‹checkoutçš„æ˜¯masteråˆ†æ”¯ã€‚å¸Œæœ›è¿™äº›æäº¤è¿›å…¥åˆ°å¦å¤–ä¸€ä¸ªç‰¹æ€§ï¼ˆfeatureï¼‰åˆ†æ”¯ã€‚</p><h4 id="æ–¹æ³•ï¼š-3"><a href="#æ–¹æ³•ï¼š-3" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h4><p>git branch feature<br>git reset â€“hard origin/master<br>git checkout feature</p><h4 id="åŸç†ï¼š-3"><a href="#åŸç†ï¼š-3" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h4><p>ä½ å¯èƒ½ä¹ æƒ¯ç”¨ git checkout -b <name>åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼ˆè¿™æ˜¯åˆ›å»ºæ–°åˆ†æ”¯å¹¶é©¬ä¸Šcheckoutçš„æµè¡Œæ·å¾„ï¼‰ï¼Œä½†æ˜¯ä½ ä¸å¸Œæœ›é©¬ä¸Šåˆ‡æ¢åˆ†æ”¯ã€‚è¿™é‡Œï¼Œgit branch featureåˆ›å»ºäº†ä¸€ä¸ªå«åšfeatureçš„æ–°åˆ†æ”¯ï¼Œå¹¶æŒ‡å‘ä½ æœ€è¿‘çš„commitï¼Œä½†æ˜¯è¿˜æ˜¯è®©ä½ checkoutåœ¨masteråˆ†æ”¯ä¸Šã€‚</name></p><p>ä¸‹ä¸€æ­¥ï¼Œåœ¨æäº¤ä»»ä½•æ–°çš„commitä¹‹å‰ï¼Œç”¨git reset â€“hard æŠŠmasteråˆ†æ”¯å€’å›origin/masterã€‚ä¸è¿‡åˆ«æ‹…å¿ƒï¼Œé‚£äº›commitè¿˜åœ¨featureåˆ†æ”¯é‡Œã€‚</p><p>æœ€åï¼Œç”¨git checkoutåˆ‡æ¢åˆ°æ–°çš„featureåˆ†æ”¯ï¼Œå¹¶è®©ä½ æœ€è¿‘æ‰€æœ‰çš„å·¥ä½œæˆæœéƒ½å®Œå¥½æ— æŸã€‚</p><p>åŠæ—¶åˆ†æ”¯ï¼Œçœå»ç¹ç</p><h4 id="åœºæ™¯ï¼š-5"><a href="#åœºæ™¯ï¼š-5" class="headerlink" title="åœºæ™¯ï¼š"></a>åœºæ™¯ï¼š</h4><p>ä½ åœ¨masteråˆ†æ”¯çš„åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼Œä½†æ˜¯masteråˆ†æ”¯å·²ç»æ»åäºorigin/masterå¾ˆå¤šã€‚ç°åœ¨masteråˆ†æ”¯å·²ç»å’Œorigin/masteråŒæ­¥ï¼Œä½ å¸Œæœ›åœ¨featureä¸Šçš„æäº¤ä»ç°åœ¨å¼€å§‹ï¼Œè€Œä¸æ˜¯ä»æ»åå¾ˆå¤šçš„åœ°æ–¹å¼€å§‹ã€‚</p><h4 id="æ–¹æ³•ï¼š-4"><a href="#æ–¹æ³•ï¼š-4" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h4><p>git checkout feature<br>å’Œ</p><p>git rebase master</p><h4 id="åŸç†ï¼š-4"><a href="#åŸç†ï¼š-4" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h4><p>è¦è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Œä½ æœ¬æ¥å¯ä»¥é€šè¿‡git resetï¼ˆä¸åŠ â€“hardï¼Œè¿™æ ·å¯ä»¥å†ç£ç›˜ä¸Šä¿ç•™ä¿®æ”¹ï¼‰å’Œgit checkout -b <new branch="" name="">ç„¶åå†é‡æ–°æäº¤ä¿®æ”¹ï¼Œä¸è¿‡è¿™æ ·åšçš„è¯ï¼Œä½ å°±å¤±å»æäº¤å†å²ã€‚æˆ‘ä»¬æœ‰æ›´å¥½çš„åŠæ³•ã€‚</new></p><p>git rebase masterä¼šåšä¸‹é¢çš„è¿™äº›äº‹æƒ…ï¼š</p><p>é¦–å…ˆå®ƒä¼šæ‰¾åˆ°ä½ å½“å‰checkoutçš„åˆ†æ”¯å’Œmasteråˆ†æ”¯çš„å…±åŒç¥–å…ˆã€‚<br>ç„¶åå®ƒresetå½“å‰checkoutçš„åˆ†æ”¯åˆ°é‚£ä¸ªå…±åŒç¥–å…ˆ ï¼Œåœ¨ä¸€ä¸ªä¸´æ—¶ä¿å­˜åŒºå­˜æ”¾æ‰€æœ‰ä¹‹å‰çš„æäº¤ã€‚<br>ç„¶åå®ƒæŠŠå½“å‰checkoutçš„åˆ†æ”¯æåˆ°masterçš„æœ«å°¾éƒ¨åˆ†ï¼Œå¹¶ä»ä¸´æ—¶ä¿å­˜åŒºé‡æ–°æŠŠå­˜æ”¾çš„commitæäº¤åˆ°masteråˆ†æ”¯çš„æœ€å ä¸€ä¸ªcommitä¹‹åã€‚<br>å¤§é‡çš„æ’¤é”€/æ¢å¤<br>åœºæ™¯ï¼š<br>ä½ å‘æŸä¸ªæ–¹å‘å¼€å§‹å®ç°ä¸€ä¸ªç‰¹æ€§ï¼Œä½†æ˜¯ä½ åŠè·¯æ„è¯†åˆ°å¦ä¸€ä¸ªæ–¹æ¡ˆæ›´å¥½ã€‚ä½ å·²ç»è¿›è¡Œäº†åå‡ æ¬¡çš„æäº¤ï¼Œä½†æ˜¯ä½ ç°åœ¨åªéœ€è¦å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ä½ å¸Œæœ›å…¶ä»–ä¸éœ€è¦çš„æäº¤ç»Ÿç»Ÿæ¶ˆå¤±ã€‚</p><h4 id="æ–¹æ¡ˆï¼š-1"><a href="#æ–¹æ¡ˆï¼š-1" class="headerlink" title="æ–¹æ¡ˆï¼š"></a>æ–¹æ¡ˆï¼š</h4><p>git rebase -i <carlier sha=""><br>åŸç†ï¼š<br>-i å‚æ•°ä¼šè®©rebaseè¿›å…¥â€œäº¤äº’æ¨¡å¼â€ã€‚å®ƒå¼€å§‹ç±»ä¼¼äºç­¾åè®¨è®ºçš„rebaseï¼Œä½†åœ¨é‡æ–°è¿›è¡Œä»»ä½•æäº¤ä¹‹å‰ï¼Œå®ƒä¼šæš‚åœä¸‹æ¥å¹¶å…è®¸ä½ è¯¦ç»†çš„ä¿®æ”¹æ¯ä¸€ä¸ªæäº¤ã€‚</carlier></p><p>rebase -i ä¼šæ‰“å¼€ä½ ç¼ºçœçš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œé‡Œé¢åˆ—å‡ºå€™é€‰çš„æäº¤ã€‚</p><p>rebase -i</p><p>å‰é¢ä¸¤åˆ—æ˜¯é”®ï¼š ç¬¬ä¸€ä¸ªæ˜¯é€‰å®šçš„å‘½ä»¤ï¼Œå¯¹åº”ç¬¬äºŒåˆ—é‡Œçš„SHAç¡®å®šçš„commitã€‚ç¼ºçœæƒ…å†µä¸‹ï¼Œrebase -iå‡å®šæ¯ä¸ªcommitéƒ½è¦é€šè¿‡pickå‘½ä»¤è¢«è¿è¡Œã€‚</p><p>è¦ä¸¢å¼ƒä¸€ä¸ªcommitï¼Œåªè¦åœ¨ç¼–è¾‘å™¨ä¸­åˆ é™¤é‚£ä¸€è¡Œå°±è¡Œäº†ã€‚å¦‚æœä½ ä¸å†éœ€è¦é¡¹ç›®é‡Œé¢çš„é‚£å‡ ä¸ªé”™è¯¯çš„æäº¤ï¼Œ åˆ é™¤ä½ æƒ³åˆ é™¤çš„å‡ è¡Œã€‚</p><p>å¦‚æœä½ éœ€è¦æš´æ¼commitçš„å†…å®¹ï¼Œè€Œæ˜¯å¯¹commitæ¶ˆæ¯è¿›è¡Œç¼–è¾‘ï¼Œä½ å¯ä»¥ä½¿ç”¨rewordå‘½ä»¤ï¼Œå°†ç¬¬ä¸€åˆ—çš„pickæ›¿æ¢æˆrewordï¼ˆæˆ–è€…ç›´æ¥ä½¿ç”¨rï¼‰ã€‚æœ‰äººä¼šè§‰å¾—å†è¿™é‡Œç›´æ¥é‡å†™commitæ¶ˆæ¯å°±è¡Œäº†ï¼Œä½†æ˜¯è¿™æ ·æ˜¯ä¸ç®¡ç”¨çš„ï¼ˆrebase -iä¼šå¿½ç•¥SHAåˆ—å‰é¢çš„ä»»ä½•ä¸œè¥¿ï¼Œå®ƒåé¢çš„æ–‡æœ¬åªæ˜¯ç”¨æ¥å¸®åŠ©æˆ‘ä»¬è®°ä½é‚£ä¸€ä¸²SHAä»£è¡¨ä»€ä¹ˆï¼‰ã€‚å½“ä½ å®Œæˆrebase -içš„æ“ä½œä¹‹åï¼Œä½ ä¼šè¢«æç¤ºè¾“å…¥éœ€è¦ç¼–å†™çš„ä»»ä½•commitæ¶ˆæ¯ã€‚</p><p>å¦‚æœä½ éœ€è¦æŠŠä¸¤ä¸ªcommitåˆå¹¶åœ¨ä¸€èµ·ï¼Œä½ å¯ä»¥ä½¿ç”¨squashæˆ–è€…fixupå‘½ä»¤ã€‚</p><p>rebase -i</p><p>squashå’Œfixupä¼šâ€œå‘ä¸Šâ€åˆå¹¶ï¼ˆå¸¦æœ‰è¿™ä¸¤ä¸ªå‘½ä»¤çš„commitä¼šè¢«åˆå¹¶åˆ°ä»–çš„ç­¾ä¸€ä¸ªcommité‡Œï¼‰ã€‚ä¸Šé¢çš„è¿™ä¸ªä¾‹å­é‡Œï¼Œ0835fe2å’Œ6943e85ä¼šåˆå¹¶æˆä¸€ä¸ªcommitï¼Œ38f5c4cå’Œaf67f82ä¼šè¢«åˆå¹¶æˆå¦ä¸€ä¸ªã€‚</p><p>å¦‚æœä½ é€‰æ‹©äº†squashï¼ŒGitä¼šæç¤ºæˆ‘ä»¬ç»™æ–°åˆå¹¶çš„commitä¸€ä¸ªæ–°çš„commitæ¶ˆæ¯ï¼› fixupåˆ™ä¼šæŠŠåˆå¹¶æ¸…å•é‡Œçš„ç¬¬ä¸€ä¸ªcommitçš„æ¶ˆæ¯ç›´æ¥ç»™æ–°åˆå¹¶çš„commitã€‚</p><p>åœ¨ä½ ä¿å­˜å¹¶æ¨å‡ºç¼–è¾‘å™¨çš„æ—¶å€™ï¼ŒGitä¼šæŒ‰ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºè¿ç”¨ä½ çš„commitã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ä¿å­˜å‰ä¿®æ”¹commité¡ºåºæ¥æ”¹å˜è¿ç”¨çš„é¡ºåºã€‚å¦‚æœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥åŒå¦‚ä¸‹å®‰æ’æŠŠaf67f82å’Œ0835fe2åˆå¹¶åˆ°ä¸€èµ·ã€‚</p><p>rebase -i</p><h2 id="ä¿®å¤æ›´æ—©æœŸçš„commit"><a href="#ä¿®å¤æ›´æ—©æœŸçš„commit" class="headerlink" title="ä¿®å¤æ›´æ—©æœŸçš„commit"></a>ä¿®å¤æ›´æ—©æœŸçš„commit</h2><p>åœºæ™¯ï¼š<br>ä½ åœ¨ä¸€ä¸ªæ›´æ—©æœŸçš„commité‡Œå¿˜è®°äº†åŠ å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæ›´æ—©çš„commitèƒ½åŒ…å«è¿™ä¸ªå¿˜è®°çš„æ–‡ä»¶å°±å¤ªæ£’äº†ã€‚ä½ è¿˜æ²¡æœ‰pushï¼Œä½†è¿™ä¸ªcommitä¸æ˜¯æœ€è¿‘çš„ï¼Œæ‰€ä»¥ä½ è¿˜æ²¡æ³•ç”¨commit â€“amend</p><h4 id="æ–¹æ³•ï¼š-5"><a href="#æ–¹æ³•ï¼š-5" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h4><p>git commit â€“squash <sha of="" the="" earlier="" commit=""><br>å’Œ</sha></p><p>git rebase â€“autosquash -i <even earlier="" sha=""></even></p><h4 id="åŸç†ï¼š-5"><a href="#åŸç†ï¼š-5" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h4><p>git commit â€“squashä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„commitï¼Œå®ƒå¸¦æœ‰ä¸€ä¸ªcommitæ¶ˆæ¯ï¼Œç±»ä¼¼äºsquash! Earlier commitã€‚(ä½ ä¹Ÿå¯ä»¥æ‰‹å·¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ç±»ä¼¼commitæ¶ˆæ¯çš„commitï¼Œä½†æ˜¯ commit â€“squash å¯ä»¥å¸®ä½ çœä¸‹è¾“å…¥çš„å·¥ä½œ)</p><p>å¦‚æœä½ ä¸æƒ³è¢«æç¤ºä¸ºæ–°åˆå¹¶çš„commitè¾“å…¥ä¸€æ¡æ–°çš„commitæ¶ˆæ¯ï¼Œä½ ä¹Ÿå¯ä»¥åˆ©ç”¨ git commit â€“fixupã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œä½ å¾ˆæœ‰å¯èƒ½ä¼šç”¨commit â€“fixupï¼Œå› ä¸ºä½ åªæ˜¯å¸Œæœ›åœ¨rebaseçš„é€‚åˆï¼Œä½¿ç”¨æ—©æœŸcommitçš„commitæ¶ˆæ¯ã€‚</p><p>rebase â€“autosquash -i ä¼šæ¿€æ´»ä¸€ä¸ªäº¤äº’å¼çš„rebaseç¼–è¾‘å™¨ï¼Œä½†æ˜¯ç¼–è¾‘å™¨æ‰“å¼€çš„é€‚åˆï¼Œåœ¨commitæ¸…å•é‡Œä»»ä½•squash!å’Œfixupï¼çš„commitéƒ½å·²ç»é…å¯¹åˆ°ç›®æ ‡commitä¸Šäº†ã€‚</p><p>rebase â€“autosquash -i</p><p>åœ¨ä½¿ç”¨ â€“squash å’Œ â€“fixupçš„é€‚åˆï¼Œä½ å¯èƒ½ä¸è®°å¾—æƒ³è¦ä¿®æ­£çš„commitçš„SHAäº†ï¼ˆåªæ˜¯è®°å¾—å®ƒæ˜¯å‰é¢çš„ç¬¬1ä¸ªæˆ–è€…ç¬¬5ä¸ªcommitï¼‰ã€‚ä½ ä¼šå‘ç°Gitçš„^å’Œ~æ“ä½œç¬¦ç‰¹åˆ«å¥½ç”¨ã€‚HEAD~æ˜¯HEADçš„å‰ä¸€ä¸ªcommitã€‚HEAD~4æ˜¯HEADå¾€å‰ç¬¬4ä¸ªï¼ˆæˆ–è€…ä¸€èµ·ç®—ï¼Œå€’æ•°ç¬¬5ä¸ªcommitï¼‰ã€‚</p><h2 id="åœæ­¢è¿½è¸ªä¸€ä¸ªæ–‡ä»¶"><a href="#åœæ­¢è¿½è¸ªä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="åœæ­¢è¿½è¸ªä¸€ä¸ªæ–‡ä»¶"></a>åœæ­¢è¿½è¸ªä¸€ä¸ªæ–‡ä»¶</h2><h4 id="åœºæ™¯ï¼š-6"><a href="#åœºæ™¯ï¼š-6" class="headerlink" title="åœºæ™¯ï¼š"></a>åœºæ™¯ï¼š</h4><p>ä½ å¶ç„¶æŠŠapplication.logåŠ åˆ°ä»£ç åº“é‡Œäº†ï¼Œç°åœ¨æ¯æ¬¡ä½ è¿è¡Œåº”ç”¨ï¼ŒGitéƒ½ä¼šæŠ¥å‘Šåœ¨application.logé‡Œæœ‰æœªæäº¤çš„ä¿®æ”¹ã€‚ä½ æŠŠ *.logæ”¾åˆ°äº†.gitignoreæ–‡ä»¶é‡Œï¼Œå¯æ–‡ä»¶è¿˜æ˜¯åœ¨ä»£ç åº“é‡Œï¼Œä½ æ€æ ·æ‰èƒ½è®©Gitâ€œæ’¤é”€â€å¯¹è¿™ä¸ªæ–‡ä»¶çš„è¿½è¸ªå‘¢ï¼Ÿ</p><h4 id="æ–¹æ³•ï¼š-6"><a href="#æ–¹æ³•ï¼š-6" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h4><p>git rm â€“cached application.log<br>åŸç†:<br>è™½ç„¶.gitignoreä¼šé˜»æ­¢Gitè¿½è¸ªæ–‡ä»¶çš„ä¿®æ”¹ï¼Œç”šè‡³ä¸å…³æ³¨æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä½†è¿™åªæ˜¯é’ˆå¯¹é‚£äº›ä»¥å‰ä»æ¥æ²¡æœ‰è¿½è¸ªè¿‡çš„æ–‡ä»¶ã€‚ä¸€æ—¦æœ‰ä¸ªæ–‡ä»¶è¢«åŠ å…¥å¹¶æäº¤äº†ï¼ŒGitå°±ä¼šæŒç»­å…³æ³¨æ”¹æ–‡ä»¶çš„æ”¹å˜ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœä½ åˆ©ç”¨git add -fæ¥å¼ºåˆ¶æˆ–è¦†ç›–äº†.gitignoreï¼ŒGitè¿˜ä¼šæŒç»­è¿½è¸ªæ”¹å˜çš„æƒ…å†µã€‚ä¹‹åä½ å°±ä¸å¿…ç”¨-fæ¥æ·»åŠ è¿™ä¸ªæ–‡ä»¶äº†ã€‚</p><p>å¦‚æœä½ å¸Œæœ›ä»Gitçš„è¿½è¸ªå¯¹è±¡ä¸­åˆ é™¤é‚£ä¸ªæœ¬åº”å¿½ç•¥çš„æ–‡ä»¶ï¼Œgit rm â€“cachedä¼šä»è¿½è¸ªå¯¹è±¡ä¸­åˆ é™¤å®ƒï¼Œä½†è®©æ–‡ä»¶åœ¨ç£ç›˜ä¸Šä¿æŒåŸå°ä¸åŠ¨ã€‚å› ä¸ºç°åœ¨å®ƒå·²ç»è¢«å¿½ç•¥äº†ï¼Œä½ åœ¨git statusé‡Œå°±ä¸ä¼šå†çœ‹è§è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿä¸å›å†å¶ç„¶æäº¤è¯¥æ–‡ä»¶çš„ä¿®æ”¹äº†ã€‚</p><p>è¿™å°±æ˜¯å¦‚ä½•åœ¨Gité‡Œæ’¤é”€ä»»ä½•æ“ä½œçš„æ–¹æ³•ã€‚è¦äº†è§£æ›´å¤šå…³äºæœ¬æ–‡ä¸­ç”¨åˆ°çš„Gitå‘½ä»¤ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;GitHubçš„&lt;a href=&quot;https://github.com/blog/2019-how-to-undo-almost-anything-with-git&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;How to undo (almost) anything with Git&lt;/a&gt;è¿™ç¯‡æ–‡ç« ä»‹ç»äº†Gitä½¿ç”¨ä¸­çš„å„ç§UndoæŠ€å·§ã€‚
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="Git" scheme="http://yoursite.com/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>JAVA ClassLoader</title>
    <link href="http://yoursite.com/2018/08/08/JAVA-classloader/"/>
    <id>http://yoursite.com/2018/08/08/JAVA-classloader/</id>
    <published>2018-08-08T04:53:41.000Z</published>
    <updated>2019-07-05T09:46:01.913Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»è™šæ‹Ÿæœºåº•å±‚æœºåˆ¶è¯´èµ·ï¼Œç„¶ååˆ†æClassLoaderä»£ç ç»“æ„ä¸ç‰¹æ€§ï¼Œæœ€åè¯´æ˜ClassLoaderåœ¨9.0æ’ä»¶å¼•æ“ä¸­çš„åº”ç”¨ã€‚<br><a id="more"></a></p><h2 id="Classå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Classå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Classå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>Classå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>åŠ è½½<br>éªŒè¯<br>å‡†å¤‡<br>è§£æ<br>åˆå§‹åŒ–<br>è¿™é‡Œç®€åŒ–ä¸€ä¸‹ï¼Œåªå…³æ³¨åŠ è½½å’Œåˆå§‹åŒ–ã€‚åŠ è½½æ˜¯æŒ‡å°†äºŒè¿›åˆ¶å­—èŠ‚ç è½¬åŒ–ä¸ºClasså¯¹è±¡çš„è¿‡ç¨‹ï¼Œåˆå§‹åŒ–æ˜¯æŒ‡æ‰§è¡ŒClassä¸­staticæ–¹æ³•å—ï¼Œç”Ÿæˆstaticå˜é‡ç­‰ã€‚</p><p><strong><em>è§¦å‘åŠ è½½è¿‡ç¨‹çš„æ“ä½œæœ‰ï¼š</em></strong></p><p>æ˜¾å¼è°ƒç”¨classLoader.loadClass(className)<br>åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼ˆæ¯”å¦‚å½“å‰ç±»çš„åˆå§‹åŒ–ï¼‰ä¸­ï¼Œä½¿ç”¨äº†å…¶ä»–çš„ç±»ï¼Œè™šæ‹Ÿæœºä¼šè‡ªåŠ¨åŠ è½½ï¼ˆä¸ä¸€å®šä¼šåˆå§‹åŒ–ï¼‰<br>ClassLoaderåœ¨æ˜¾ç¤ºè°ƒç”¨ä¸­çš„ä½œç”¨ä¸è¨€è€Œå–»ã€‚åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœç”¨åˆ°äº†å…¶ä»–ç±»ï¼Œè™šæ‹Ÿæœºä¼šé¦–å…ˆè·å–å½“å‰ç±»çš„ClassLoaderï¼Œå†é€šè¿‡è¿™ä¸ªClassLoaderå»æŸ¥æ‰¾å¼•ç”¨çš„ç±»ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šè§¦å‘åŠ è½½æ“ä½œï¼Œå¦‚æœä¹Ÿæ²¡åŠ è½½åˆ°ï¼Œå°±ä¼šæŠ›ClassNotFoundExceptionã€‚</p><p><strong><em>è§¦å‘åˆå§‹åŒ–çš„æ“ä½œæœ‰ï¼š</em></strong></p><p>æ˜¾ç¤ºåˆå§‹åŒ–ï¼šClass.forName(className)<br>åˆ›å»ºç±»çš„å®ä¾‹<br>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•<br>ä½¿ç”¨ç±»çš„éå¸¸é‡é™æ€å­—æ®µ<br>åˆå§‹åŒ–æŸä¸ªç±»çš„å­—ç±»<br>é€šå¸¸ä¸€ä¸ªç±»çš„åŠ è½½ä¸ä¼šè§¦å‘å…¶ä»–ç±»çš„åŠ è½½ï¼Œä¸€ä¸ªç±»çš„åˆå§‹åŒ–ä¼šè§¦å‘å…¶ä»–ç±»çš„åŠ è½½å’Œåˆå§‹åŒ–ã€‚</p><p><strong><em>ä¸åŒClassLoaderå¯¹ç±»çš„éš”ç¦»</em></strong></p><p>é€šè¿‡ä¸Šé¢Classçš„åˆå§‹åŒ–è¿‡ç¨‹å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªç±»èƒ½å¤Ÿä¾èµ–ä»€ä¹ˆç±»ï¼Œå®Œå…¨æ˜¯å–å†³äºä»–çš„ClassLoaderèƒ½æ‰¾åˆ°å“ªäº›ç±»ã€‚å¦‚æœä¸¤ä¸ªClassLoaderæ²¡æœ‰çˆ¶å­å…³ç³»ï¼Œé‚£ä¹ˆä»–ä»¬åŠ è½½çš„ç±»æ˜¯æ°¸è¿œä¹Ÿä¸èƒ½ç›¸äº’å¼•ç”¨åˆ°çš„ã€‚åŒæ ·ï¼Œå¦‚æœä¸¤ä¸ªClassLoaderï¼ŒAå’ŒBï¼Œæ²¡æœ‰çˆ¶å­å…³ç³»ã€‚Aé¦–å…ˆåŠ è½½äº†classCï¼ŒBä¸­çš„ç±»åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¹Ÿéœ€è¦ç”¨åˆ°classCï¼Œåˆ™ä¼šè§¦å‘Bçš„åŠ è½½æ“ä½œï¼ˆè™½ç„¶å†…å­˜ä¸­å·²ç»æœ‰äº†classCçš„Class&lt;?&gt;å¯¹è±¡ï¼‰ï¼Œè¿™æ—¶å†…å­˜ä¸­å°±ä¼šå­˜åœ¨ä¸¤ä¸ªclassCçš„Class&lt;?&gt;å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªå¹¶ä¸ç›¸ç­‰ï¼Œæ²¡æœ‰ä»»ä½•å…³ç³»ã€‚è¿™æ ·å°±ä¿è¯äº†Aä¸­çš„ç±»ç”¨åˆ°çš„classCéƒ½æ˜¯Aè‡ªå·±åŠ è½½çš„ï¼ŒBä¸­çš„ç±»ç”¨åˆ°çš„classCéƒ½æ˜¯BåŠ è½½çš„ï¼Œå½¼æ­¤å…±å­˜åˆä¸äº’ç›¸æ‰“æ‰°ã€‚</p><p>ä¾‹å¦‚ï¼š<br><img src="1.png" alt=""></p><p>å…¶ä¸­ï¼ŒPluginClassLoaderAæ˜¯æ’ä»¶æ›´æ–°å‰çš„classLoaderï¼ŒPluginClassLoaderBæ˜¯æ’ä»¶æ›´æ–°åçš„ClassLoaderã€‚åœ¨æ’ä»¶åœæ­¢ã€åˆ é™¤å¹¶æ›´æ–°åï¼Œè€ç‰ˆæœ¬çš„Classå¯¹è±¡ä¼šç”±è™šæ‹Ÿæœºåœ¨åˆé€‚çš„å®é™…å¤„ç†æ‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€å®šçš„æ—¶é—´ä¹‹å†…ï¼Œæ–°ç‰ˆæœ¬çš„Classå¯¹è±¡å’Œè€ç‰ˆæœ¬çš„Classå¯¹è±¡æ˜¯åœ¨å†…å­˜é‡Œé¢å…±å­˜çš„ã€‚</p><p>ClassLoaderçš„æŸ¥æ‰¾æœºåˆ¶ä¿è¯äº†æ–°è€æ’ä»¶çš„Classä¸ä¼šç›¸äº’å½±å“ã€‚æ¯”å¦‚åœ¨å‡çº§åï¼Œå³è¾¹çš„Class4è§¦å‘äº†com.fr.plugin.Açš„åŠ è½½ï¼Œè™šæ‹Ÿæœºé¦–å…ˆæ‹¿åˆ°Class4çš„ClassLoaderï¼Œå³PluginClassLoaderBï¼Œç„¶åç”¨PluginClassLoaderBå»åŠ è½½com.fr.plugin.Aï¼Œåœ¨æŸ¥æ‰¾åŠ è½½è¿‡ç¨‹ä¸­ï¼ŒPluginClassLoaderBé¦–å…ˆå§”æ‰˜parentï¼Œå³ParentClassLoaderå»æŸ¥æ‰¾ï¼Œæ²¡æœ‰æ‰¾åˆ°åˆ™è‡ªå·±ä»å³ä¸‹è§’çš„å››ä¸ªç±»é‡Œé¢å»æ‰¾ï¼Œæ‰¾åˆ°åˆ™è¿”å›ï¼Œä¸ä¼šè®¿é—®å·¦ä¸‹è§’çš„å››ä¸ªç±»ï¼Œä¿è¯äº†æ–°è€æ’ä»¶çš„éš”ç¦»ã€‚</p><h4 id="ClassLoaderçš„ç»“æ„"><a href="#ClassLoaderçš„ç»“æ„" class="headerlink" title="ClassLoaderçš„ç»“æ„"></a>ClassLoaderçš„ç»“æ„</h4><p>é™¤å»èµ„æºåŠ è½½çš„æ–¹æ³•å¤–ï¼ŒClassLoaderåªæœ‰ä¸€ä¸ªpublicçš„loadClassæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªClasså¯¹è±¡æˆ–æŠ›å‡ºClassNotFoundExceptionã€‚</p><p>//loadClassæ–¹æ³•ï¼ˆè¿™é‡Œç²¾ç®€äº†ä¸€ä¸‹ï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line"><span class="comment">//é¦–å…ˆæ£€æŸ¥å·²ç»æ˜¯å¦å·²ç»åŠ è½½è¿‡äº†</span></span><br><span class="line">    Class&lt;?&gt; c = findLoadedClass(name);  </span><br><span class="line">    <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åŒäº²å§”æ´¾</span></span><br><span class="line">            <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                c = parent.loadClass(name, <span class="keyword">false</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                c = findBootstrapClassOrNull(name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException ignore) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//è‡ªå·±æ²¡åŠ è½½è¿‡ï¼ŒåŒæ—¶parentä¹Ÿæ‰¾ä¸åˆ°çš„è¯</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">//å°è¯•æŸ¥æ‰¾å¯¹åº”å­—èŠ‚ç ï¼ŒåŠ è½½æ–°çš„Class</span></span><br><span class="line">            c = findClass(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ–¹æ³•æ˜¯åŒäº²å§”æ´¾æœºåˆ¶çš„å®ç°ï¼Œä¹Ÿæ˜¯sunè¯´çš„æœ€å¥½ä¸è¦é‡å†™loadClassæ–¹æ³•ï¼Œè¦é‡å†™å°±å†™findClassçš„åŸå› ï¼Œé‡å†™loadClasså¯èƒ½ä¼šæ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ã€‚</p><p>æœ‰äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå°±å¯ä»¥é€šè¿‡å®šä¹‰ä¸åŒClassLoaderä¹‹é—´çš„å…³ç³»ï¼Œæ¥åšåˆ°ä¸åŒæ’ä»¶ä¹‹é—´å…±äº«æŠ¥è¡¨çš„ç±»ï¼Œåˆéš”ç¦»ä¸åŒæ’ä»¶ä¹‹é—´çš„ç±»ã€‚</p><p>é»˜è®¤çš„findClassæ–¹æ³•æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç›¸å½“äºæ˜¯åªå®šä¹‰äº†æ¥å£ï¼Œæ²¡æœ‰å®ç°ã€‚æ¥å£çš„å«ä¹‰å°±æ˜¯ï¼šé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåï¼Œè¿”å›ä¸€ä¸ªClasså¯¹è±¡ã€‚åŒæ—¶ï¼ŒClassLoaderæä¾›äº†å‡ ä¸ªè¿”å›Classå¯¹è±¡çš„æ–¹æ³•å¯ä¾›è°ƒç”¨ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; defineClass(String name, <span class="keyword">byte</span>[] b, <span class="keyword">int</span> off, <span class="keyword">int</span> len) <span class="keyword">throws</span> ClassFormatError</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; defineClass(String name, <span class="keyword">byte</span>[] b, <span class="keyword">int</span> off, <span class="keyword">int</span> len,</span><br><span class="line">                                     ProtectionDomain protectionDomain) <span class="keyword">throws</span> ClassFormatError</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; defineClass(String name, java.nio.ByteBuffer, ProtectionDomain protectionDomain)</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸‰ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬ç”¨æ¥å®šä¹‰Classçš„ã€‚æœ‰äº†è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œ æˆ‘ä»¬é‡å†™findClassçš„ä»»åŠ¡å°±æ˜¯è·å–ç±»çš„å­—èŠ‚ç è€Œå·²ã€‚è¿™é‡Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªç”±å‘æŒ¥çš„åœ°æ–¹äº†ï¼Œå¯ä»¥ä»æ–‡ä»¶ä¸­è¯»ï¼Œå¯ä»¥ä»ç½‘ç»œä¸­è¯»ï¼Œè¿˜å¯ä»¥ä»åŠ å¯†çš„æ–‡ä»¶ä¸­è¯»ã€‚è¯»æ¥å­—èŠ‚ç ä¹‹åï¼Œè¿˜èƒ½å¯¹å­—èŠ‚ç è¿›è¡Œå¤„ç†ï¼ˆè§3ã€Javassistçš„ä½¿ç”¨ï¼‰åå†è°ƒç”¨defineClassã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä»è™šæ‹Ÿæœºåº•å±‚æœºåˆ¶è¯´èµ·ï¼Œç„¶ååˆ†æClassLoaderä»£ç ç»“æ„ä¸ç‰¹æ€§ï¼Œæœ€åè¯´æ˜ClassLoaderåœ¨9.0æ’ä»¶å¼•æ“ä¸­çš„åº”ç”¨ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="JVM" scheme="http://yoursite.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºç¼“å­˜ç­–ç•¥</title>
    <link href="http://yoursite.com/2018/05/19/cache/"/>
    <id>http://yoursite.com/2018/05/19/cache/</id>
    <published>2018-05-19T01:31:00.000Z</published>
    <updated>2019-07-05T09:50:04.147Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>ç¼“å­˜ä¸»è¦ç”¨äºè§£å†³é«˜å¹¶å‘ï¼Œå¤§æ•°æ®åœºæ™¯ä¸‹ï¼Œçƒ­ç‚¹æ•°æ®è®¿é—®çš„æ€§èƒ½é—®é¢˜ã€‚æä¾›é«˜æ€§èƒ½çš„æ•°æ®å¿«é€Ÿè®¿é—®ã€‚</p><p>ç¼“å­˜çš„è¿‡æœŸç­–ç•¥ä¸»è¦æœ‰FIFOã€LFUã€LRUä¸‰ç§ã€‚<br><a id="more"></a></p><ul><li><p>FIFO</p><p> æŒ‰ç…§â€œå…ˆè¿›å…ˆå‡ºï¼ˆFirst Inï¼ŒFirst Outï¼‰â€çš„åŸç†æ·˜æ±°æ•°æ®ï¼Œæ­£å¥½ç¬¦åˆé˜Ÿåˆ—çš„ç‰¹æ€§ï¼Œæ•°æ®ç»“æ„ä¸Šä½¿ç”¨é˜Ÿåˆ—Queueæ¥å®ç°ã€‚</p><ol><li><p>æ–°è®¿é—®çš„æ•°æ®æ’å…¥FIFOé˜Ÿåˆ—å°¾éƒ¨ï¼Œæ•°æ®åœ¨FIFOé˜Ÿåˆ—ä¸­é¡ºåºç§»åŠ¨ï¼›</p></li><li><p>æ·˜æ±°FIFOé˜Ÿåˆ—å¤´éƒ¨çš„æ•°æ®ï¼›</p></li></ol></li></ul><ul><li><p>LRU</p><p>  ï¼ˆLeast recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•æ ¹æ®æ•°æ®çš„å†å²è®¿é—®è®°å½•æ¥è¿›è¡Œæ·˜æ±°æ•°æ®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜â€ã€‚<br>  æœ€å¸¸è§çš„å®ç°æ˜¯ä½¿ç”¨ä¸€ä¸ªé“¾è¡¨ä¿å­˜ç¼“å­˜æ•°æ®ï¼Œè¯¦ç»†ç®—æ³•å®ç°å¦‚ä¸‹ï¼š</p><ol><li><p>æ–°æ•°æ®æ’å…¥åˆ°é“¾è¡¨å¤´éƒ¨ï¼›</p></li><li><p>æ¯å½“ç¼“å­˜å‘½ä¸­ï¼ˆå³ç¼“å­˜æ•°æ®è¢«è®¿é—®ï¼‰ï¼Œåˆ™å°†æ•°æ®ç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼›</p></li><li><p>å½“é“¾è¡¨æ»¡çš„æ—¶å€™ï¼Œå°†é“¾è¡¨å°¾éƒ¨çš„æ•°æ®ä¸¢å¼ƒã€‚</p></li></ol></li><li><p>LFU</p><p>  ï¼ˆLeast Frequently Usedï¼‰ç®—æ³•æ ¹æ®æ•°æ®çš„å†å²è®¿é—®é¢‘ç‡æ¥æ·˜æ±°æ•°æ®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®è¿‡å»è¢«è®¿é—®å¤šæ¬¡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„é¢‘ç‡ä¹Ÿæ›´é«˜â€ã€‚</p><p>  LFUçš„æ¯ä¸ªæ•°æ®å—éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œæ‰€æœ‰æ•°æ®å—æŒ‰ç…§å¼•ç”¨è®¡æ•°æ’åºï¼Œå…·æœ‰ç›¸åŒå¼•ç”¨è®¡æ•°çš„æ•°æ®å—åˆ™æŒ‰ç…§æ—¶é—´æ’åºã€‚</p></li></ul><h2 id="Caffine"><a href="#Caffine" class="headerlink" title="Caffine"></a>Caffine</h2><h2 id="é©±é€ç­–ç•¥"><a href="#é©±é€ç­–ç•¥" class="headerlink" title="é©±é€ç­–ç•¥"></a>é©±é€ç­–ç•¥</h2><p>ç¼“å­˜çš„é©±é€ç­–ç•¥æ˜¯ä¸ºäº†é¢„æµ‹å“ªäº›æ•°æ®åœ¨çŸ­æœŸå†…æœ€å¯èƒ½è¢«å†æ¬¡ç”¨åˆ°ï¼Œä»è€Œæå‡ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚ç”±äºç®€æ´çš„å®ç°ã€é«˜æ•ˆçš„è¿è¡Œæ—¶è¡¨ç°ä»¥åŠåœ¨å¸¸è§„çš„ä½¿ç”¨åœºæ™¯ä¸‹æœ‰ä¸é”™çš„å‘½ä¸­ç‡ï¼ŒLRUç­–ç•¥æˆ–è®¸æ˜¯æœ€æµè¡Œçš„é©±é€ç­–ç•¥ã€‚ä½†LRUé€šè¿‡å†å²æ•°æ®æ¥é¢„æµ‹æœªæ¥æ˜¯å±€é™çš„ï¼Œå®ƒä¼šè®¤ä¸ºæœ€ååˆ°æ¥çš„æ•°æ®æ˜¯æœ€å¯èƒ½è¢«å†æ¬¡è®¿é—®çš„ï¼Œä»è€Œç»™ä¸å®ƒæœ€é«˜çš„ä¼˜å…ˆçº§ã€‚<br>ç°ä»£ç¼“å­˜æ‰©å±•äº†å¯¹å†å²æ•°æ®çš„ä½¿ç”¨ï¼Œç»“åˆå°±è¿‘ç¨‹åº¦ï¼ˆrecencyï¼‰å’Œè®¿é—®é¢‘æ¬¡ï¼ˆfrequencyï¼‰æ¥æ›´å¥½çš„é¢„æµ‹æ•°æ®ã€‚å…¶ä¸­ä¸€ç§ä¿ç•™å†å²ä¿¡æ¯çš„æ–¹å¼æ˜¯ä½¿ç”¨popularity sketchï¼ˆä¸€ç§å‹ç¼©ã€æ¦‚ç‡æ€§çš„æ•°æ®ç»“æ„ï¼‰æ¥ä»ä¸€å¤§å †è®¿é—®äº‹ä»¶ä¸­å®šä½é¢‘ç¹çš„è®¿é—®è€…ã€‚å¯ä»¥å‚è€ƒCountMin Sketchç®—æ³•ï¼Œå®ƒç”±è®¡æ•°çŸ©é˜µå’Œå¤šä¸ªå“ˆå¸Œæ–¹æ³•å®ç°ã€‚å‘ç”Ÿä¸€æ¬¡è¯»å–æ—¶ï¼ŒçŸ©é˜µä¸­æ¯è¡Œå¯¹åº”çš„è®¡æ•°å™¨å¢åŠ è®¡æ•°ï¼Œä¼°ç®—é¢‘ç‡æ—¶ï¼Œå–æ•°æ®å¯¹åº”æ˜¯æ‰€æœ‰è¡Œä¸­è®¡æ•°çš„æœ€å°å€¼ã€‚è¿™ä¸ªæ–¹æ³•è®©æˆ‘ä»¬ä»ç©ºé—´ã€æ•ˆç‡ã€ä»¥åŠé€‚é…çŸ©é˜µçš„é•¿å®½å¼•èµ·çš„å“ˆå¸Œç¢°æ’çš„é”™è¯¯ç‡ä¸Šåšæƒè¡¡ã€‚</p><ul><li><p>CountMin Sketch</p><p> Window TinyLFUï¼ˆW-TinyLFUï¼‰ç®—æ³•å°†sketchä½œä¸ºè¿‡æ»¤å™¨ï¼Œå½“æ–°æ¥çš„æ•°æ®æ¯”è¦é©±é€çš„æ•°æ®é«˜é¢‘æ—¶ï¼Œè¿™ä¸ªæ•°æ®æ‰ä¼šè¢«ç¼“å­˜æ¥çº³ã€‚è¿™ä¸ªè®¸å¯çª—å£ç»™äºˆæ¯ä¸ªæ•°æ®é¡¹ç§¯ç´¯çƒ­åº¦çš„æœºä¼šï¼Œè€Œä¸æ˜¯ç«‹å³è¿‡æ»¤æ‰ã€‚è¿™é¿å…äº†æŒç»­çš„æœªå‘½ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨çªç„¶æµé‡æš´æ¶¨çš„çš„åœºæ™¯ä¸­ï¼Œä¸€äº›çŸ­æš‚çš„é‡å¤æµé‡å°±ä¸ä¼šè¢«é•¿æœŸä¿ç•™ã€‚ä¸ºäº†åˆ·æ–°å†å²æ•°æ®ï¼Œä¸€ä¸ªæ—¶é—´è¡°å‡è¿›ç¨‹è¢«å‘¨æœŸæ€§æˆ–å¢é‡çš„æ‰§è¡Œï¼Œç»™æ‰€æœ‰è®¡æ•°å™¨å‡åŠã€‚</p></li></ul><ul><li><p>Window TinyLFU</p><p>å¯¹äºé•¿æœŸä¿ç•™çš„æ•°æ®ï¼ŒW-TinyLFUä½¿ç”¨äº†åˆ†æ®µLRUï¼ˆSegmented LRUï¼Œç¼©å†™SLRUï¼‰ç­–ç•¥ã€‚èµ·åˆï¼Œä¸€ä¸ªæ•°æ®é¡¹å­˜å‚¨è¢«å­˜å‚¨åœ¨è¯•ç”¨æ®µï¼ˆprobationary segmentï¼‰ä¸­ï¼Œåœ¨åç»­è¢«è®¿é—®åˆ°æ—¶ï¼Œå®ƒä¼šè¢«æå‡åˆ°ä¿æŠ¤æ®µï¼ˆprotected segmentï¼‰ä¸­ã€‚ä¿æŠ¤æ®µæ»¡åï¼Œæœ‰çš„æ•°æ®ä¼šè¢«æ·˜æ±°å›è¯•ç”¨æ®µï¼Œè¿™ä¹Ÿå¯èƒ½çº§è”çš„è§¦å‘è¯•ç”¨æ®µçš„æ·˜æ±°ã€‚è¿™å¥—æœºåˆ¶ç¡®ä¿äº†è®¿é—®é—´éš”å°çš„çƒ­æ•°æ®è¢«ä¿å­˜ä¸‹æ¥ï¼Œè€Œè¢«é‡å¤è®¿é—®å°‘çš„å†·æ•°æ®åˆ™è¢«å›æ”¶ã€‚</p></li></ul><h2 id="è¿‡æœŸç­–ç•¥"><a href="#è¿‡æœŸç­–ç•¥" class="headerlink" title="è¿‡æœŸç­–ç•¥"></a>è¿‡æœŸç­–ç•¥</h2><p>è¿‡æœŸçš„å®ç°é‡Œï¼Œå¾€å¾€æ¯ä¸ªæ•°æ®é¡¹æ‹¥æœ‰ä¸åŒçš„è¿‡æœŸæ—¶é—´ã€‚å› ä¸ºå®¹é‡çš„é™åˆ¶ï¼Œè¿‡æœŸåæ•°æ®éœ€è¦è¢«æ‡’æ·˜æ±°ï¼Œå¦åˆ™è¿™äº›å·²è¿‡æœŸçš„è„æ•°æ®ä¼šæ±¡æŸ“åˆ°æ•´ä¸ªç¼“å­˜ã€‚ä¸€èˆ¬ç¼“å­˜ä¸­ä¼šå¯ç”¨ä¸“æœ‰çš„æ¸…æ‰«çº¿ç¨‹å‘¨æœŸæ€§çš„éå†æ¸…ç†ç¼“å­˜ã€‚è¿™ä¸ªç­–ç•¥ç›¸æ¯”åœ¨æ¯æ¬¡è¯»å†™æ“ä½œæ—¶æŒ‰ç…§è¿‡æœŸæ—¶é—´æ’åºçš„ä¼˜å…ˆé˜Ÿåˆ—æ¥æ¸…ç†è¿‡æœŸç¼“å­˜è¦å¥½ï¼Œå› ä¸ºåå°çº¿ç¨‹éšè—äº†çš„è¿‡æœŸæ•°æ®æ¸…é™¤çš„æ—¶é—´å¼€é”€ã€‚<br>é‰´äºå¤§å¤šæ•°åœºæ™¯é‡Œä¸åŒæ•°æ®é¡¹ä½¿ç”¨çš„éƒ½æ˜¯å›ºå®šçš„è¿‡æœŸæ—¶é•¿ï¼ŒCaffiené‡‡ç”¨äº†ç»Ÿä¸€è¿‡æœŸæ—¶é—´çš„æ–¹å¼ã€‚è¿™ä¸ªé™åˆ¶è®©ç”¨Oï¼ˆ1ï¼‰çš„æœ‰åºé˜Ÿåˆ—ç»„ç»‡æ•°æ®æˆä¸ºå¯èƒ½ã€‚é’ˆå¯¹æ•°æ®çš„å†™åè¿‡æœŸï¼Œç»´æŠ¤äº†ä¸€ä¸ªå†™å…¥é¡ºåºé˜Ÿåˆ—ï¼Œé’ˆå¯¹è¯»åè¿‡æœŸï¼Œç»´æŠ¤äº†ä¸€ä¸ªè¯»å–é¡ºåºé˜Ÿåˆ—ã€‚ç¼“å­˜èƒ½å¤ç”¨é©±é€ç­–ç•¥ä¸‹çš„é˜Ÿåˆ—ä»¥åŠä¸‹é¢å°†è¦ä»‹ç»çš„å¹¶å‘æœºåˆ¶ï¼Œè®©è¿‡æœŸçš„æ•°æ®é¡¹åœ¨ç¼“å­˜çš„ç»´æŠ¤é˜¶æ®µè¢«æŠ›å¼ƒæ‰ã€‚</p><h2 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h2><p>ç”±äºåœ¨å¤§å¤šæ•°çš„ç¼“å­˜ç­–ç•¥ä¸­ï¼Œæ•°æ®çš„è¯»å–éƒ½ä¼šä¼´éšå¯¹ç¼“å­˜çŠ¶æ€çš„å†™æ“ä½œï¼Œå¹¶å‘çš„ç¼“å­˜è¯»å–è¢«è§†ä¸ºä¸€ä¸ªéš¾ç‚¹é—®é¢˜ã€‚ä¼ ç»Ÿçš„è§£å†³æ–¹å¼æ˜¯ç”¨åŒæ­¥é”ã€‚è¿™å¯ä»¥é€šè¿‡å°†ç¼“å­˜çš„æ•°æ®åˆ’æˆå¤šä¸ªåˆ†åŒºæ¥è¿›è¡Œé”æ‹†åˆ†ä¼˜åŒ–ã€‚ä¸å¹¸çš„æ˜¯çƒ­ç‚¹æ•°æ®æ‰€æŒæœ‰çš„é”ä¼šæ¯”å…¶ä»–æ•°æ®æ›´å¸¸çš„è¢«å æœ‰ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹é”æ‹†åˆ†çš„æ€§èƒ½æå‡ä¹Ÿå°±æ²¡é‚£ä¹ˆå¥½äº†ã€‚å½“å•ä¸ªé”çš„ç«äº‰æˆä¸ºç“¶é¢ˆåï¼Œæ¥ä¸‹æ¥çš„ç»å…¸çš„ä¼˜åŒ–æ–¹å¼æ˜¯åªæ›´æ–°å•ä¸ªæ•°æ®çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä»¥åŠä½¿ç”¨éšæœºé‡‡æ ·ã€åŸºäºFIFOçš„é©±é€ç­–ç•¥æ¥å‡å°‘æ•°æ®æ“ä½œã€‚è¿™äº›ç­–ç•¥ä¼šå¸¦æ¥é«˜æ€§èƒ½çš„è¯»å’Œä½æ€§èƒ½çš„å†™ï¼ŒåŒæ—¶åœ¨é€‰æ‹©é©±é€å¯¹è±¡æ—¶ä¹Ÿæ¯”è¾ƒå›°éš¾ã€‚<br>å¦ä¸€ç§å¯è¡Œæ–¹æ¡ˆæ¥è‡ªäºæ•°æ®åº“ç†è®ºï¼Œé€šè¿‡æäº¤æ—¥å¿—çš„æ–¹å¼æ¥æ‰©å±•å†™çš„æ€§èƒ½ã€‚å†™å…¥æ“ä½œå…ˆè®°å…¥æ—¥å¿—ä¸­ï¼Œéšåå¼‚æ­¥çš„æ‰¹é‡æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç«‹å³å†™å…¥åˆ°æ•°æ®ç»“æ„ä¸­ã€‚è¿™ç§æ€æƒ³å¯ä»¥åº”ç”¨åˆ°ç¼“å­˜ä¸­ï¼Œæ‰§è¡Œå“ˆå¸Œè¡¨çš„æ“ä½œï¼Œå°†æ“ä½œè®°å½•åˆ°ç¼“å†²åŒºï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œç¼“å†²åŒºä¸­çš„å†…å®¹ã€‚è¿™ä¸ªç­–ç•¥ä¾ç„¶éœ€è¦åŒæ­¥é”æˆ–è€…tryLockï¼Œä¸åŒçš„æ˜¯æŠŠå¯¹é”çš„ç«äº‰è½¬ç§»åˆ°å¯¹ç¼“å†²åŒºçš„è¿½åŠ å†™ä¸Šã€‚<br>åœ¨Caffeineä¸­ï¼Œæœ‰ä¸€ç»„ç¼“å†²åŒºè¢«ç”¨æ¥è®°å½•è¯»å†™ã€‚ä¸€æ¬¡è®¿é—®é¦–å…ˆä¼šè¢«å› çº¿ç¨‹è€Œå¼‚çš„å“ˆå¸Œåˆ°stripped ring bufferä¸Šï¼Œå½“æ£€æµ‹åˆ°ç«äº‰æ—¶ï¼Œç¼“å†²åŒºä¼šè‡ªåŠ¨æ‰©å®¹ã€‚ä¸€ä¸ªring bufferå®¹é‡æ»¡è½½åï¼Œä¼šè§¦å‘å¼‚æ­¥çš„æ‰§è¡Œæ“ä½œï¼Œè€Œåç»­çš„å¯¹è¯¥ring bufferçš„å†™å…¥ä¼šè¢«ä¸¢å¼ƒï¼Œç›´åˆ°è¿™ä¸ªring bufferå¯è¢«ä½¿ç”¨ã€‚è™½ç„¶å› ä¸ºring bufferå®¹é‡æ»¡è€Œæ— æ³•è¢«è®°å½•è¯¥è®¿é—®ï¼Œä½†ç¼“å­˜å€¼ä¾ç„¶ä¼šè¿”å›ç»™è°ƒç”¨æ–¹ã€‚è¿™ç§ç­–ç•¥ä¿¡æ¯çš„ä¸¢å¤±ä¸ä¼šå¸¦æ¥å¤§çš„å½±å“ï¼Œå› ä¸ºW-TinyLFUèƒ½è¯†åˆ«å‡ºæˆ‘ä»¬å¸Œæœ›ä¿å­˜çš„çƒ­ç‚¹æ•°æ®ã€‚é€šè¿‡ä½¿ç”¨å› çº¿ç¨‹è€Œå¼‚çš„å“ˆå¸Œç®—æ³•æ›¿ä»£åœ¨æ•°æ®é¡¹çš„é”®ä¸Šåšå“ˆå¸Œï¼Œç¼“å­˜é¿å…äº†ç¬æ—¶çš„çƒ­ç‚¹keyçš„ç«äº‰é—®é¢˜ã€‚<br>å†™æ•°æ®æ—¶ï¼Œé‡‡ç”¨æ›´ä¼ ç»Ÿçš„å¹¶å‘é˜Ÿåˆ—ï¼Œæ¯æ¬¡å˜æ›´ä¼šå¼•èµ·ä¸€æ¬¡ç«‹å³çš„æ‰§è¡Œã€‚è™½ç„¶æ•°æ®çš„æŸå¤±æ˜¯ä¸å¯æ¥å—çš„ï¼Œä½†æˆ‘ä»¬ä»ç„¶æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥æ¥ä¼˜åŒ–å†™ç¼“å†²åŒºã€‚æ‰€æœ‰ç±»å‹çš„ç¼“å†²åŒºéƒ½è¢«å¤šä¸ªçš„çº¿ç¨‹å†™å…¥ï¼Œä½†å´é€šè¿‡å•ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚è¿™ç§å¤šç”Ÿäº§è€…/å•ä¸ªæ¶ˆè´¹è€…çš„æ¨¡å¼å…è®¸äº†æ›´ç®€å•ã€é«˜æ•ˆçš„ç®—æ³•æ¥å®ç°ã€‚<br>ç¼“å†²åŒºå’Œç»†ç²’åº¦çš„å†™å¸¦æ¥äº†å•ä¸ªæ•°æ®é¡¹çš„æ“ä½œä¹±åºçš„ç«æ€æ¡ä»¶ã€‚æ’å…¥ã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤éƒ½å¯èƒ½è¢«å„ç§é¡ºåºçš„é‡æ”¾ï¼Œå¦‚æœè¿™ä¸ªç­–ç•¥æ§åˆ¶çš„ä¸åˆé€‚ï¼Œåˆ™å¯èƒ½å¼•èµ·æ‚¬å‚ç´¢å¼•ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡çŠ¶æ€æœºæ¥å®šä¹‰å•ä¸ªæ•°æ®é¡¹çš„ç”Ÿå‘½å‘¨æœŸã€‚<br>åœ¨åŸºå‡†æµ‹è¯•ä¸­ï¼Œç¼“å†²åŒºéšç€å“ˆå¸Œè¡¨çš„å¢é•¿è€Œå¢é•¿ï¼Œå®ƒçš„çš„ä½¿ç”¨ç›¸å¯¹æ›´èŠ‚çœèµ„æºã€‚è¯»çš„æ€§èƒ½éšç€CPUçš„æ ¸æ•°çº¿æ€§å¢é•¿ï¼Œæ˜¯å“ˆå¸Œè¡¨ååé‡çš„33%ã€‚å†™å…¥æœ‰10%çš„æ€§èƒ½æŸè€—ï¼Œè¿™æ˜¯å› ä¸ºæ›´æ–°å“ˆå¸Œè¡¨æ—¶çš„ç«äº‰æ˜¯æœ€ä¸»è¦çš„å¼€é”€ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç¼“å­˜&quot;&gt;&lt;a href=&quot;#ç¼“å­˜&quot; class=&quot;headerlink&quot; title=&quot;ç¼“å­˜&quot;&gt;&lt;/a&gt;ç¼“å­˜&lt;/h2&gt;&lt;p&gt;ç¼“å­˜ä¸»è¦ç”¨äºè§£å†³é«˜å¹¶å‘ï¼Œå¤§æ•°æ®åœºæ™¯ä¸‹ï¼Œçƒ­ç‚¹æ•°æ®è®¿é—®çš„æ€§èƒ½é—®é¢˜ã€‚æä¾›é«˜æ€§èƒ½çš„æ•°æ®å¿«é€Ÿè®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;ç¼“å­˜çš„è¿‡æœŸç­–ç•¥ä¸»è¦æœ‰FIFOã€LFUã€LRUä¸‰ç§ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="java" scheme="http://yoursite.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>ThreadDumpåˆ†æå°ç»“</title>
    <link href="http://yoursite.com/2016/09/08/ThreadDump%E5%88%86%E6%9E%90%E5%B0%8F%E7%BB%93/"/>
    <id>http://yoursite.com/2016/09/08/ThreadDumpåˆ†æå°ç»“/</id>
    <published>2016-09-08T08:13:45.000Z</published>
    <updated>2019-07-05T08:43:39.006Z</updated>
    
    <content type="html"><![CDATA[<p>ThreadDumpä¸­åŒ…å«äº†çº¿ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¸€èˆ¬æœ‰ Runnableï¼ŒBLOCKEDï¼ŒWaitå‡ ç§çŠ¶æ€ã€‚Waitä¸€èˆ¬éƒ½æ˜¯çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹ï¼Œå¯ä»¥è·³è¿‡ï¼Œä¸»è¦å…³æ³¨ç‚¹åº”è¯¥æ”¾åœ¨Runnableå’ŒBLOCKEDè¿™ä¸¤ç§çŠ¶æ€ã€‚<a id="more"></a></p><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®å½“å‰æœåŠ¡å™¨çŠ¶æ€æ¥çœ‹çº¿ç¨‹ä¿¡æ¯ã€‚</p><p>ä¸€.æ¯”å¦‚ç°åœ¨æœåŠ¡å™¨cpuå¾ˆä½ï¼Œå†…å­˜å ç”¨ä¹Ÿå¾ˆä½ï¼Œä½†æ˜¯å¡ï¼ŒåŸå› åŸºæœ¬ä¸Šæœ‰ä¸¤ä¸ª</p><p>1.çº¿ç¨‹é˜»å¡äº†ï¼Œä¸‹å›¾çœ‹å‡ºæ¥ï¼ŒæŠ¥è¡¨åœ¨å…³é—­çš„æ—¶å€™ï¼Œéœ€è¦ç­‰å¾…åŸæ¥æŠ¥è¡¨è®¡ç®—å®Œæˆï¼ˆè¿™ä¸ªåŸºæœ¬ä¸Šæ˜¯æŠ¥è¡¨è®¡ç®—æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå¤§éƒ¨åˆ†å¯èƒ½æ˜¯sqlå–æ•°æ—¶é—´å¾ˆé•¿ï¼‰ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸€ç›´åœ¨ç­‰ï¼Œæ‰€ä»¥cpuå ç”¨ç‡ä½ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">"pool-56-thread-10" #669 prio=5 os_prio=0 tid=0x00007fa7f4005800 nid=0x3ab2c waiting for monitor entry [0x00007fa65545a000]</span><br><span class="line">java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">at com.fr.web.core.ReportSessionIDInfor.clearPageSet(Unknown Source)</span><br><span class="line">- waiting to lock &lt;<span class="number">0x00007fae6cd4cf10</span>&gt; (a com.fr.web.core.ReportSessionIDInfor)</span><br><span class="line">at com.fr.web.core.TemplateSessionIDInfo.release(Unknown Source)</span><br><span class="line">at com.fr.web.core.ReportSessionIDInfor.release(Unknown Source)</span><br><span class="line">at com.fr.web.core.SessionPoolManager.processCloseSession(Unknown Source)</span><br><span class="line">at com.fr.web.core.SessionPoolManager.access$<span class="number">200</span>(Unknown Source)</span><br><span class="line">at com.fr.web.core.SessionPoolManager$<span class="number">5</span>.run(Unknown Source)</span><br><span class="line">at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:<span class="number">511</span>)</span><br><span class="line">at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">266</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.æŠ¥è¡¨è®¡ç®—sqlå–æ•°çº¿ç¨‹ç­‰å¾…æ•°æ®åº“è¿”å›æ•°æ®ï¼Œçº¿ç¨‹æ²¡äº‹åšï¼Œcpuåˆ©ç”¨ç‡å¾ˆä½ã€‚è¿™ä¸ªçº¿ç¨‹çŠ¶æ€æ˜¯Runnableçš„ï¼Œä»socketç¼“å­˜åŒºè¯»å–æ•°æ®ã€‚ä¸»è¦çš„ç‰¹å¾å°±æ˜¯ä¾èµ–äº†å¤–éƒ¨api DruidPooledStatement.executeQueryï¼Œå¦‚æœè¿™ç§çº¿ç¨‹æ¯”è¾ƒå¤šï¼Œå°±æ˜¯å–æ•°å¤ªæ…¢äº†ã€‚</span><br><span class="line"></span><br><span class="line">"pool-43-thread-1893" #4977 prio=5 os_prio=0 tid=0x00007f624950e000 nid=0x130b7 runnable [0x00007f6150bd3000]</span><br><span class="line">java.lang.Thread.State: RUNNABLE</span><br><span class="line">at java.net.SocketInputStream.socketRead0(Native Method)</span><br><span class="line">at java.net.SocketInputStream.socketRead(SocketInputStream.java:<span class="number">116</span>)</span><br><span class="line">at java.net.SocketInputStream.read(SocketInputStream.java:<span class="number">171</span>)</span><br><span class="line">at java.net.SocketInputStream.read(SocketInputStream.java:<span class="number">141</span>)</span><br><span class="line">at com.sap.db.rte.comm.BasicSocketComm.receiveData(BasicSocketComm.java:<span class="number">494</span>)</span><br><span class="line">at com.sap.db.rte.comm.BasicSocketComm.receive(BasicSocketComm.java:<span class="number">582</span>)</span><br><span class="line">at com.sap.db.rte.comm.JdbcCommunication.execute(JdbcCommunication.java:<span class="number">116</span>)</span><br><span class="line">at com.sap.db.jdbc.ConnectionSapDB.execute(ConnectionSapDB.java:<span class="number">867</span>)</span><br><span class="line">at com.sap.db.jdbc.ConnectionSapDB.execute(ConnectionSapDB.java:<span class="number">820</span>)</span><br><span class="line">at com.sap.db.jdbc.StatementSapDB.sendCommand(StatementSapDB.java:<span class="number">898</span>)</span><br><span class="line">at com.sap.db.jdbc.StatementSapDB.sendSQL(StatementSapDB.java:<span class="number">947</span>)</span><br><span class="line">at com.sap.db.jdbc.StatementSapDB.execute(StatementSapDB.java:<span class="number">256</span>)</span><br><span class="line">at com.sap.db.jdbc.StatementSapDB.executeQuery(StatementSapDB.java:<span class="number">399</span>)</span><br><span class="line">at com.sap.db.jdbc.trace.Statement.executeQuery(Statement.java:<span class="number">184</span>)</span><br><span class="line">at com.fr.third.alibaba.druid.pool.DruidPooledStatement.executeQuery(DruidPooledStatement.java:<span class="number">140</span>)</span><br><span class="line">at com.fr.data.core.db.dialect.base.key.create.executequery.DialectExecuteQueryKey.execute(Unknown Source)</span><br><span class="line">at com.fr.data.core.db.dialect.base.key.create.executequery.DialectExecuteQueryKey.execute(Unknown Source)</span><br><span class="line">at com.fr.data.core.db.dialect.AbstractDialect.execute(Unknown Source)</span><br><span class="line">at com.fr.data.core.db.dialect.DefaultDialect.executeQuery(Unknown Source)</span><br><span class="line">at com.fr.data.impl.AbstractDBDataModel$<span class="number">1</span>.call(Unknown Source)</span><br><span class="line">at com.fr.data.impl.AbstractDBDataModel$<span class="number">1</span>.call(Unknown Source)</span><br><span class="line">at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">266</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1142</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">617</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">745</span>)</span><br></pre></td></tr></table></figure></p><p>äºŒ.æ¯”å¦‚ç°åœ¨cpuå¾ˆé«˜ï¼Œå¯¼è‡´å¾ˆå¡ï¼Œæˆ‘ä»¬å°±éœ€è¦å…³æ³¨ä¸€ä¸‹ï¼ŒRunnableçŠ¶æ€çš„çº¿ç¨‹ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è¯»å–æ¨¡æ¿çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¸€ç›´åœ¨runnableã€‚é‚£ä¹ˆè¿™ä¸ªRunnableå’Œä¸Šé¢ä¸€ä¸ªæ•°æ®åº“Runnableæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Œä¸»è¦åŒºåˆ«å°±æ˜¯è¿™ä¸ªæ˜¯ä¸æ¶‰åŠIOæ“ä½œï¼ˆæ•°æ®åº“è®¿é—®å’Œredisè®¿é—®éƒ½å¯ä»¥è®¤ä¸ºæ˜¯IOæ“ä½œï¼ŒIOæ“ä½œä¼šå¯¼è‡´cpuç©ºé—²ï¼‰ã€‚</p><p>è¯¥çº¿ç¨‹ä¸€ç›´åœ¨scanAttributeValueï¼Œcpuå æ»¡ï¼Œå¡é¡¿ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">"Timer-7" #109 daemon prio=5 os_prio=0 tid=0x00007f8d7cba1000 nid=0x13b4 runnable [0x00007f8d400ef000]</span><br><span class="line">java.lang.Thread.State: RUNNABLE</span><br><span class="line">at com.fr.third.javax.xml.stream.XMLScanner.scanAttributeValue(XMLScanner.java:<span class="number">548</span>)</span><br><span class="line">at com.fr.third.javax.xml.stream.XMLNSDocumentScannerImpl.scanAttribute(XMLNSDocumentScannerImpl.java:<span class="number">499</span>)</span><br><span class="line">at com.fr.third.javax.xml.stream.XMLNSDocumentScannerImpl.scanStartElement(XMLNSDocumentScannerImpl.java:<span class="number">298</span>)</span><br><span class="line">at com.fr.third.javax.xml.stream.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:<span class="number">1121</span>)</span><br><span class="line">at com.fr.third.javax.xml.stream.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:<span class="number">133</span>)</span><br><span class="line">at com.fr.third.javax.xml.stream.XMLReaderImpl.next(XMLReaderImpl.java:<span class="number">358</span>)</span><br><span class="line">at com.fr.third.javax.xml.stream.XMLEventReaderImpl.nextEvent(XMLEventReaderImpl.java:<span class="number">56</span>)</span><br><span class="line">at com.fr.stable.xml.XMLableReader.readXMLObject(Unknown Source)</span><br><span class="line">at com.fr.data.impl.CustomDictionary.readXML(Unknown Source)</span><br><span class="line">at com.fr.stable.xml.XMLableReader.readXMLObject(Unknown Source)</span><br><span class="line">at com.fr.data.core.TableDataXmlUtils.readXMLDictionary(Unknown Source)</span><br><span class="line">at com.fr.data.core.DataCoreXmlUtils.readXMLDictionary(Unknown Source)</span><br><span class="line">at com.fr.base.present.DictPresent.readXML(Unknown Source)</span><br><span class="line">at com.fr.stable.xml.XMLableReader.readXMLObject(Unknown Source)</span><br><span class="line">at com.fr.xml.ReportXMLUtils.readPresent(Unknown Source)</span><br><span class="line">at com.fr.report.cell.AbstractDynamicCellElement.readXML(Unknown Source)</span><br><span class="line">at com.fr.report.cell.AbstractInsertCellElement.readXML(Unknown Source)</span><br><span class="line">at com.fr.report.cell.AbstractExpandCellElement.readXML(Unknown Source)</span><br><span class="line">at com.fr.report.cell.DefaultTemplateCellElement.readXML(Unknown Source)</span><br><span class="line">at com.fr.stable.xml.XMLableReader.readXMLObject(Unknown Source)</span><br><span class="line">at com.fr.report.elementcase.AbstractElementCase$<span class="number">1</span>.readXML(Unknown Source)</span><br><span class="line">at com.fr.stable.xml.XMLableReader.readXMLObject(Unknown Source)</span><br><span class="line">at com.fr.report.elementcase.AbstractElementCase.readXML(Unknown Source)</span><br><span class="line">at com.fr.report.report.AbstractECReport.readXML(Unknown Source)</span><br><span class="line">at com.fr.report.worksheet.WorkSheet.readXML(Unknown Source)</span><br><span class="line">at com.fr.stable.xml.XMLableReader.readXMLObject(Unknown Source)</span><br><span class="line">at com.fr.main.AbstractFineBook.readReportXML(Unknown Source)</span><br><span class="line">at com.fr.main.AbstractFineBook.readXML(Unknown Source)</span><br><span class="line">at com.fr.main.AbstractTemplateWorkBook.readXML(Unknown Source)</span><br><span class="line">at com.fr.stable.xml.XMLableReader.readXMLObject(Unknown Source)</span><br><span class="line">at com.fr.main.impl.WorkBook.readStream(Unknown Source)</span><br><span class="line">at com.fr.main.impl.WorkBook.readStream(Unknown Source)</span><br><span class="line">at com.fr.io.TemplateWorkBookIO.readTemplateWorkBook(Unknown Source)</span><br><span class="line">at com.fr.io.TemplateWorkBookIO.readTemplateWorkBook(Unknown Source)</span><br><span class="line">at com.fr.fs.web.service.favoriteparams.FavoriteParamsJob.readTempalteId(Unknown Source)</span><br><span class="line">at com.fr.fs.web.service.favoriteparams.FavoriteParamsJob.getAllFileTemplateId(Unknown Source)</span><br><span class="line">at com.fr.fs.web.service.favoriteparams.FavoriteParamsJob.getAllFileTemplateId(Unknown Source)</span><br><span class="line">at com.fr.fs.web.service.favoriteparams.FavoriteParamsJob.clearDatabaseData(Unknown Source)</span><br><span class="line">at com.fr.fs.web.service.favoriteparams.FavoriteParamsJob.access$<span class="number">200</span>(Unknown Source)</span><br><span class="line">at com.fr.fs.web.service.favoriteparams.FavoriteParamsJob$<span class="number">2</span>.run(Unknown Source)</span><br><span class="line">at java.util.TimerThread.mainLoop(Timer.java:<span class="number">555</span>)</span><br><span class="line">at java.util.TimerThread.run(Timer.java:<span class="number">505</span>)</span><br></pre></td></tr></table></figure></p><p>ä¸‰.æœ‰ä¸€äº›RunnableçŠ¶æ€çš„çº¿ç¨‹å¯ä»¥å¿½ç•¥<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">"http-nio-10030-ClientPoller-0" #122 daemon prio=5 os_prio=0 tid=0x00007f8de038b800 nid=0x13c1 runnable [0x00007f8d3f8e9000]</span><br><span class="line">java.lang.Thread.State: RUNNABLE</span><br><span class="line">at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)</span><br><span class="line">at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:<span class="number">269</span>)</span><br><span class="line">at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:<span class="number">93</span>)</span><br><span class="line">at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:<span class="number">86</span>)</span><br><span class="line">- locked &lt;<span class="number">0x00000000829a3bb8</span>&gt; (a sun.nio.ch.Util$<span class="number">3</span>)</span><br><span class="line">- locked &lt;<span class="number">0x00000000829a3ba8</span>&gt; (a java.util.Collections$UnmodifiableSet)</span><br><span class="line">- locked &lt;<span class="number">0x00000000829a38c8</span>&gt; (a sun.nio.ch.EPollSelectorImpl)</span><br><span class="line">at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:<span class="number">97</span>)</span><br><span class="line">at org.apache.tomcat.util.net.NioEndpoint$Poller.run(NioEndpoint.java:<span class="number">825</span>)</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ˜¯nioçš„EpollWaitï¼Œå¯ä»¥å¿½ç•¥</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ThreadDumpä¸­åŒ…å«äº†çº¿ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¸€èˆ¬æœ‰ Runnableï¼ŒBLOCKEDï¼ŒWaitå‡ ç§çŠ¶æ€ã€‚Waitä¸€èˆ¬éƒ½æ˜¯çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹ï¼Œå¯ä»¥è·³è¿‡ï¼Œä¸»è¦å…³æ³¨ç‚¹åº”è¯¥æ”¾åœ¨Runnableå’ŒBLOCKEDè¿™ä¸¤ç§çŠ¶æ€ã€‚
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
  </entry>
  
  <entry>
    <title>RSAåŠ å¯†è§£å¯†ä»¥åŠç§˜é’¥çš„ç”Ÿæˆ</title>
    <link href="http://yoursite.com/2016/01/14/rsa/"/>
    <id>http://yoursite.com/2016/01/14/rsa/</id>
    <published>2016-01-14T01:31:00.000Z</published>
    <updated>2019-07-05T09:47:30.688Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        d();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">d</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//ç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">        KeyPairGenerator keyGen = KeyPairGenerator.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">        keyGen.initialize(<span class="number">2048</span>);</span><br><span class="line">        KeyPair key = keyGen.generateKeyPair();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// å…¬é’¥</span></span><br><span class="line">        <span class="keyword">byte</span>[] pub = key.getPublic().getEncoded();</span><br><span class="line">        <span class="comment">// ç§é’¥</span></span><br><span class="line">        <span class="keyword">byte</span>[] pri = key.getPrivate().getEncoded();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// åŸæ–‡</span></span><br><span class="line">        <span class="keyword">byte</span>[] plainText = <span class="string">"ä½ çœ‹çœ‹"</span>.getBytes();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//åŠ å¯†å·¥å…·</span></span><br><span class="line">        Cipher c1 = Cipher.getInstance(<span class="string">"RSA"</span>);</span><br><span class="line">        c1.init(Cipher.ENCRYPT_MODE, key.getPrivate());</span><br><span class="line">        <span class="keyword">byte</span>[] cipherText = c1.doFinal(plainText);</span><br><span class="line"> </span><br><span class="line">        c1.init(Cipher.DECRYPT_MODE, key.getPublic());</span><br><span class="line">        <span class="keyword">byte</span>[] output = c1.doFinal(cipherText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/spa
      
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="encrypt" scheme="http://yoursite.com/tags/encrypt/"/>
    
  </entry>
  
</feed>
